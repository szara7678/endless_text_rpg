# UPDATE.md

## 최신 업데이트 내역

### 🔧 **미니게임 JSON 로딩 오류 수정 - 2024년 12월 23일**

**문제**:
- 광산 게임에서 `mining_rewards.json` 파일을 찾을 수 없는 404 에러 발생
- 채집 게임에서도 동일한 문제 발생
- `fetch('/src/data/drops/...')` 방식이 프로덕션 환경에서 올바르게 작동하지 않음

**해결 방법**:

1. **dataLoader.ts의 loadDropTable 함수 활용**:
   - 기존의 `fetch` 방식 대신 `dataLoader.ts`의 `loadDropTable` 함수 사용
   - 동적 import를 통한 안전한 파일 로딩
   - 프로덕션 환경에서도 올바르게 작동하는 방식으로 변경

2. **MiningMinigame.tsx 수정**:
   - `loadDropTable` import 추가
   - `fetch('/src/data/drops/mining_rewards.json')` → `loadDropTable('mining_rewards')` 변경
   - 에러 처리 로직 개선

3. **HerbalismMinigame.tsx 수정**:
   - `loadDropTable` import 추가
   - `fetch('/src/data/drops/herbalism_rewards.json')` → `loadDropTable('herbalism_rewards')` 변경
   - 에러 처리 로직 개선

4. **FishingMinigame.tsx 확인**:
   - 이미 올바르게 `loadDropTable` 함수를 사용하고 있음을 확인

**수정된 파일**:
- `src/components/life/MiningMinigame.tsx`: JSON 로딩 방식 변경 및 에러 처리 개선
- `src/components/life/HerbalismMinigame.tsx`: JSON 로딩 방식 변경 및 에러 처리 개선

**결과**: 
- 404 에러 해결로 미니게임 보상 시스템 정상 작동
- 프로덕션 환경에서도 안정적으로 JSON 파일 로딩
- 일관된 데이터 로딩 방식으로 코드 통일성 향상

---

### 🔧 **몬스터 드랍 장비 능력치 계산 및 equipmentSystem 개선 - 2024년 12월 23일**

**문제**:
- 몬스터가 드랍하는 장비 아이템에 능력치가 표시되지 않음
- `equipmentSystem.ts`에서 장비 기본 능력치가 하드코딩되어 있음
- JSON 파일의 아이템 데이터가 활용되지 않음

**해결 방법**:

1. **equipmentSystem.ts 개선**:
   - `getBaseEquipmentStats` 함수를 비동기로 변경하여 JSON 파일에서 데이터 로드
   - `loadItem` 함수를 사용하여 `@/items` 폴더의 JSON 파일에서 스탯 정보 가져오기
   - `elementalAttack`을 `magicalAttack`으로 변환하는 로직 추가
   - 모든 관련 함수를 비동기로 변경 (`getEquipmentStats`, `recalculatePlayerStats`, `equipItem`, `unequipItem`)

2. **드랍 시스템 개선**:
   - `dropSystem.ts`에 `calculateEquipmentStats` 함수 추가
   - 장비 아이템 드랍 시 능력치를 계산하여 표시
   - 드랍 로그에 능력치 정보 포함

3. **스토어 시스템 수정**:
   - `stores/index.ts`의 장비 관련 함수들을 비동기로 변경
   - 몬스터 사망 처리에서 장비 아이템 드랍 시 능력치 계산 및 표시
   - 장비 착용/해제/강화 함수들을 비동기로 수정

**수정된 파일**:
- `src/utils/equipmentSystem.ts`: JSON 파일에서 장비 스탯 로드하도록 개선
- `src/utils/dropSystem.ts`: 장비 능력치 계산 함수 추가
- `src/stores/index.ts`: 장비 관련 함수들을 비동기로 수정 및 드랍 로그 개선

**결과**: 
- 몬스터 드랍 장비에 능력치가 표시됨 (예: "화염 검 (Lv5) (Fine) [공격력 +25, 마법공격력 +18] x1 획득!")
- JSON 파일의 아이템 데이터가 실제로 활용됨
- 장비 시스템이 더욱 정확하고 일관성 있게 작동

---

### 🔧 **장비 상세 모달 능력치 표시 수정 - 2024년 12월 23일**

**문제**:
- 장비 상세 모달에서 능력치가 표시되지 않음
- `getEquipmentStats` 함수가 비동기로 변경되었지만 모달에서는 동기적으로 호출
- 장비 정보를 볼 때 능력치가 "계산 중..." 상태로 멈춤

**해결 방법**:

1. **EquipmentStatsDisplay 컴포넌트 추가**:
   - 비동기 `getEquipmentStats` 함수를 올바르게 호출하는 전용 컴포넌트 생성
   - 로딩 상태와 에러 처리를 포함한 완전한 비동기 처리
   - 장비 능력치를 실시간으로 계산하여 표시

2. **기존 동기 코드 제거**:
   - 기존의 동기적 `getEquipmentStats` 호출 부분 제거
   - 새로운 `EquipmentStatsDisplay` 컴포넌트로 교체

**수정된 파일**:
- `src/components/common/ItemDetailModal.tsx`: 장비 능력치 표시 컴포넌트 추가 및 비동기 처리 구현

**결과**: 
- 장비 상세 모달에서 능력치가 정상적으로 표시됨
- 레벨, 품질, 강화 수치에 따른 정확한 능력치 계산
- 로딩 상태와 에러 처리로 안정적인 UI 제공

---

### 🔄 **환생 시스템 설정 패널 통합 및 부활 스크롤 개선 - 2024년 12월 23일**

**목표**:
- 설정 패널에 환생 버튼 추가 (100층 이상에서 활성화)
- 환생 확인 모달에 예상 AP 표시
- 캐릭터 사망시 부활 스크롤 시스템 개선
- 현재 층에서 부활하도록 수정

**주요 변경사항**:

1. **설정 패널 환생 시스템 통합**:
   - `src/components/settings/SettingsPanel.tsx` 수정
   - 환생 버튼을 일반 탭에 추가
   - 100층 이상에서만 활성화되도록 조건 설정
   - 예상 AP 획득량을 실시간으로 표시

2. **환생 확인 모달 구현**:
   - 환생 버튼 클릭 시 확인 모달 표시
   - 예상 AP 획득량을 명확히 표시
   - 현재 층수만 초기화된다는 안내 추가

3. **부활 스크롤 시스템 개선**:
   - `src/stores/index.ts`의 `handlePlayerDeath` 함수 수정
   - 부활 스크롤 사용 시 현재 층에서 그대로 부활
   - 부활 메시지에 현재 층수 표시 추가

**수정된 파일**:
- `src/components/settings/SettingsPanel.tsx`: 환생 버튼 및 확인 모달 추가
- `src/stores/index.ts`: 부활 스크롤 시스템 개선

**기능 설명**:
- 설정 → 일반 탭에서 환생 버튼 확인 가능
- 100층 미만: "환생 불가능" 버튼 (비활성화)
- 100층 이상: "환생하기" 버튼 (활성화) + 예상 AP 표시
- 환생 버튼 클릭 시 확인 모달에서 예상 AP 확인 후 환생 실행
- 캐릭터 사망 시 부활 스크롤 보유하면 현재 층에서 HP 100%로 부활

### 🔧 **패키지 구매 오류 수정 및 스크롤 아이템 DB 생성 - 2024년 12월 23일**

### 🔧 **패키지 구매 오류 수정 및 스크롤 아이템 DB 생성 - 2024년 12월 23일**

**추가 수정사항**:
- 패키지 ID 불일치 문제 해결: `material_box` → `materialBox` 등 모든 패키지 ID 통일
- 스크롤 구매 시 인벤토리 추가 문제 해결
- AP 스크롤 구매 시 즉시 AP 증가 효과 적용
- JSON 파싱 오류 해결을 위한 파일 정리

**수정된 파일**:
- `src/data/shop/packages.json`: 모든 패키지 ID를 camelCase로 통일
- `src/components/shop/ShopPanel.tsx`: 스크롤 구매 시 즉시 효과 적용 로직 추가
- `src/data/initial/inventory.json`: 불필요한 공백 제거로 JSON 파싱 오류 해결
- `src/stores/index.ts`: 아이템 타입과 서브타입으로 분류하도록 수정
- `src/data/items/ap_scroll.json`: 다른 포션들과 일관된 구조로 수정
- `src/data/items/revival_scroll.json`: 다른 포션들과 일관된 구조로 수정
- `src/components/common/ItemDetailModal.tsx`: 스크롤 아이템 사용 기능 추가
- `src/components/inventory/InventoryPanel.tsx`: 스크롤 아이템을 소모품 탭에 올바르게 분류하도록 수정

**목표**:
- 패키지 구매 시 발생하는 ID 불일치 오류 해결
- 스크롤 아이템들을 위한 별도 아이템 DB 생성
- 초기 데이터를 `@/initial`에서 받아오도록 수정
- 스크롤 아이템들을 패키지 시스템에서 분리하여 직접 처리

**주요 변경사항**:

1. **스크롤 아이템 DB 생성**:
   - `src/data/items/ap_scroll.json`: AP 증가 스크롤 아이템 데이터 생성
   - `src/data/items/revival_scroll.json`: 부활 스크롤 아이템 데이터 생성
   - 스크롤 아이템들을 소비아이템으로 분류하여 인벤토리에 바로 추가

2. **패키지 시스템에서 스크롤 제거**:
   - `src/data/shop/packages.json`에서 스크롤 아이템들 제거
   - `src/utils/packageSystem.ts`에서 스크롤 처리 로직 제거
   - 패키지 시스템은 패키지 아이템만 처리하도록 분리

3. **상점 패널 스크롤 처리 개선**:
   - `src/components/shop/ShopPanel.tsx`에서 스크롤 아이템들을 별도로 정의
   - 스크롤 구매 시 바로 인벤토리에 추가하는 로직 구현
   - 패키지 시스템을 거치지 않고 직접 처리

4. **초기 데이터 로딩 개선**:
   - `src/utils/dataLoader.ts` 수정하여 `@/initial`에서 데이터 받아오기
   - `loadInitialCharacter()`, `loadInitialInventory()`, `loadInitialSkills()`, `loadInitialTower()` 함수 수정
   - 파일 로드 실패 시 기본값 사용하는 fallback 시스템 구현

5. **타입 오류 수정**:
   - `src/utils/packageSystem.ts`의 `applyScrollEffect` 함수에서 타입 안전성 개선
   - `in` 연산자를 사용하여 속성 존재 여부 확인

**수정된 파일**:
- `src/data/items/ap_scroll.json`: AP 증가 스크롤 아이템 데이터 생성
- `src/data/items/revival_scroll.json`: 부활 스크롤 아이템 데이터 생성
- `src/data/shop/packages.json`: 스크롤 아이템들 제거
- `src/components/shop/ShopPanel.tsx`: 스크롤 아이템 별도 처리 로직 구현
- `src/utils/packageSystem.ts`: 스크롤 처리 로직 제거 및 타입 안전성 개선
- `src/utils/dataLoader.ts`: 초기 데이터를 `@/initial`에서 로드하도록 수정

### 🏪 **상점 시스템 대폭 개선 - 2024년 12월 23일**

**목표**:
- 상점 상단 재화 표시 패널 제거
- 패키지와 스크롤 아이템만 판매하도록 상점 재구성
- 모든 아이템에 상세 정보 모달 추가 (상세보기 → 구매)
- 새로운 스크롤 아이템 추가 (AP 증가 스크롤, 부활 스크롤)
- 부활 스크롤 기능 구현 (사망 시 자동 부활)

**주요 변경사항**:

1. **상점 UI 개선**:
   - `src/components/shop/ShopPanel.tsx` 수정
   - 상단 재화 표시 패널 완전 제거
   - 패키지와 스크롤 아이템만 판매하도록 재구성
   - 모든 아이템에 상세 정보 모달 추가

2. **패키지 구매 시스템 개선**:
   - `src/components/shop/PackageDetailModal.tsx` 수정
   - 상세보기 → 구매 → 결과 표시 플로우 구현
   - 외부 구매 처리 콜백 시스템 추가

3. **새로운 스크롤 아이템 추가**:
   - `src/data/shop/packages.json`에 새로운 스크롤 추가
   - AP 증가 스크롤: 즉시 +5 AP 획득
   - 부활 스크롤: 사망 시 HP 100%로 부활

4. **부활 스크롤 기능 구현**:
   - `src/stores/index.ts`의 `handlePlayerDeath` 함수 수정
   - 부활 스크롤 보유 시 자동 부활 기능 구현
   - `removeItem` 함수 추가로 스크롤 소모 처리

5. **상점 아이템 분류 재구성**:
   - 패키지: 재료 랜덤박스, 스킬 팩, 광석 팩, 요리 팩, 스크롤 팩, 물약 팩, 물고기 팩, 약초 팩
   - 스크롤: AP 증가 스크롤, 부활 스크롤
   - 각 아이템별 고유한 효과와 가격 시스템

**수정된 파일**:
- `src/components/shop/ShopPanel.tsx`: 상점 UI 개선 및 아이템 분류 재구성
- `src/components/shop/PackageDetailModal.tsx`: 상세 정보 모달 개선
- `src/data/shop/packages.json`: 새로운 스크롤 아이템 추가
- `src/stores/index.ts`: 부활 스크롤 기능 및 removeItem 함수 구현
- `README.md`: 상점 시스템 개선사항 반영

### 🔧 **소비 아이템 품질 시스템 개선 - 2024년 12월 23일**

**목표**:
- 소비 아이템에서 품질 표시 제거
- 요리/연금술 제작 시 소비 아이템 품질을 Common으로 고정
- 레벨만 변경하고 품질은 변경하지 않도록 수정

**주요 변경사항**:

1. **소비 아이템 품질 표시 제거**:
   - `src/components/inventory/InventoryPanel.tsx` 수정
   - 소비 아이템에서는 품질 표시를 제거
   - 장비에서만 품질 표시 유지

2. **제작 시스템 품질 고정**:
   - `src/stores/index.ts`의 `addItem` 함수 수정
   - 소비 아이템은 항상 Common 품질로 고정
   - 레벨별로만 분리하여 관리

3. **드롭 시스템 품질 고정**:
   - `src/stores/index.ts`의 드롭 처리 로직 수정
   - 소비 아이템 드롭 시 품질을 Common으로 고정
   - 장비만 품질 차별화 유지

4. **상점 시스템 품질 고정**:
   - `src/stores/index.ts`의 `purchaseItem` 함수 수정
   - 소비 아이템 구매 시 품질을 Common으로 고정
   - 장비는 기존 품질 시스템 유지

**수정된 파일**:
- `src/components/inventory/InventoryPanel.tsx`: 소비 아이템 품질 표시 제거
- `src/stores/index.ts`: 제작/드롭/상점 시스템에서 소비 아이템 품질 고정

### 🔧 **스킬 레벨업 및 인벤토리 시스템 버그 수정 - 2024년 12월 23일**

**목표**:
- 스킬 레벨업시 AP 소모 로그와 실제 AP 감소 불일치 문제 해결
- 인벤토리 키 중복 오류 해결
- 소비 아이템 품질 표시 추가
- 소비 아이템이 장비 패널에 표시되는 문제 해결

**주요 변경사항**:

1. **스킬 레벨업 AP 소모 문제 해결**:
   - `src/stores/index.ts`의 `levelUpSkill` 함수 수정
   - `player.ascensionPoints` → `player.rebirthLevel`로 변경
   - AP 소모 로그와 실제 AP 감소가 일치하도록 수정
   - 정보 패널의 AP 표시가 정상적으로 업데이트됨

2. **인벤토리 키 중복 오류 해결**:
   - `src/components/inventory/InventoryPanel.tsx` 수정
   - 키 생성 로직에 타임스탬프와 랜덤 문자열 추가
   - `health_potion_1` 같은 중복 키 문제 해결

3. **소비 아이템 품질 표시 추가**:
   - `src/components/inventory/InventoryPanel.tsx` 수정
   - 소비 아이템에도 품질 표시 기능 추가
   - 장비와 동일한 품질 색상 시스템 적용

4. **소비 아이템 분류 개선**:
   - 장비 필터링 로직 확인 및 개선
   - 소비 아이템이 장비 패널에 표시되지 않도록 필터링 강화

**수정된 파일**:
- `src/stores/index.ts`: 스킬 레벨업 AP 소모 로직 수정
- `src/components/inventory/InventoryPanel.tsx`: 키 중복 해결 및 품질 표시 추가

### 🔧 **모바일 UI 개선 및 시스템 버그 수정 - 2024년 12월 23일**

**목표**:
- 모바일에서 생활탭과 상점의 하단 잘림 문제 해결
- 생활 관련 수련치 저장/로드 시스템 구현
- 스킬 레벨업 버튼 활성/비활성 조건 수정
- 소비템 품질별 분리 문제 해결
- 우유 관련 코드 제거 (획득처 없음)
- 장비/물약 드롭 제거 (상점에서만 구매 가능)

**주요 변경사항**:

1. **모바일 UI 개선**:
   - `src/components/layout/Layout.tsx` 수정
   - 메인 게임 영역 하단 여백 증가 (pb-16 → pb-20)
   - 모바일에서 패널 하단 잘림 문제 해결

2. **생활 스킬 저장/로드 시스템 구현**:
   - `src/stores/index.ts`에 `saveLifeSkills`, `loadLifeSkills` 함수 추가
   - `saveGame` 함수에 생활 스킬 저장 로직 추가
   - `continueGame` 함수에 생활 스킬 로드 로직 추가
   - localStorage를 통한 생활 스킬 데이터 영구 저장

3. **스킬 레벨업 버튼 수정**:
   - `src/components/character/CharacterPanel.tsx` 수정
   - `player.ascensionPoints` → `player.rebirthLevel`로 변경
   - AP 기반 레벨업 시스템 정상 작동

4. **소비템 품질별 분리 시스템 개선**:
   - `src/stores/index.ts`의 `addItem` 함수 수정
   - 소비템을 레벨과 품질별로 분리하여 관리
   - 같은 레벨/품질의 아이템만 수량 합산

5. **우유 관련 코드 제거**:
   - `src/data/materials/milk.json` 파일 삭제
   - `src/data/initial/inventory.json`에서 우유 제거
   - `src/data/shop/packages.json`에서 우유 관련 항목 제거
   - 요리 아이템들의 재료에서 우유를 밀로 변경
   - `src/utils/packageSystem.ts`에서 우유 관련 매핑 제거

6. **드롭 시스템 개선**:
   - `src/data/drops/flame_normal.json`에서 장비/물약 드롭 제거
   - 몬스터에서 장비나 물약이 드롭되지 않도록 수정
   - 상점에서만 장비와 물약 구매 가능

**수정된 파일**:
- `src/components/layout/Layout.tsx`: 모바일 UI 개선
- `src/stores/index.ts`: 생활 스킬 저장/로드 시스템 추가
- `src/components/character/CharacterPanel.tsx`: 스킬 레벨업 버튼 수정
- `src/data/materials/milk.json`: 우유 아이템 삭제
- `src/data/initial/inventory.json`: 우유 제거
- `src/data/shop/packages.json`: 우유 관련 항목 제거
- `src/data/items/bread.json`: 우유 → 밀 변경
- `src/data/items/fish_stew.json`: 우유 → 밀 변경
- `src/data/items/herb_soup.json`: 우유 → 밀 변경
- `src/data/items/divine_feast.json`: 우유 → 밀 변경
- `src/utils/packageSystem.ts`: 우유 관련 매핑 제거
- `src/data/drops/flame_normal.json`: 장비/물약 드롭 제거

### 🛍️ **상점 시스템 대폭 개선 - 랜덤박스 및 패키지 시스템 구현 - 2024년 12월 23일**

**목표**:
- 상점에 다양한 랜덤박스와 패키지 아이템 추가
- 패키지 상세 정보 모달 구현
- 구매 결과 표시 모달 구현
- 가중치 기반 랜덤 아이템 획득 시스템 구현
- 스크롤 아이템 및 효과 시스템 구현

**주요 변경사항**:

1. **패키지 데이터 시스템 구현**:
   - `src/data/shop/packages.json` 생성
   - 재료 랜덤박스, 스킬 팩, 광석 팩, 요리 팩, 스크롤 팩, 물약 팩, 물고기 팩, 약초 팩 등 8가지 패키지 정의
   - 각 패키지별 보장 아이템과 랜덤 아이템 구성
   - 가중치 기반 확률 시스템 적용

2. **스크롤 아이템 시스템 구현**:
   - `src/data/items/scrolls.json` 생성
   - 경험치 스크롤, 골드 스크롤, 드롭 스크롤, 강화 스크롤, 환생 스크롤 등 5가지 스크롤 정의
   - 각 스크롤별 지속시간과 효과 정의

3. **패키지 시스템 유틸리티 구현**:
   - `src/utils/packageSystem.ts` 생성
   - 가중치 기반 랜덤 선택 함수 `weightedRandom`
   - 패키지 열기 함수 `openPackage`
   - 스크롤 효과 적용 함수 `applyScrollEffect`
   - 아이템 이름, 아이콘, 희귀도 매핑 함수들

4. **패키지 상세 모달 구현**:
   - `src/components/shop/PackageDetailModal.tsx` 생성
   - 패키지 구성품 상세 정보 표시
   - 보장 아이템과 랜덤 아이템 구분 표시
   - 확률 정보 및 수량 범위 표시
   - 패키지 구매 기능

5. **구매 결과 모달 구현**:
   - `src/components/shop/PurchaseResultModal.tsx` 생성
   - 획득한 아이템 목록 표시
   - 아이템별 아이콘, 이름, 수량, 희귀도 표시
   - 총 아이템 수와 총 수량 요약 정보

6. **상점 패널 대폭 개선**:
   - `src/components/shop/ShopPanel.tsx` 수정
   - 패키지 카테고리 추가
   - 패키지 아이템들 상점에 추가
   - 패키지 구매 시 상세 모달 표시
   - 구매 결과 모달 연동

7. **스토어에 패키지 구매 기능 추가**:
   - `src/stores/index.ts` 수정
   - `purchasePackage` 함수 구현
   - 패키지 열기 및 아이템 획득 로직
   - 스크롤 효과 적용 시스템

**패키지 시스템 특징**:
- **재료 랜덤박스**: 다양한 재료들을 확률에 따라 획득 (500 골드)
- **스킬 페이지 랜덤팩**: 랜덤 스킬 페이지 1-3개 획득 (10 젬)
- **광석 팩**: 다양한 광석들을 확률에 따라 획득 (300 골드)
- **요리 팩**: 요리 재료와 완성된 요리 획득 (400 골드)
- **스크롤 팩**: 다양한 효과의 스크롤들 획득 (15 젬)
- **물약 팩**: 다양한 물약들 획득 (250 골드)
- **물고기 팩**: 다양한 물고기들 획득 (200 골드)
- **약초 팩**: 다양한 약초들 획득 (180 골드)

**스크롤 효과 시스템**:
- **경험치 스크롤**: 1시간 동안 경험치 2배 획득
- **골드 스크롤**: 1시간 동안 골드 2배 획득
- **드롭 스크롤**: 30분 동안 아이템 드롭률 50% 증가
- **강화 스크롤**: 다음 장비 강화 시 100% 성공률 보장
- **환생 스크롤**: 즉시 +10 AP 획득

**랜덤 시스템 특징**:
- **가중치 기반**: 각 아이템별 확률 가중치 적용
- **수량 범위**: 최소-최대 수량 범위에서 랜덤 선택
- **보장 아이템**: 패키지별 반드시 획득하는 아이템들
- **랜덤 아이템**: 확률에 따라 선택되는 아이템들

**수정된 파일**:
- `src/data/shop/packages.json`: 패키지 데이터 정의 (신규)
- `src/data/items/scrolls.json`: 스크롤 아이템 데이터 (신규)
- `src/utils/packageSystem.ts`: 패키지 시스템 유틸리티 (신규)
- `src/components/shop/PackageDetailModal.tsx`: 패키지 상세 모달 (신규)
- `src/components/shop/PurchaseResultModal.tsx`: 구매 결과 모달 (신규)
- `src/components/shop/ShopPanel.tsx`: 상점 패널 개선
- `src/stores/index.ts`: 패키지 구매 기능 추가

### 🧪 **물약 시스템 고도화 및 설정 탭 추가 - 2024년 12월 23일**

### 🧪 **물약 시스템 고도화 및 설정 탭 추가 - 2024년 12월 23일**

**목표**:
- 물약을 HP, MP 회복 물약만으로 단순화
- 레벨에 따른 회복량 계산 시스템 구현
- 층별 물약 사용 제한 시스템 구현
- 자동 물약 사용 시스템 구현
- 설정 탭 추가 및 메인 메뉴로 돌아가기 기능 구현
- 스킬 레벨업 시스템 수정

**주요 변경사항**:

1. **물약 데이터 구조 개선**:
   - `health_potion.json`, `mana_potion.json`에 `baseHeal` 필드 추가
   - 레벨에 따른 회복량 계산: `baseHeal * (1 + (level - 1) * 0.2)`
   - 기존 물약들(greater_health_potion, greater_mana_potion, stamina_potion) 삭제

2. **물약 시스템 유틸리티 구현**:
   - `src/utils/potionSystem.ts` 생성
   - 레벨별 회복량 계산 함수 `calculatePotionHeal`
   - 층별 사용 제한 확인 함수 `canUsePotion`
   - 자동 사용 판단 함수 `shouldAutoUsePotion`
   - 물약 사용 기록 업데이트 함수 `updatePotionUsage`

3. **설정 시스템 구현**:
   - `src/stores/settingsSlice.ts` 생성
   - 물약 자동 사용 설정 (HP/MP 임계값, 높은 레벨 우선 사용)
   - 메인 메뉴로 돌아가기 기능
   - 설정 상태 관리 시스템

4. **설정 패널 컴포넌트 구현**:
   - `src/components/settings/SettingsPanel.tsx` 생성
   - 물약 자동 사용 설정 UI
   - 메인 메뉴로 돌아가기 버튼
   - 설정 변경 실시간 반영

5. **탭바에 설정 탭 추가**:
   - `src/components/layout/TabBar.tsx` 수정
   - 설정 아이콘과 함께 설정 탭 추가
   - 다른 탭과 일관된 UI/UX

6. **메인 스토어에 설정 시스템 통합**:
   - `src/stores/index.ts`에 설정 관련 함수 추가
   - `updatePotionSettings`, `resetToMenu` 함수 구현
   - 물약 사용 기록 `potionUsageHistory` 추가

7. **전투 엔진에 물약 자동 사용 시스템 통합**:
   - `src/utils/combatEngine.ts` 수정
   - `processPlayerTurn` 함수에 물약 자동 사용 로직 추가
   - HP/MP 임계값에 따른 자동 물약 사용
   - 물약 사용 기록 업데이트

8. **인벤토리 시스템에 물약 사용 기능 추가**:
   - `src/stores/inventorySlice.ts`에 `usePotion` 함수 추가
   - 레벨별 물약 사용 시스템 구현
   - 물약 사용 시 인벤토리에서 제거

9. **스킬 레벨업 시스템 수정**:
   - `src/components/character/CharacterPanel.tsx` 수정
   - 스킬 레벨업 버튼 기능 구현
   - AP 기반 레벨업 시스템 적용
   - 기본 공격 스킬과 레벨업 불가능한 스킬 버튼 비활성화

10. **UI 타입 시스템 확장**:
    - `src/types/index.ts`에 물약 관련 타입 추가
    - `src/stores/uiSlice.ts`에 settings 패널 타입 추가
    - Item 타입에 물약 관련 필드 추가

**설정 기능**:
- **물약 자동 사용**: HP/MP 20% 미만일 때 자동 사용 (기본값)
- **임계값 조정**: HP/MP 자동 사용 임계값을 0-100% 범위에서 설정 가능
- **우선순위 설정**: 높은 레벨 물약 우선 사용 여부 설정
- **메인 메뉴 복귀**: 설정에서 메인 메뉴로 돌아가기 기능

**물약 시스템 특징**:
- **층별 사용 제한**: 한 층에서 HP/MP 물약 각각 한 번만 사용 가능
- **레벨별 회복량**: 레벨이 높을수록 회복량 증가 (레벨당 20% 증가)
- **자동 사용**: 설정에 따라 HP/MP가 임계값 이하일 때 자동 사용
- **우선순위**: 높은 레벨 물약을 우선 사용하거나 낮은 레벨부터 사용 선택 가능

**스킬 레벨업 시스템**:
- **AP 기반**: 환생 포인트(AP)를 사용하여 스킬 레벨업
- **조건부 활성화**: 레벨업 가능한 스킬만 버튼 활성화
- **기본 공격 제외**: 기본 공격 스킬은 레벨업 불가능
- **실시간 업데이트**: 레벨업 후 즉시 UI 반영

**수정된 파일**:
- `src/data/items/health_potion.json`: 물약 데이터 구조 개선
- `src/data/items/mana_potion.json`: 물약 데이터 구조 개선
- `src/utils/potionSystem.ts`: 물약 시스템 유틸리티 (신규)
- `src/stores/settingsSlice.ts`: 설정 시스템 (신규)
- `src/components/settings/SettingsPanel.tsx`: 설정 패널 (신규)
- `src/components/layout/TabBar.tsx`: 설정 탭 추가
- `src/components/layout/Layout.tsx`: 설정 패널 통합
- `src/stores/index.ts`: 설정 시스템 통합
- `src/stores/inventorySlice.ts`: 물약 사용 기능 추가

**완료된 기능들**:
✅ HP, MP 회복 물약만 남기고 나머지 삭제
✅ 레벨에 따른 회복량 계산 시스템
✅ 층별 물약 사용 제한 (한 층에서 HP/MP 물약 각각 한 번만 사용)
✅ 자동 물약 사용 시스템 (HP/MP 20% 미만 시 자동 사용)
✅ 설정에서 임계값 조정 가능 (0-100%)
✅ 높은 레벨 물약 우선 사용 여부 설정
✅ 하단 탭바에 설정 탭 추가
✅ 물약 자동 사용 설정 UI
✅ 메인 메뉴로 돌아가기 기능
✅ AP 기반 스킬 레벨업 시스템
✅ 기본 공격 스킬과 레벨업 불가능한 스킬 버튼 비활성화
✅ 스킬 레벨업 버튼 기능 수정 및 AP 비용 계산 시스템 개선
✅ 전투 중 자동 물약 사용 및 인벤토리에서 제거
✅ 물약 자동 사용 시스템 개선 (MP 회복 지원, 전투 후 체크)
✅ 물약 품질 및 레벨 시스템 구현 (회복량 차등 적용, 로그 개선)
✅ 물약 상세 모달에 최종 회복량 표시 기능 추가
✅ 물약 회복량 계산 오류 수정 (품질 배율 수정, UI 간소화)
✅ 물약 회복량 계산 시스템 개선 (비동기 데이터 로드, 정확한 계산)
✅ 물약 사용 후 인벤토리 제거 및 React 키 중복 오류 수정
✅ 물약 자동 사용 시스템 개선 (높은 레벨/품질 우선 사용)
✅ 물약 사용 제한 및 정확한 물약 제거 시스템 구현
✅ 인벤토리 패널 아이템 이름 로딩 개선
✅ energy_drink 관련 코드 및 데이터 삭제
✅ 음식 시스템 개선 - 영구 스탯 증가 효과 구현
- **새로운 음식 시스템**: 아이템 레벨과 품질에 따른 영구 스탯 증가 효과
- **음식 아이템 수정**: bread, meat_stew, fish_stew, herb_soup, divine_feast
- **효과 시스템**: 물리/마법 공격력, 방어력, 속도, 최대 HP/MP 영구 증가
- **UI 개선**: 아이템 상세 모달에서 음식 효과 표시 및 사용 버튼 추가
- **밸런스 조정**: 다양한 재료 조합과 적절한 효과 수치 설정
- **스탯 시스템 개선**: 음식 스탯을 장비 스탯과 별도로 관리하여 총합 스탯에 반영
- **캐릭터 패널**: 음식으로 증가한 스탯을 🍽️ 아이콘으로 표시
- `src/utils/combatEngine.ts`: 자동 물약 사용 시스템 통합
- `src/components/character/CharacterPanel.tsx`: 스킬 레벨업 시스템 수정
- `src/types/index.ts`: 물약 관련 타입 추가
- `src/stores/uiSlice.ts`: 설정 패널 타입 추가

**결과**: 
- 물약 시스템이 레벨 기반으로 정교하게 작동
- 층별 사용 제한으로 전략적 물약 사용 필요
- 자동 물약 사용으로 편의성 향상
- 설정 탭을 통한 게임 옵션 관리 가능
- 메인 메뉴로 돌아가기 기능으로 게임 재시작 편의성 증대
- 스킬 레벨업 시스템이 AP 기반으로 정상 작동
- 기본 공격과 레벨업 불가능한 스킬 버튼 비활성화로 UI 개선

---

### 🔧 **10층 클리어 후 다음 층 진행 문제 수정 - 2024년 12월 23일**

**문제**:
- 10층 보스를 처치한 후 다음 층(11층)이 나타나지 않는 문제
- `proceedToNextFloor` 함수에서 `player.highestFloor + 1`로 계산하여 잘못된 층으로 진행

**해결 방법**:
- `proceedToNextFloor` 함수에서 `tower.currentFloor + 1`로 수정
- `player.highestFloor`는 최고 도달 층 기록용으로만 사용
- 실제 층 진행은 `tower.currentFloor`를 기준으로 계산

**수정된 파일**:
- `src/stores/index.ts`: `proceedToNextFloor` 함수의 층 계산 로직 수정

**결과**: 
- 10층 클리어 후 정상적으로 11층으로 진행
- 모든 층에서 올바른 다음 층으로 진행
- 층 진행 시스템 정상 작동

---

### 🎮 **생활 재료 선택 모달 동시 제작 기능 구현 - 2024년 12월 23일**

**목표**:
- 재료 선택 모달에서 동시 제작 수량 설정 기능 추가
- 각 제작마다 개별적으로 확률 계산하여 다양한 결과 생성
- 결과 모달을 채집/광산 결과 모달처럼 간단한 세로 스크롤로 표시

**주요 변경사항**:

1. **동시 제작 수량 계산 시스템**:
   - `calculateMaxCraftQuantity` 함수로 최대 제작 가능 수량 계산
   - 재료 보유량을 기준으로 제작 가능한 최대 수량 자동 계산
   - +/- 버튼으로 수량 조절 가능

2. **동시 제작 로직 구현**:
   - `executeCrafting` 함수에서 `craftQuantity`만큼 반복 제작
   - 각 제작마다 개별적으로 품질과 레벨 확률 계산
   - 재료 소모도 제작 수량만큼 증가

3. **결과 모달 개선**:
   - 채집/광산 결과 모달과 동일한 스타일 적용
   - 세로 스크롤 패널로 모든 제작 결과 표시
   - 각 아이템을 한 줄로 간단하게 표시 (이름, 품질, 레벨)
   - 품질별 색상 구분으로 시각적 개선

4. **UI/UX 개선**:
   - 제작 버튼에 수량 표시 ("3개 제작하기")
   - 최대 제작 가능 수량 안내
   - 경험치 획득량도 제작 수량만큼 증가

**수정된 파일**:
- `src/components/life/CraftingModal.tsx`: 동시 제작 기능 및 결과 모달 개선

**결과**: 
- 재료 선택 모달에서 동시 제작 수량 설정 가능
- 각 제작마다 개별적으로 확률에 따라 다양한 결과 생성
- 결과 모달이 채집/광산 결과 모달과 동일한 스타일로 표시
- 사용자 경험 향상 및 제작 효율성 증대

---

### 🔧 **10층 클리어 후 다음 층 진행 문제 디버깅 - 2024년 12월 23일**

**문제**:
- 10층 클리어 후 다음 층(11층)이 나타나지 않는 문제가 지속됨
- 이미지에서 "▲ 10층에 도착했습니다!" 메시지가 보임
- 층 진행 로직에 문제가 있을 가능성

**디버깅 방법**:
- `handleMonsterDeath` 함수에 층 진행 체크 로그 추가
- `proceedToNextFloor` 함수에 호출 로그 추가
- 현재 층, 층 주기, 필요 처치 수, 현재 처치 수 등 상세 정보 출력

**추가된 로그**:
- `🔍 층 진행 체크: 현재층=X, 층주기=Y, 필요처치=Z, 현재처치=W`
- `✅ 층 클리어! X층 → Y층으로 진행`
- `⏳ 아직 더 처치 필요: X/Y`
- `🚀 proceedToNextFloor 호출: X층 → Y층`

**수정된 파일**:
- `src/stores/index.ts`: 층 진행 로직에 디버깅 로그 추가

**목적**: 
- 층 진행 로직의 정확한 동작 확인
- 문제 발생 지점 파악
- 층 진행 시스템 정상 작동 보장

---

### 🏰 **층 구조 변경 - 1~6 일반, 7~9 정예, 10층마다 보스 - 2024년 12월 23일**

**문제**:
- 10, 20, 30...층이 휴식층으로 잘못 처리되어 몬스터가 생성되지 않음
- 10층에서 보스 처치 후 다음 층으로 진행되지 않는 문제

**원인 분석**:
- `floorInCycle === 0`일 때 휴식층으로 처리되어 몬스터가 생성되지 않음
- 10, 20, 30...층에서 보스가 나와야 하는데 휴식층으로 처리됨

**해결 방법**:
- 층 구조를 1~6 일반, 7~9 정예, 10층마다 보스로 변경
- `floorInCycle === 0`일 때 보스층으로 처리
- 휴식층 개념 제거

**수정된 파일**:
- `src/stores/index.ts`: 층 진행 로직 수정
- `src/utils/towerSystem.ts`: 층 구조 상수 및 함수 수정

**변경된 층 구조**:
- **1~6층**: 일반 몬스터 (3마리 처치)
- **7~9층**: 정예 몬스터 (2마리 처치)  
- **10, 20, 30...층**: 보스 (1마리 처치)

**결과**: 
- 10층에서 보스가 정상적으로 생성됨
- 10층 클리어 후 11층으로 정상 진행
- 모든 10의 배수층에서 보스 등장
- 층 진행 시스템 정상 작동

---

### 🔧 **10층 UI 표시 수정 - 휴식층 → 보스층 - 2024년 12월 23일**

**문제**:
- 10층에서 몬스터 정보 표시에 "휴식층"으로 잘못 표시됨
- UI에서 여전히 이전 층 구조를 사용하고 있음

**해결 방법**:
- `MainView.tsx`의 `getCurrentFloorMonsterInfo` 함수 수정
- 10층(floorInCycle === 0)을 보스층으로 처리
- 휴식층 개념 완전 제거

**수정된 파일**:
- `src/components/layout/MainView.tsx`: 층 정보 표시 로직 수정

**변경된 표시**:
- **이전**: 10층에서 "휴식층" 표시
- **수정 후**: 10층에서 "0/1" (보스층) 표시

**결과**: 
- 10층에서 올바르게 보스층으로 표시
- UI와 실제 게임 로직 일치
- 사용자에게 정확한 층 정보 제공

---

### 🎁 **드롭 시스템 중복 제거 - 같은 아이템 여러 번 드랍 문제 해결 - 2024년 12월 23일**

**문제**:
- 몬스터를 처치할 때 같은 아이템이 여러 번 연속으로 드랍되는 현상
- 이미지에서 "▲ 빙결석 (Lv6) 획득!"이 두 번 연속으로 표시됨
- 드롭 시스템에서 중복 처리가 발생

**원인 분석**:
- 드롭 테이블에서 같은 아이템이 여러 번 정의되어 있을 수 있음
- 드롭 확률 계산에서 중복 처리가 발생
- 드롭 결과를 중복 제거하지 않고 개별적으로 처리

**해결 방법**:
- `dropSystem.ts`에서 드롭 결과 중복 제거 로직 추가
- 같은 아이템, 레벨, 품질의 드롭을 하나로 합치고 수량으로 관리
- 타입 정의에 `quantity`와 `count` 필드 추가

**수정된 파일**:
- `src/utils/dropSystem.ts`: 드롭 결과 중복 제거 로직 추가
- `src/stores/index.ts`: 드롭 처리 시 수량 표시 추가

**변경된 표시**:
- **이전**: "▲ 빙결석 (Lv6) 획득!" (두 번 연속)
- **수정 후**: "▲ 빙결석 (Lv6) x2 획득!" (한 번에 수량 표시)

**결과**: 
- 같은 아이템이 중복으로 드랍되지 않음
- 드롭 로그가 깔끔하고 명확해짐
- 사용자 경험 향상

---

### 🔧 **일괄판매 품질 필터링 수정 - 2024년 12월 23일**

**문제**:
- 일괄판매 기능에서 품질 필터링이 제대로 작동하지 않음
- 품질 옵션과 실제 아이템 품질 값이 일치하지 않음

**원인 분석**:
- 품질 옵션: Common, Uncommon, Rare, Epic, Legendary
- 실제 아이템 품질: Common, Fine, Superior, Epic, Legendary
- 불일치로 인해 필터링이 제대로 작동하지 않음

**해결 방법**:
- 품질 옵션을 실제 아이템 품질과 일치하도록 수정
- 품질 필터링 로직 개선 (품질이 없는 아이템 제외)
- 필터링 정확도 향상

**수정된 파일**:
- `src/components/inventory/SellModal.tsx`: 품질 옵션 및 필터링 로직 수정

**변경된 품질 옵션**:
- **이전**: Common, Uncommon, Rare, Epic, Legendary
- **수정 후**: Common, Fine, Superior, Epic, Legendary

**모달 표시 품질 이름**:
- **이전**: 일반, 고급, 우수, 에픽, 전설
- **수정 후**: Common, Fine, Superior, Epic, Legendary

**결과**: 
- 품질 필터링이 정확하게 작동
- 실제 아이템 품질과 일치하는 필터링
- 모달 표시 품질 이름이 실제 품질 값과 일치
- 일괄판매 기능의 정확도 향상

---

### 🔧 **장비 능력치 시스템 개선 - 2024년 12월 23일**

**문제**:
- 아이템의 능력치가 강화하기 전에는 품질에 따라 변하지 않음
- 장비 상세 모달에서 기본 능력치가 불필요하게 표시됨
- 강화도가 없어도 품질과 레벨에 따른 능력치 차이가 반영되지 않음

**원인 분석**:
- 기본 능력치 섹션이 항상 표시되어 혼란 야기
- 강화도가 있을 때만 실제 능력치가 표시됨
- 품질과 레벨에 따른 능력치 계산이 UI에 제대로 반영되지 않음

**해결 방법**:
- 기본 능력치 섹션 제거
- 최종 능력치 섹션을 항상 표시하도록 수정
- `getEquipmentStats` 함수를 사용하여 품질과 레벨에 따른 능력치 계산
- 강화도 유무와 관계없이 품질과 레벨에 따른 능력치 차이 반영

**수정된 파일**:
- `src/components/common/ItemDetailModal.tsx`: 장비 능력치 표시 로직 개선

**변경 사항**:
- **기본 능력치 섹션**: 완전 제거
- **최종 능력치 섹션**: 항상 표시 (강화도 유무와 관계없이)
- **능력치 계산**: `getEquipmentStats` 함수 사용으로 품질과 레벨에 따른 정확한 계산
- **제목 표시**: 강화도가 있으면 "최종 능력치 (강화 +N)", 없으면 "최종 능력치"

**결과**: 
- 강화도가 없어도 품질과 레벨에 따른 능력치 차이가 명확히 표시
- 장비 상세 모달의 UI가 더 깔끔하고 직관적
- 사용자가 장비의 실제 성능을 정확히 파악 가능
- 품질과 레벨에 따른 장비 가치 차이가 명확히 드러남

---

### 🔧 **장비 탭 음식 아이템 필터링 수정 - 2024년 12월 23일**

**문제**:
- 장비 탭에 고기 스튜(meat_stew)가 표시됨
- 음식 아이템이 장비 탭에 잘못 분류되어 표시됨

**원인 분석**:
- 장비 탭 필터링 로직에서 `!item.itemId.includes('food')`로만 필터링
- `meat_stew`는 `stew`를 포함하지만 `food`를 포함하지 않아서 필터링되지 않음
- 음식 관련 아이템들(`bread`, `stew` 등)이 제대로 필터링되지 않음

**해결 방법**:
- 장비 탭 필터링 로직에 `bread`와 `stew` 키워드 추가
- 음식 관련 모든 아이템이 장비 탭에서 제외되도록 수정

**수정된 파일**:
- `src/components/inventory/InventoryPanel.tsx`: 장비 탭 필터링 로직 개선

**변경 사항**:
- **이전**: `!item.itemId.includes('potion') && !item.itemId.includes('food')`
- **수정 후**: `!item.itemId.includes('potion') && !item.itemId.includes('food') && !item.itemId.includes('bread') && !item.itemId.includes('stew')`

**결과**: 
- 장비 탭에서 음식 아이템들이 제대로 제외됨
- 고기 스튜가 소모품 탭에만 표시됨
- 장비 탭의 아이템 분류가 정확해짐
- 사용자 경험 개선

---

### 🔧 **아이템 분류 시스템 일관성 개선 - 2024년 12월 23일**

**문제**:
- 에너지 드링크가 악세사리에 들어가는 문제
- 아이템 데이터 구조가 일관되지 않음 (type/category vs type/subtype)
- 인벤토리 필터링에서 아이템 ID 문자열 검색으로만 분류
- 소모품 관련 키워드가 누락되어 잘못된 분류 발생

**원인 분석**:

- 다른 아이템들: `type: "consumable"`, `subtype: "potion"`
- 필터링 로직에서 `drink`, `soup`, `feast` 키워드 누락
- 아이템 데이터의 구조 불일치

**해결 방법**:
- 아이템 데이터 구조 통일 (`category` → `subtype`)
- 필터링 로직에 누락된 키워드 추가
- 소모품 관련 키워드 배열로 통합 관리
- 인벤토리 패널과 판매 모달의 필터링 로직 일관성 확보

**수정된 파일**:

- `src/components/inventory/InventoryPanel.tsx`: 필터링 로직 개선
- `src/components/inventory/SellModal.tsx`: 필터링 로직 개선

**변경 사항**:

- **소모품 키워드 확장**: `['potion', 'food', 'bread', 'stew', 'drink', 'soup', 'feast']`
- **필터링 로직 통합**: 인벤토리 패널과 판매 모달에서 동일한 키워드 배열 사용
- **일관성 확보**: 모든 소모품 관련 아이템이 올바른 탭에 표시

**결과**: 
- 에너지 드링크가 소모품 탭에만 표시됨
- 아이템 분류 시스템의 일관성 확보
- 소모품 관련 모든 아이템이 올바르게 분류됨
- 사용자 경험 개선

---

### 🔧 **아이템 데이터 구조 일관성 완료 - 2024년 12월 23일**

**문제**:
- 일부 아이템 데이터에서 `category`와 `subtype`이 혼재되어 사용됨
- 아이템 분류 시스템의 일관성 부족

**원인 분석**:
- `divine_feast.json`, `herb_soup.json`, `fish_stew.json`에서 `category: "food"` 사용
- 다른 아이템들은 `subtype` 사용
- 데이터 구조의 불일치로 인한 혼란

**해결 방법**:
- 모든 아이템 데이터에서 `category` → `subtype`으로 통일
- 일관된 데이터 구조 확보

**수정된 파일**:
- `src/data/items/divine_feast.json`: `category: "food"` → `subtype: "food"`
- `src/data/items/herb_soup.json`: `category: "food"` → `subtype: "food"`
- `src/data/items/fish_stew.json`: `category: "food"` → `subtype: "food"`

**변경 사항**:
- **소모품 아이템**: `type: "consumable"`, `subtype: "potion"` 또는 `subtype: "food"`
- **장비 아이템**: `type: "weapon"`, `subtype: "sword"` 또는 `subtype: "staff"`
- **방어구 아이템**: `type: "armor"`, `subtype: "heavy"` 등
- **악세사리 아이템**: `type: "accessory"`, `subtype: "ring"`

**결과**: 
- 모든 아이템 데이터의 구조가 일관됨
- 아이템 분류 시스템의 안정성 확보
- 향후 아이템 추가 시 일관된 구조 사용 가능
- 데이터 관리의 효율성 향상

---

### 🎮 **채집 게임 레이아웃 및 기능 개선 - 2024년 12월 23일**

**문제**:
1. 채집 게임에서 화면이 커지면 각 박스들의 간격이 너무 넓어지는 현상
2. 박스를 클릭해서 주변의 빈 박스들이 열릴 때 거기에 약초가 있으면 채집된 것으로 판정이 안됨
3. 깃발 기능이 불필요함
4. 하단 설명이 불필요함

**해결 방법**:

1. **레이아웃 개선**:
   - 그리드를 `flex justify-center`로 감싸서 중앙 정렬
   - `style={{ width: 'fit-content' }}`로 고정 크기 설정
   - 화면 크기에 상관없이 일정한 간격 유지

2. **연쇄 공개 시 허브 판정 수정**:
   - `revealCell` 함수가 공개된 셀들의 위치를 반환하도록 수정
   - `handleCellClick`에서 공개된 모든 셀을 확인하여 허브 판정
   - 연쇄 공개 시에도 허브가 정확히 채집된 것으로 판정

3. **깃발 기능 제거**:
   - `isFlagged` 필드와 관련 로직 완전 제거
   - 우클릭 이벤트 핸들러 제거
   - 깃발 관련 UI 요소 제거

4. **하단 설명 제거**:
   - "좌클릭: 채집 | 우클릭: 독성 표시" 텍스트 제거
   - 더 깔끔한 UI 제공

**수정된 파일**:
- `src/components/life/HerbalismMinigame.tsx`: 레이아웃 개선, 연쇄 공개 시 허브 판정 수정, 깃발 기능 제거, 하단 설명 제거

**결과**: 
- 화면 크기에 상관없이 일정한 박스 간격 유지
- 연쇄 공개 시 허브가 정확히 채집된 것으로 판정
- 깃발 기능 제거로 더 간단한 게임플레이
- 하단 설명 제거로 더 깔끔한 UI

---

### 🔧 **누락된 재료 파일 추가 - 2024년 12월 23일**

**문제**:
- `flame_essence` 아이템이 없어서 "알 수 없는 아이템" 오류가 발생
- 인벤토리 패널에서 아이템 이름을 로드할 때 오류 발생

**해결 방법**:
- `src/data/materials/flame_essence.json` 파일 생성
- 다른 essence 파일들과 동일한 구조로 설정
- 화염 정수(Superior 등급)로 설정

**수정된 파일**:
- `src/data/materials/flame_essence.json`: 새로 생성된 화염 정수 재료 파일

**결과**: 
- `flame_essence` 아이템 오류 완전 해결
- 인벤토리 패널에서 정상적으로 아이템 이름 표시
- 모든 재료 파일이 일관된 구조로 관리됨

---

### 🔧 **전투 로그에서 게임 저장 메시지 제거 - 2024년 12월 23일**

**문제**:
- 게임 저장 시 전투 로그에 "💾 게임이 저장되었습니다." 메시지가 표시됨
- 전투 로그가 불필요한 저장 메시지로 복잡해짐

**해결 방법**:
- `saveGame` 함수에서 `addCombatLog` 호출 제거
- 저장 완료는 콘솔 로그로만 표시하고 전투 로그에는 표시하지 않음

**수정된 파일**:
- `src/stores/index.ts`: `saveGame` 함수에서 전투 로그 저장 메시지 제거

**결과**: 
- 전투 로그가 더 깔끔하고 핵심적인 정보만 표시
- 게임 저장은 콘솔에서만 확인 가능
- 사용자 경험 개선

---

### 🔧 **전투 로그에서 제작 완료 메시지 제거 - 2024년 12월 23일**

**문제**:
- 아이템 제작 완료 시 전투 로그에 "✅ [아이템명] 제작 완료! (품질: [품질], 레벨: [레벨])" 메시지가 표시됨
- 전투 로그가 제작 관련 메시지로 복잡해짐

**해결 방법**:
- `CraftingModal.tsx`에서 `addCombatLog` 호출 제거
- 제작 완료는 제작 모달에서만 표시하고 전투 로그에는 표시하지 않음

**수정된 파일**:
- `src/components/life/CraftingModal.tsx`: 제작 완료 시 전투 로그 메시지 제거

**결과**: 
- 전투 로그가 전투 관련 핵심 정보만 표시
- 제작 완료는 제작 모달에서만 확인 가능
- 더 깔끔하고 직관적인 로그 시스템

---

### 🎮 **채집 게임 완전 개선 - 2024년 12월 23일**

**문제**:
1. 지뢰를 찾아도 지뢰 위치가 표시되지 않음
2. 지뢰를 밟으면 "실패"로 표시되어 부정적
3. 지뢰 개수가 고정되어 있어 레벨에 따른 난이도 조정 없음
4. 보상 시스템이 단순하고 전투 로그에만 표시됨
5. 허브 발견 시 즉시 보상이 지급되지 않음

**해결 방법**:

1. **지뢰 표시 개선**:
   - 지뢰를 찾으면 💣 이모지로 표시
   - 해골 이모지 대신 폭탄 이모지 사용

2. **게임 종료 방식 변경**:
   - 지뢰를 밟으면 "실패"가 아닌 "채집 완료"로 표시
   - 부정적인 메시지 제거

3. **레벨 기반 난이도 조정**:
   - 지뢰 개수를 레벨에 따라 5~20개로 점진적 증가
   - `Math.min(20, Math.max(5, 5 + Math.floor(skillLevel / 2)))`

4. **보상 시스템 완전 구현**:
   - `src/data/drops/herbalism_rewards.json` 채집 보상 테이블 생성
   - 허브 발견 시마다 즉시 보상 지급
   - 레벨, 발견된 허브/지뢰 수에 따른 아이템 레벨 계산
   - 약초, 정수, 스킬 페이지 등 다양한 보상

5. **결과 표시 개선**:
   - 지뢰를 밟으면 획득 아이템 목록과 스킬 수련치 표시
   - 실시간 보상 지급과 게임 저장

**수정된 파일**:
- `src/components/life/HerbalismMinigame.tsx`: 채집 게임 완전 개선
- `src/components/life/LifePanel.tsx`: 스킬 레벨 전달 추가
- `src/data/drops/herbalism_rewards.json`: 채집 보상 테이블 생성

**결과**: 
- 지뢰 발견 시 💣 이모지로 명확히 표시
- 지뢰를 밟아도 "채집 완료"로 긍정적 메시지
- 레벨에 따른 점진적 난이도 증가
- 허브 발견 시마다 즉시 보상 지급
- 다양한 아이템과 스킬 페이지 획득 가능
- 게임 완료 시 상세한 결과 표시

---

### 🎮 **채집 게임 UI 개선 - 2024년 12월 23일**

**문제**:
1. 획득 아이템 목록이 길어지면 화면을 벗어남
2. 게임 화면과 결과 화면에 지뢰 현황 텍스트가 불필요함
3. 지뢰를 안 밟고 끝내면 결과 모달이 표시되지 않음

**해결 방법**:

1. **획득 아이템 스크롤 패널 구현**:
   - 획득 아이템을 별도의 스크롤 패널로 분리
   - `max-h-32 overflow-y-auto`로 높이 제한 및 세로 스크롤 적용
   - 회색 배경의 둥근 패널로 시각적 구분

2. **지뢰 현황 텍스트 제거**:
   - 게임 화면에서 "지뢰: X/Y" 텍스트 제거
   - 결과 화면에서 "지뢰 발견: X/Y" 텍스트 제거
   - 더 깔끔한 UI 제공

3. **모든 경우에 결과 모달 표시**:
   - `endGame` 함수로 게임 종료 로직 통합
   - 지뢰를 밟거나 모든 허브를 찾으면 동일한 결과 모달 표시
   - 일관된 사용자 경험 제공

**수정된 파일**:
- `src/components/life/HerbalismMinigame.tsx`: UI 개선 및 게임 종료 로직 통합

**결과**: 
- 획득 아이템 목록이 스크롤 가능한 패널로 표시
- 지뢰 현황 텍스트 제거로 더 깔끔한 UI
- 모든 게임 종료 시 일관된 결과 모달 표시
- 향상된 사용자 경험

---

### 🎮 **채집 게임 보상 타이밍 개선 - 2024년 12월 23일**

**문제**:
- 게임 완료 시 아이템과 경험치가 모두 한 번에 지급되어 중복으로 표시됨
- 아이템은 게임 중에 이미 지급되었는데 게임 종료 시 또 지급됨
- 경험치는 게임 종료 시에만 지급되어야 함

**해결 방법**:

1. **아이템 획득 타이밍 조정**:
   - 아이템은 허브 발견 시 즉시 지급 (기존 유지)
   - 게임 종료 시 아이템 중복 지급 제거
   - 결과 화면에서는 이미 지급된 아이템 목록만 표시

2. **경험치 획득 타이밍 조정**:
   - 경험치는 게임 종료 시에만 지급
   - 결과 화면이 나올 때 경험치 획득 메시지 표시
   - 중복 지급 방지

**수정된 파일**:
- `src/components/life/HerbalismMinigame.tsx`: 보상 타이밍 개선

**결과**: 
- 아이템은 허브 발견 시 즉시 획득
- 경험치는 게임 종료 시에만 획득
- 중복 지급 및 메시지 제거
- 더 명확하고 일관된 보상 시스템

---

### 🔧 **채집 게임 경험치 획득 버그 수정 - 2024년 12월 23일**

**문제**:
- 결과창에서 경험치 획득이 실제로 적용되지 않음
- `addCombatLog`만 호출하고 실제 경험치 추가 함수를 호출하지 않음

**해결 방법**:
- `endGame` 함수에서 `addLifeSkillXp` 함수 호출 추가
- 경험치 계산을 변수로 분리하여 명확성 향상
- 실제 경험치 추가와 로그 메시지 모두 정상 작동

**수정된 파일**:
- `src/components/life/HerbalismMinigame.tsx`: 경험치 획득 로직 수정

**결과**: 
- 게임 종료 시 실제로 채집 경험치가 증가
- 경험치 획득 메시지도 정상적으로 표시
- 정상적인 보상 시스템 작동

---

### 🎮 **채집 게임 보상 시스템 개선 - 2024년 12월 23일**

**문제**:
- 하나의 허브 발견에 드롭 테이블의 모든 아이템을 확인하여 확률에 따라 여러 개를 지급
- 보상이 과도하게 많아져 밸런스 문제 발생

**해결 방법**:

1. **단일 아이템 선택 시스템 구현**:
   - 하나의 허브 발견에는 드롭 테이블에서 하나의 아이템만 선택
   - 누적 확률 시스템으로 정확한 확률 분배
   - 아이템이 선택되지 않을 경우 기본 아이템(healing_herb) 지급

2. **확률 시스템 개선**:
   - `cumulativeChance`를 사용한 누적 확률 계산
   - 각 아이템의 확률을 순차적으로 더해가며 선택
   - 더 정확하고 예측 가능한 보상 시스템

**수정된 파일**:
- `src/components/life/HerbalismMinigame.tsx`: 보상 계산 로직 개선

**결과**: 
- 하나의 허브 발견에 하나의 아이템만 지급
- 밸런스가 개선된 보상 시스템
- 더 예측 가능하고 공정한 보상 분배

---

### 🎮 **채집 게임 UI 정보 추가 - 2024년 12월 23일**

**문제**:
- 게임 화면에서 총 지뢰 개수를 확인할 수 없음
- 플레이어가 게임의 난이도를 파악하기 어려움

**해결 방법**:
- 게임 정보 영역에 "지뢰: X개" 표시 추가
- 폭탄 이모지와 함께 총 지뢰 개수 표시
- 플레이어가 게임 난이도를 쉽게 파악 가능

**수정된 파일**:
- `src/components/life/HerbalismMinigame.tsx`: 게임 정보 UI 추가

**결과**: 
- 게임 화면에서 총 지뢰 개수 확인 가능
- 더 명확한 게임 정보 제공
- 향상된 사용자 경험

---

### 🔧 **채집 게임 단일 아이템 보상 시스템 수정 - 2024년 12월 23일**

**문제**:
- 허브 발견 시 여전히 여러 아이템이 지급됨
- `calculateRewards` 함수가 여러 아이템을 반환하는 구조로 인해 단일 아이템 보상이 제대로 작동하지 않음

**해결 방법**:

1. **단일 아이템 보상 함수 분리**:
   - `calculateSingleReward` 함수를 새로 생성
   - 하나의 허브 발견에 하나의 아이템만 반환
   - 게임 중 즉시 보상 지급에 사용

2. **기존 함수 유지**:
   - `calculateRewards` 함수는 게임 종료 시 결과 표시용으로 유지
   - 내부적으로 `calculateSingleReward`를 호출하여 일관성 유지

3. **보상 지급 로직 수정**:
   - 허브 발견 시 `calculateSingleReward` 호출
   - 단일 아이템만 지급하도록 수정

**수정된 파일**:
- `src/components/life/HerbalismMinigame.tsx`: 단일 아이템 보상 시스템 구현

**결과**: 
- 하나의 허브 발견에 정확히 하나의 아이템만 지급
- 게임 중 즉시 보상과 게임 종료 시 결과 표시 모두 정상 작동
- 일관된 보상 시스템 구현

---

### 🔧 **제작 시스템 재료 레벨 보너스 수정 - 2024년 12월 23일**

**문제**:
- 제작 시 재료 레벨이 높을수록 기본 점수가 낮아짐
- 고급 재료를 사용해도 품질이 떨어지는 부자연스러운 현상

**해결 방법**:

1. **재료 레벨 페널티 제거**:
   - 기존: `materialLevelPenalty = Math.max(0, (avgMaterialLevel - skillLevel) * 10)`
   - 수정: 재료 레벨 페널티 로직 완전 제거

2. **재료 레벨 보너스 추가**:
   - 새로운 로직: `materialLevelBonus = Math.min(20, avgMaterialLevel * 2)`
   - 재료 레벨이 높을수록 품질 점수 증가
   - 최대 20점까지 보너스 적용

3. **점수 계산 로직 개선**:
   - 기존: `baseQualityScore = avgMaterialQuality + skillLevelBonus - materialLevelPenalty`
   - 수정: `baseQualityScore = avgMaterialQuality + skillLevelBonus + materialLevelBonus`

**수정된 파일**:
- `src/components/life/CraftingModal.tsx`: 재료 레벨 보너스 로직 수정

**결과**: 
- 재료 레벨이 높을수록 제작 품질이 향상
- 고급 재료 사용의 의미가 명확해짐
- 더 직관적이고 공정한 제작 시스템

---

### 🔧 **채집 게임 아이템 개수 일치 수정 - 2024년 12월 23일**

**문제**:
- 허브 발견 개수보다 아이템을 더 많이 획득하는 현상
- `calculateSingleReward` 함수에서 `quantity`가 랜덤으로 설정되어 1~3개 지급
- 예: healing_herb는 min: 1, max: 3이므로 1~3개를 지급할 수 있음

**해결 방법**:
- `calculateSingleReward` 함수에서 `quantity`를 항상 1로 고정
- 허브 발견 개수와 아이템 개수를 정확히 일치시킴
- 드롭 테이블의 min/max 값은 무시하고 항상 1개씩 지급

**수정된 파일**:
- `src/components/life/HerbalismMinigame.tsx`: 아이템 개수 고정

**결과**: 
- 허브 발견 개수와 아이템 획득 개수가 정확히 일치
- 예측 가능하고 공정한 보상 시스템
- 밸런스가 개선된 채집 게임

---

### 🔧 **제작 시스템 예상 품질 표시 수정 - 2024년 12월 23일**

**문제**:
- 제작 시스템에서 예상 품질을 표시하는 부분에서 여전히 이전 로직 사용
- 재료 레벨이 높을수록 예상 품질 점수가 낮아지는 현상
- 실제 제작 로직과 예상 품질 표시가 일치하지 않음

**해결 방법**:
- 예상 품질 계산 부분에서 `materialLevelPenalty` 제거
- `materialLevelBonus` 추가하여 재료 레벨이 높을수록 점수 증가
- 실제 제작 로직과 동일한 계산 방식 적용

**수정된 파일**:
- `src/components/life/CraftingModal.tsx`: 예상 품질 계산 로직 수정

**결과**: 
- 재료 레벨이 높을수록 예상 품질 점수가 증가
- 실제 제작 결과와 예상 품질이 일치
- 더 정확하고 직관적인 제작 시스템

---

### 🔧 **채집 게임 JSON 보상 테이블 적용 - 2024년 12월 23일**

**문제**:
- 채집 게임에서 하드코딩된 드롭 테이블을 사용
- `herbalism_rewards.json` 파일의 설정이 반영되지 않음
- JSON 파일에서 `min: 1, max: 1`로 설정했지만 코드에서 무시됨

**해결 방법**:

1. **JSON 파일 로드 시스템 구현**:
   - `useEffect`를 사용하여 게임 시작 시 JSON 파일 로드
   - `fetch`를 통해 `herbalism_rewards.json` 파일 읽기
   - 로드 실패 시 기본 드롭 테이블 사용

2. **동적 드롭 테이블 적용**:
   - 하드코딩된 드롭 테이블 제거
   - JSON 파일의 `min`, `max` 값을 실제로 사용
   - `DropItem` 인터페이스 추가로 타입 안정성 확보

3. **에러 처리 개선**:
   - JSON 파일 로드 실패 시 기본 아이템 반환
   - 드롭 테이블이 비어있을 때의 처리 로직 추가

**수정된 파일**:
- `src/components/life/HerbalismMinigame.tsx`: JSON 보상 테이블 시스템 구현

**결과**: 
- `herbalism_rewards.json` 파일의 설정이 정확히 반영
- JSON 파일에서 `min: 1, max: 1`로 설정한 대로 1개씩 지급
- 설정 파일을 통한 보상 시스템 관리 가능

---

### 🎮 **광산 게임 UI 개선 - 2024년 12월 23일**

**문제**:
- 광산 게임의 UI가 이미지와 일치하지 않음
- 게임 그리드가 화면 중앙에 정렬되지 않음
- 보석 크기가 작아서 가시성이 떨어짐

**해결 방법**:

1. **게임 그리드 레이아웃 개선**:
   - 그리드를 화면 중앙에 정렬하도록 수정
   - `flex justify-center`와 `width: fit-content` 적용
   - 더 나은 시각적 균형 제공

2. **보석 크기 및 가시성 향상**:
   - 보석 크기를 `w-10 h-10`에서 `w-12 h-12`로 증가
   - 텍스트 크기를 `text-lg`에서 `text-xl`로 증가
   - 더 명확하고 클릭하기 쉬운 UI 제공

**수정된 파일**:
- `src/components/life/MiningMinigame.tsx`: UI 레이아웃 및 크기 개선

**결과**: 
- 광산 게임이 이미지와 더 일치하는 UI 제공
- 게임 그리드가 화면 중앙에 정렬
- 더 큰 보석으로 향상된 가시성과 사용성

---

### 🔧 **광산 게임 퍼즐 판 표시 버그 수정 - 2024년 12월 23일**

**문제**:
- 광산 게임을 시작해도 퍼즐 판이 표시되지 않음
- `startGame` 함수에서 `initializeGrid()`를 호출하지만 그리드 상태를 업데이트하지 않음
- 게임 시작 시 빈 화면만 표시됨

**해결 방법**:
- `startGame` 함수에서 `initializeGrid()`의 반환값을 `setGrid`로 상태 업데이트
- 게임 시작 시 그리드가 정상적으로 표시되도록 수정

**수정된 파일**:
- `src/components/life/MiningMinigame.tsx`: 게임 시작 로직 수정

**결과**: 
- 광산 게임 시작 시 퍼즐 판이 정상적으로 표시
- 게임 플레이 가능한 상태로 초기화
- 정상적인 광산 게임 기능 제공

---

### 🔧 **생활 스킬 로그 메인 로그에서 제거 - 2024년 12월 23일**

**문제**:
- 채집, 낚시, 농사, 광산 등 생활 스킬 관련 로그가 메인 전투 로그에 표시됨
- 메인 로그가 생활 스킬 메시지로 복잡해짐
- 전투 관련 핵심 정보가 묻힘

**해결 방법**:

1. **LifePanel.tsx 수정**:
   - 낚시, 농사, 광산, 채집 성공 시 `addCombatLog` 호출 제거
   - 경험치와 아이템은 여전히 정상 지급되지만 로그는 표시하지 않음

2. **HerbalismMinigame.tsx 수정**:
   - 허브 발견 시 아이템 획득 로그 제거
   - 채집 경험치 획득 로그 제거
   - 보상은 정상 지급되지만 로그는 표시하지 않음

3. **FishingMinigame.tsx 수정**:
   - 낚시 보상 획득 로그 제거
   - 스킬 페이지 획득 로그 제거
   - 보상은 정상 지급되지만 로그는 표시하지 않음

**수정된 파일**:
- `src/components/life/LifePanel.tsx`: 생활 스킬 로그 제거
- `src/components/life/HerbalismMinigame.tsx`: 채집 로그 제거
- `src/components/life/FishingMinigame.tsx`: 낚시 로그 제거

**결과**: 
- 메인 전투 로그가 생활 스킬 메시지로 복잡해지지 않음
- 전투 관련 핵심 정보만 표시
- 생활 스킬 보상은 정상 지급되지만 로그는 표시하지 않음
- 더 깔끔하고 직관적인 로그 시스템

---

### 🔧 **광산 게임 연쇄 매칭 시스템 추가 - 2024년 12월 23일**

**문제**:
- 광산 게임에서 3개 매칭 후 새로운 보석이 떨어져도 자동으로 연쇄 매칭이 되지 않음
- 한 번의 이동으로 여러 매칭이 발생해도 점수에 반영되지 않음
- 게임의 재미와 전략성이 부족함

**해결 방법**:
- `dropNewGems` 함수에 연쇄 매칭 확인 로직 추가
- 새로운 보석이 떨어진 후 자동으로 `checkAndRemoveMatches` 함수 호출
- 300ms 지연 후 연쇄 매칭 확인하여 자연스러운 애니메이션 효과 제공

**수정된 파일**:
- `src/components/life/MiningMinigame.tsx`: 연쇄 매칭 시스템 추가

**결과**: 
- 3개 매칭 후 새로운 보석이 떨어지면 자동으로 연쇄 매칭 확인
- 연쇄 매칭으로 인한 추가 점수 획득
- 더 전략적이고 재미있는 게임 플레이
- 한 번의 이동으로 여러 매칭이 가능한 시스템

---

### 🔧 **광산 게임 드랍 테이블 시스템 및 보상 개선 - 2024년 12월 23일**

**문제**:
- 광산 게임에서 고정된 보상만 지급됨
- 채집 게임과 달리 드랍 테이블 시스템이 없음
- 게임 완료 시 보상과 경험치가 명확히 표시되지 않음

**해결 방법**:

1. **드랍 테이블 시스템 추가**:
   - `src/data/drops/mining_rewards.json` 파일 생성
   - 광산 관련 재료와 스킬 페이지 포함
   - 채집 게임과 동일한 구조로 드랍 테이블 구현

2. **MiningMinigame.tsx 수정**:
   - `skillLevel` prop 추가
   - 드랍 테이블 로드 및 보상 계산 함수 추가
   - 매칭 시 즉시 보상 지급 시스템 구현
   - 게임 종료 시 결과 화면 개선

3. **보상 시스템 개선**:
   - 매칭된 보석마다 즉시 아이템 지급
   - 채광 레벨에 따른 아이템 레벨 계산
   - 경험치는 게임 종료 시 한 번에 지급

4. **결과 화면 개선**:
   - 획득한 아이템 목록 표시
   - 경험치 획득량 표시
   - 스크롤 가능한 보상 목록

5. **LifePanel.tsx 수정**:
   - 광산 게임에 `skillLevel` prop 전달
   - 기존 보상 로직 제거 (미니게임 내에서 처리)

**수정된 파일**:
- `src/data/drops/mining_rewards.json`: 광산 드랍 테이블 생성
- `src/components/life/MiningMinigame.tsx`: 드랍 테이블 시스템 및 보상 개선
- `src/components/life/LifePanel.tsx`: skillLevel prop 전달

**결과**: 
- 광산 게임에서 드랍 테이블 기반 보상 시스템
- 매칭 시 즉시 아이템 획득
- 게임 종료 시 명확한 결과 화면
- 채집 게임과 일관된 보상 시스템
- 더 풍부하고 다양한 보상 체계

---

### 🎮 **미니게임 및 생활 시스템 개선 - 2024년 12월 23일**

**문제**:
1. 채집 미니게임 모달에서 밖을 눌러도 닫히지 않음
2. 낚시 미니게임 점수가 소수점으로 표시됨
3. 낚시 미니게임 결과에 획득 아이템과 스킬 수련치가 표시되지 않음
4. 낚시 게임 완료 버튼을 눌렀을 때 아이템을 획득하지 않음
5. 농사에서 농작물 관련 행동을 할 때마다 게임이 저장되지 않음
6. 제작, 연금술, 요리에서 제작 완료 시 상세 정보가 표시되지 않음
7. 생활 탭의 패널이 밑부분이 잘려보임
8. 낚시 미니게임에서 완료 버튼을 눌러야 아이템을 획득함
9. 낚시 미니게임에 보상 테이블이 없어 확률적 보상이 없음
10. 스태미나 관련 코드가 남아있어 문제 발생
11. index.ts와 개별 파일들이 겹쳐서 설정이 혼란스러움
12. 환생 포인트가 0으로 시작함
13. 스킬 패널에 레벨업 버튼이 조건 미충족 시 표시되지 않음
14. 스킬 탭 첫 페이지가 불속성으로 설정됨

**해결 방법**:

1. **채집 미니게임 모달 개선**:
   - `src/components/life/HerbalismMinigame.tsx`에서 모달 밖 클릭 시 닫히도록 수정
   - `onClick={onClose}` 추가

2. **낚시 미니게임 점수 정수 처리**:
   - `src/components/life/FishingMinigame.tsx`에서 점수 계산을 정수로 처리
   - `Math.floor()` 함수 사용하여 소수점 제거
   - 결과 표시에서도 `Math.floor(score)` 사용

3. **낚시 미니게임 결과 표시 개선**:
   - 게임 완료 시 획득 보상 섹션 추가
   - 생선 개수와 낚시 경험치 표시
   - 퍼펙트 여부에 따른 보상 차등 표시

4. **낚시 게임 아이템 획득 수정**:
   - 게임이 끝나고 결과가 나올 때 아이템을 획득하도록 수정
   - `onComplete` 함수 호출 시점 조정

5. **농사 시스템 자동 저장**:
   - `src/components/life/FarmingSystem.tsx`에 `useGameStore` import 추가
   - 씨앗 심기, 물주기, 수확 시 `saveGame()` 호출
   - 농작물 관련 모든 행동 후 자동 저장

6. **제작 시스템 상세 정보 표시**:
   - `src/components/life/CraftingModal.tsx`에 제작 완료 결과 모달 추가
   - 제작된 아이템의 품질, 레벨, 수량 표시
   - 획득 경험치 표시
   - 제작 완료 후 게임 저장 기능 추가

7. **생활 패널 레이아웃 수정**:
   - `src/components/life/LifePanel.tsx`에서 상점 패널 참고하여 레이아웃 수정
   - `max-h-[calc(100vh-12rem)]`로 변경하여 밑부분 잘림 현상 해결

8. **낚시 미니게임 보상 시스템 개선**:
   - 게임 완료 시 바로 보상 지급하도록 수정
   - 보상 테이블 추가 (물고기, 보석, 스킬 페이지)
   - 스킬 레벨과 게임 성공도에 따른 확률적 보상
   - 완료 버튼을 다시하기 버튼으로 변경

9. **스태미나 관련 코드 삭제**:
   - `src/data/items/stamina_potion.json` 파일 삭제
   - `src/data/initial/index.ts`와 `src/data/initial/inventory.json`에서 스태미나 포션 제거
   - `src/components/life/CraftingModal.tsx`에서 연금술 레시피에서 스태미나 포션 제거

10. **초기 데이터 파일 구조 개선**:
    - `src/data/initial/index.ts` 백업 후 삭제
    - `src/stores/index.ts`에서 개별 JSON 파일 import로 변경
    - `src/data/initial/character.json`에 base 스탯 추가

11. **환생 포인트 초기값 설정**:
    - `src/data/initial/character.json`에서 `ascensionPoints: 20`으로 설정

12. **스킬 패널 레벨업 버튼 개선**:
    - `src/components/character/CharacterPanel.tsx`에서 조건 미충족 시에도 비활성화된 버튼 표시
    - 버튼 스타일을 활성화/비활성화 상태에 따라 변경

13. **스킬 탭 기본 속성 변경**:
    - `src/components/character/CharacterPanel.tsx`에서 `selectedElement` 초기값을 'All'로 변경

14. **낚시 미니게임 보상 시스템 버그 수정**:
    - `src/components/life/FishingMinigame.tsx`에서 무한 루프 오류 수정 (useEffect 의존성 배열에서 onComplete 제거)
    - 보상 지급 함수 추가하여 실제 인벤토리에 아이템 추가
    - 게임 완료 시 자동 저장 기능 추가
    - 콘솔 로그 추가로 보상 지급 과정 추적 가능

15. **새 게임 시작 시 생활 스킬 초기화 문제 수정**:
    - `src/stores/index.ts`의 `startNewGame` 함수에서 `life` 상태 초기화 추가
    - 모든 생활 스킬을 레벨 1, 경험치 0으로 초기화
    - 제작, 연금술, 요리는 해금 상태, 나머지는 잠금 상태로 설정

16. **아이템 상세 정보 및 한글 이름 표시 개선**:
    - `src/components/common/ItemDetailModal.tsx`에서 아이템 데이터 로딩 기능 추가
    - 아이템 상세 정보에서 한글 이름과 설명을 올바르게 표시
    - `src/utils/itemSystem.ts`에 `getItemName` 함수 추가
    - 전투 로그, 판매 로그에서 한글 이름 사용
    - `src/stores/index.ts`에서 드롭 아이템 로그에 한글 이름 적용
    - `src/components/inventory/SellModal.tsx`에서 판매 로그에 한글 이름 적용

17. **인벤토리 한글 이름 표시 및 낚시 보상 시스템 개선**:
    - `src/components/inventory/InventoryPanel.tsx`에서 아이템 이름 로딩 기능 추가
    - 인벤토리에서 한글 이름 표시
    - `src/data/drops/fishing_rewards.json` 낚시 보상 테이블 생성
    - `src/components/life/FishingMinigame.tsx`에서 드롭 테이블 기반 보상 시스템 적용
    - 스킬 레벨과 점수에 따른 아이템 레벨 보정 시스템 구현
    - 스킬 페이지는 레벨 보정 없이 획득

18. **낚시 결과 레벨 표시 및 디버깅 개선**:
    - `src/components/life/FishingMinigame.tsx`에서 획득 아이템 레벨 표시 추가
    - 보상 계산 과정의 디버깅 로그 추가
    - 아이템 생성 시 레벨 정보 로그 출력
    - 전투 로그에 아이템 레벨 정보 표시

19. **아이템 레벨별 관리 시스템 개선**:
    - `src/stores/index.ts`에서 `addMaterial` 함수를 레벨별로 별도 관리하도록 수정
    - `removeMaterial` 함수에 레벨 매개변수 추가
    - `src/components/inventory/InventoryPanel.tsx`에서 재료를 레벨별로 구분하여 표시
    - 같은 아이템이라도 레벨이 다르면 별도 아이템으로 관리
    - 인벤토리에서 레벨별로 정확한 아이템 정보 표시

20. **재료 상세 모달 오류 수정 및 레벨 표시 개선**:
    - `src/components/inventory/InventoryPanel.tsx`에서 displayId 파싱 로직 수정
    - `src/stores/index.ts`에서 소모품도 레벨별로 관리하도록 수정
    - `src/components/common/ItemDetailModal.tsx`에서 아이템 레벨 표시 추가
    - 재료, 장비, 소모품 모두 상세 모달에서 레벨 정보 표시
    - 소모품도 레벨별로 별도 관리되도록 개선

21. **낚시 보상 한글화 및 스킬 로그 개선**:
    - `src/components/life/FishingMinigame.tsx`에서 낚시 보상 결과에 한글 이름 표시
    - `src/stores/index.ts`에서 스킬 관련 로그에 한글 이름 사용
    - 스킬 페이지 획득, 스킬 해금, 스킬 레벨업 로그에 한글 이름 표시
    - 스킬 경험치 획득 로그에 한글 이름 표시

22. **물약 시스템 개선 및 제작 시스템 개선**:
    - `src/data/items/health_potion.json`, `src/data/items/mana_potion.json` 수정하여 연금술로 제작 가능하도록 변경
    - `src/data/items/greater_health_potion.json`, `src/data/items/greater_mana_potion.json` 삭제
    - `src/components/life/CraftingModal.tsx`에서 재료 선택 시 수량 표시 및 레벨별 정렬 개선
    - 제작 시 실제 필요한 재료 개수만큼만 감소하도록 수정
    - `src/components/inventory/SellModal.tsx`에서 일괄 판매 시 장비 분류 오류 수정

23. **소모품 인벤토리 구조 개선**:
    - `src/stores/index.ts`에서 초기 소모품을 `inventory.items`에 통합
    - `src/components/inventory/InventoryPanel.tsx`에서 소모품 표시 로직 수정
    - 소모품 클릭 시 상세 모달 오류 해결
    - 소모품과 장비를 모두 `inventory.items`에서 관리하도록 통합

24. **재료 선택 UI 개선**:
    - `src/components/life/CraftingModal.tsx`에서 재료 선택 시 각 레벨별 개수 표시
    - 전체 보유량 대신 레벨별 개수 정보 제공
    - 재료 선택 시 더 정확한 정보 표시

25. **재료 이름 한글화**:
    - `src/components/life/CraftingModal.tsx`에서 재료 이름을 한글로 표시
    - 레시피 목록과 재료 선택 모달에서 모두 한글 이름 사용
    - `getItemName` 함수를 활용하여 재료의 한글 이름 로드

26. **재료 선택 UI 개선 (레벨별 개수 표시)**:
    - `src/components/life/CraftingModal.tsx`에서 재료 선택 버튼에 레벨별 개수 표시
    - 레벨과 품질이 같은 재료들을 그룹화하여 개수 표시
    - 재료 선택 시 더 정확한 정보 제공

27. **제작 스킬 레벨 제한 제거**:
    - `src/components/life/CraftingModal.tsx`에서 제작 스킬 레벨 제한 제거
    - `canCraft` 함수에서 스킬 레벨 체크 로직 제거
    - 레시피 목록에서 스킬 레벨 부족 메시지 제거
    - 모든 제작이 재료만 있으면 가능하도록 수정

28. **재료 선택 UI 개선 (가로 스크롤 및 단일 레벨 선택)**:
    - `src/components/life/CraftingModal.tsx`에서 재료 선택을 가로 스크롤 방식으로 변경
    - 한 레벨의 재료만 선택할 수 있도록 수정 (여러 레벨 합산 불가)
    - 재료 레벨 평균 계산을 정수로 표시하도록 수정
    - 재료 소비 로직 개선으로 정확한 개수만큼 소비되도록 수정

29. **재료 선택 시스템 버그 수정**:
    - `src/components/life/CraftingModal.tsx`에서 재료 선택 초기화 시 선택되지 않은 상태로 시작
    - 필요한 개수보다 적은 재료는 선택할 수 없도록 제한
    - 재료 소비 로직 수정으로 정확한 개수만큼 소비되도록 개선
    - 선택 불가능한 재료는 빨간색 테두리로 표시

30. **제작 시스템 개선 및 버그 수정**:
    - `src/components/life/CraftingModal.tsx`에서 NaN 문제 해결 (선택된 재료가 없을 때 스킬 레벨 사용)
    - 레시피 목록에서 재료 보유량을 각 레벨별 최대 개수로 표시
    - 제작 가능 여부 판단을 각 레벨별 최대 개수 기준으로 변경
    - 재료 소비 로직에 디버깅 로그 추가

31. **제작 버튼 제한 및 사용자 안내 개선**:
    - `src/components/life/CraftingModal.tsx`에서 모든 재료가 선택되지 않으면 제작 버튼 비활성화
    - 재료 선택이 완료되지 않았을 때 경고 메시지 표시
    - 제작 버튼 클릭 시 재료 선택 완료 여부 확인

32. **제작 시스템 안전장치 강화**:
    - `src/components/life/CraftingModal.tsx`에서 executeCrafting 함수에 재료 선택 완료 여부 확인 로직 추가
    - 재료 선택 과정에 디버깅 로그 추가
    - 모든 재료가 선택되지 않으면 제작 중단 및 경고 메시지 출력

**수정된 파일**:
- `src/components/life/HerbalismMinigame.tsx`
- `src/components/life/FishingMinigame.tsx`
- `src/components/life/FarmingSystem.tsx`
- `src/components/life/CraftingModal.tsx`
- `src/components/life/LifePanel.tsx`
- `src/components/character/CharacterPanel.tsx`
- `src/data/initial/character.json`
- `src/stores/index.ts`
- `src/data/items/stamina_potion.json` (삭제)
- `src/data/items/greater_health_potion.json` (삭제)
- `src/data/items/greater_mana_potion.json` (삭제)
- `src/data/initial/index.ts` (백업 후 삭제)
- `src/components/common/ItemDetailModal.tsx`
- `src/utils/itemSystem.ts`
- `src/components/inventory/SellModal.tsx`
- `src/components/inventory/InventoryPanel.tsx`
- `src/data/drops/fishing_rewards.json`
- `src/data/items/health_potion.json`
- `src/data/items/mana_potion.json`
- `src/data/initial/inventory.json`

**문제**:
1. 채집 미니게임 모달에서 밖을 눌러도 닫히지 않음
2. 낚시 미니게임 점수가 소수점으로 표시됨
3. 낚시 미니게임 결과에 획득 아이템과 스킬 수련치가 표시되지 않음
4. 낚시 게임 완료 버튼을 눌렀을 때 아이템을 획득하지 않음
5. 농사에서 농작물 관련 행동을 할 때마다 게임이 저장되지 않음
6. 제작, 연금술, 요리에서 제작 완료 시 상세 정보가 표시되지 않음
7. 생활 탭의 패널이 밑부분이 잘려보임

**해결 방법**:

1. **채집 미니게임 모달 개선**:
   - `src/components/life/HerbalismMinigame.tsx`에서 모달 밖 클릭 시 닫히도록 수정
   - `onClick={onClose}` 추가

2. **낚시 미니게임 점수 정수 처리**:
   - `src/components/life/FishingMinigame.tsx`에서 점수 계산을 정수로 처리
   - `Math.floor()` 함수 사용하여 소수점 제거
   - 결과 표시에서도 `Math.floor(score)` 사용

3. **낚시 미니게임 결과 표시 개선**:
   - 게임 완료 시 획득 보상 섹션 추가
   - 생선 개수와 낚시 경험치 표시
   - 퍼펙트 여부에 따른 보상 차등 표시

4. **낚시 게임 아이템 획득 수정**:
   - 게임이 끝나고 결과가 나올 때 아이템을 획득하도록 수정
   - `onComplete` 함수 호출 시점 조정

5. **농사 시스템 자동 저장**:
   - `src/components/life/FarmingSystem.tsx`에 `useGameStore` import 추가
   - 씨앗 심기, 물주기, 수확 시 `saveGame()` 호출
   - 농작물 관련 모든 행동 후 자동 저장

6. **제작 시스템 상세 정보 표시**:
   - `src/components/life/CraftingModal.tsx`에 제작 완료 결과 모달 추가
   - 제작된 아이템의 품질, 레벨, 수량 표시
   - 획득 경험치 표시
   - 제작 완료 후 게임 저장 기능 추가

7. **생활 패널 레이아웃 수정**:
   - `src/components/life/LifePanel.tsx`에서 상점 패널 참고하여 레이아웃 수정
   - `max-h-[calc(100vh-12rem)]`로 변경하여 밑부분 잘림 현상 해결

**수정된 파일**:
- `src/components/life/HerbalismMinigame.tsx`
- `src/components/life/FishingMinigame.tsx`
- `src/components/life/FarmingSystem.tsx`
- `src/components/life/CraftingModal.tsx`
- `src/components/life/LifePanel.tsx`

---

### 🔧 **스킬 시스템 완전 개편 및 아이템 판매 시스템 구현 - 2024년 12월 23일**

**문제**: 
1. 스킬 탭에서 수련치 게이지가 반영되지 않음
2. 속성별 필터링 버튼이 너무 큼
3. 스킬 발동 확률이 정수로만 표시됨
4. 품질에 따른 발동 확률 제한이 없음
5. 레벨업 시 최대 경험치가 스킬별로 다르지 않음
6. 아이템 판매 시스템이 없음
7. 스킬 탭에서 미습득 스킬이 위에 표시됨
8. 개별 판매 방식이 불편함
9. 일괄 판매 버튼이 작동하지 않음
10. 메인 UI에서 상태 텍스트가 불필요함
11. 스킬 발동률 증가 수치가 소수점이 너무 길게 표시됨
12. 스킬 대미지 계산 시스템이 없음
13. 스킬 레벨업 시스템이 골드 기반임
14. 스킬 대미지가 "계산 불가"로 표시됨
15. 아이템 상세 모달에 판매 가격이 표시되지 않음
16. 일괄판매가 장비만 가능함
17. 레벨 필터링이 최소 레벨로 설정됨
18. 개별 판매 방식이 복잡함

**원인**: 
- 게이지 계산에서 `maxXp`가 0일 때 문제 발생
- 필터링 버튼 크기가 인벤토리와 일치하지 않음
- 발동 확률이 소수점을 지원하지 않음
- 스킬별 품질 차이가 반영되지 않음
- `baseMaxExp` 시스템이 없음
- 아이템 판매 기능이 구현되지 않음
- 스킬 정렬 로직이 잘못됨
- 개별 판매가 뱃지 방식으로 구현됨
- 일괄 판매 모달 로직에 오류가 있음
- UI가 복잡하고 불필요한 정보가 표시됨
- `perLevel` 계산 결과가 소수점 한 자리로 제한되지 않음
- 스킬 대미지 계산 정보가 없음
- 레벨업 시스템이 골드 기반으로 설계됨
- 스킬 데이터에 `damageCalculation` 필드가 없음
- 아이템 상세 모달에 판매 가격 표시 로직이 없음
- 일괄판매 필터링이 제한적임
- 레벨 필터링 로직이 잘못됨
- 개별 판매 UI가 복잡함

**해결 방법**:
1. **게이지 반영 수정**: 
   - 게이지 계산에서 `maxXp` 기본값을 100으로 설정
   - 정확한 경험치 비율 계산

2. **필터링 버튼 크기 조정**:
   - 인벤토리와 동일한 크기로 조정
   - 이모지와 텍스트 크기 축소
   - 속성 이름 텍스트 제거

3. **스킬 발동 확률 개선**:
   - 소수점 발동 확률 지원 (예: 8.5%)
   - 품질에 따른 최대 발동 확률 제한:
     - 노말: 40% 이하, 레벨당 +2.0% 이하
     - 레어: 35% 이하, 레벨당 +1.8% 이하
     - 에픽: 30% 이하, 레벨당 +1.5% 이하
     - 레전더리: 25% 이하, 레벨당 +1.2% 이하

4. **스킬별 경험치 시스템**:
   - `baseMaxExp` 필드 추가
   - 레벨업마다 `baseMaxExp * 1.2^(레벨-1)`로 최대 경험치 증가
   - 스킬별로 다른 기본 경험치 설정

5. **스킬 정렬 개선**:
   - 습득한 스킬을 위로 정렬
   - 미습득 스킬을 아래로 정렬

6. **아이템 판매 시스템 개선**:
   - 개별 판매를 버튼 방식으로 변경
   - 아이템 선택 → 수량 선택 → 판매 순서로 개선
   - 일괄 판매 모달 로직 수정
   - 레벨, 품질, 강화도에 따른 가격 차등 적용

7. **UI 간소화**:
   - 메인 UI에서 전투 상태 텍스트 제거
   - 자동 전투 진행 상태 텍스트 제거
   - 깔끔하고 직관적인 인터페이스 구현

8. **스킬 발동률 표시 개선**:
   - 다음 레벨 발동률을 소수점 한 자리로 제한
   - 발동률 증가 수치를 소수점 한 자리로 제한

9. **스킬 대미지 시스템 구현**:
   - `damageCalculation` 필드 추가 (baseMagicAtk, basePhysicalAtk, levelScaling, elementalBonus)
   - 스킬별 대미지 계산 함수 구현
   - 스킬 상세 모달에 대미지 정보 표시

10. **스킬 레벨업 시스템 개선**:
    - 골드 기반에서 AP 기반으로 변경
    - `levelUpCost` 필드 추가 (baseAp, apScaling)
    - 레벨업 버튼을 우상단으로 이동
    - 스킬별로 다른 AP 비용 설정

11. **스킬 대미지 계산 수정**:
    - 스킬 데이터에 `damageCalculation` 필드 추가
    - 대미지 계산 로직 개선
    - 모든 스킬에 대미지 정보 설정

12. **아이템 상세 모달 개선**:
    - 모든 아이템에 판매 가격 표시
    - 강화, 레벨, 품질을 고려한 가격 계산

13. **일괄판매 시스템 개선**:
    - 모든 아이템 타입 지원 (재료, 장비, 소모품)
    - 레벨 필터링을 최대 레벨로 변경
    - 필터링 로직 개선

14. **개별 판매 방식 개선**:
    - 판매 모드 활성화 방식으로 변경
    - 아이템 클릭 시 판매 모달 표시
    - 더 직관적인 UI 구현

**수정된 파일**:
- `src/components/character/CharacterPanel.tsx`: 게이지 계산 수정, 필터링 버튼 크기 조정, 스킬 정렬 개선, 레벨업 버튼 위치 변경, AP 시스템 적용
- `src/data/skills/*.json`: 모든 스킬에 소수점 발동 확률, baseMaxExp, damageCalculation, levelUpCost 추가
  - `fireball.json`, `ice_shard.json`, `basic_attack.json`, `flame_aura.json`: 완료
  - `ember_toss.json`, `frost_bite.json`, `thunder_shock.json`, `thunder_roar.json`: 완료
  - `shadow_bite.json`, `dark_howl.json`, `toxic_spit.json`, `venom_burst.json`: 완료
  - `nature_blessing.json`, `verdant_charge.json`: 완료
- `src/stores/index.ts`: 레벨업 시스템에 baseMaxExp 적용
- `src/components/common/SkillDetailModal.tsx`: 소수점 발동 확률 표시, 발동률 증가 수치 소수점 제한, 대미지 정보 표시, 대미지 계산 로직 수정, 동적 스킬 데이터 로딩 구현
- `src/components/common/ItemDetailModal.tsx`: 모든 아이템에 판매 가격 표시 추가
- `src/utils/skillSystem.ts`: 스킬 대미지 계산 함수 추가
- `src/utils/itemSystem.ts`: 아이템 판매 가격 계산 함수 추가, 안전한 itemId 체크 로직 추가
- `src/components/inventory/SellModal.tsx`: 판매 모달 컴포넌트 개선, 레벨 필터링 수정, 모든 아이템 타입 지원, 재료 필터 추가, 일괄 판매 로직 수정, 디버깅 로그 추가, 아이템 수량 표시, 전체 아이템 로딩 로직 개선
- `src/components/inventory/InventoryPanel.tsx`: 개별 판매 버튼 제거, 일괄 판매만 유지
- `src/components/common/ItemDetailModal.tsx`: 아이템 상세 모달에 판매 기능 추가, 수량 선택 가능한 판매 모달 구현, 재료/소모품 판매 지원 개선, 디버깅 로그 및 강제 판매 버튼 추가
- `src/components/layout/MainView.tsx`: 상태 텍스트 제거로 UI 간소화

**결과**: 
- 스킬 탭에서 정확한 수련치 게이지 표시
- 인벤토리와 일관된 필터링 버튼 크기
- 소수점 발동 확률 표시 (예: 8.5%)
- 품질에 따른 발동 확률 제한으로 밸런스 개선
- 스킬별로 다른 경험치 시스템으로 다양성 증가
- 습득한 스킬이 위에 표시되어 사용성 개선
- 완전한 아이템 판매 시스템 구현
- 개별/일괄 판매 기능으로 편의성 향상
- 직관적인 개별 판매 방식으로 사용성 개선
- 깔끔한 메인 UI로 가독성 향상
- 정확한 소수점 표시로 가독성 향상
- 정교한 스킬 대미지 계산 시스템 구현
- AP 기반 레벨업 시스템으로 밸런스 개선
- 정확한 스킬 대미지 정보 표시
- 모든 아이템에 판매 가격 표시
- 완전한 일괄판매 시스템 (모든 아이템 타입 지원)
- 직관적인 개별 판매 모드 시스템

---

### 🔧 **스킬 수련치 반영 문제 해결 - 2024년 12월 23일**

**문제**: 
1. 스킬 수련치 획득 로그는 나오지만 스킬 탭에서 경험치가 반영되지 않음
2. 스킬 상세 모달에서 경험치가 업데이트되지 않음
3. `maxXp`가 0으로 설정되어 경험치 계산이 잘못됨

**원인**: 
- `addSkillTrainingXp` 함수에서 `maxXp` 기본값이 0으로 설정
- 스킬 상세 모달에서 경험치 업데이트가 실시간으로 반영되지 않음
- 스킬 정보 업데이트 로직이 불완전함

**해결 방법**:
1. **스킬 수련치 계산 수정**: 
   - `addSkillTrainingXp`에서 `maxXp` 기본값을 100으로 설정
   - 경험치 계산 로직 개선

2. **스킬 상세 모달 실시간 업데이트**:
   - 스킬 정보 업데이트를 위한 `useEffect` 추가
   - 경험치, 레벨, 최대 경험치 실시간 반영

**수정된 파일**:
- `src/stores/index.ts`: `addSkillTrainingXp` 함수에서 `maxXp` 기본값 수정
- `src/components/common/SkillDetailModal.tsx`: 스킬 정보 실시간 업데이트 로직 추가

**결과**: 
- 스킬 수련치가 정확히 반영됨
- 스킬 탭에서 실시간 경험치 표시
- 스킬 상세 모달에서 실시간 경험치 업데이트
- 정확한 경험치 계산 및 표시

---

### 🔧 **스킬 경험치 표시 수정 및 속성별 분류 개선 - 2024년 12월 23일**

**문제**: 
1. 스킬 경험치를 획득했다는 로그는 나오지만 스킬 탭에서 경험치가 0/0으로 표시됨
2. 스킬 상세 모달에서 경험치가 0/100에서 변경되지 않음
3. 속성별 스킬 탭이 단순한 텍스트로 표시되어 가시성이 떨어짐

**원인**: 
- 스킬 탭에서 `maxXp`가 0으로 설정되어 경험치 표시가 잘못됨
- 스킬 상세 모달에서 실제 스킬 데이터를 로드하지 않음
- 속성별 분류가 인벤토리 재료처럼 이모지로 표시되지 않음

**해결 방법**:
1. **스킬 경험치 표시 수정**: 
   - 스킬 탭에서 `maxXp` 기본값을 100으로 설정
   - 스킬 상세 모달에서 실제 스킬 데이터 로드 추가

2. **속성별 분류 개선**:
   - 속성별 스킬 탭을 인벤토리 재료처럼 이모지로 표시
   - 각 속성별 색상과 이모지 추가
   - 더 직관적인 UI 제공

**수정된 파일**:
- `src/components/character/CharacterPanel.tsx`: 스킬 경험치 표시 수정, 속성별 분류 이모지 추가
- `src/components/common/SkillDetailModal.tsx`: 스킬 데이터 로드 및 정보 업데이트 추가

**결과**: 
- 스킬 탭에서 정확한 경험치 표시 (예: 25/100)
- 스킬 상세 모달에서 실제 스킬 데이터 기반 정보 표시
- 속성별 스킬 분류가 이모지와 색상으로 직관적으로 표시
- 인벤토리 재료와 일관된 UI 경험

---

### 🔧 **스킬 발동률 수정 및 저장 시스템 개선 - 2024년 12월 23일**

**문제**: 
1. 파이어볼의 기본 확률이 90%인데도 스킬이 발동되지 않음
2. 주기적 저장이 계속 발생하여 성능에 영향을 줌
3. 전투 로직에서 스킬 발동률 계산이 잘못됨

**원인**: 
- `processPlayerSkills`에서 초기 스킬 데이터의 `triggerChance`를 사용
- 실제 스킬 데이터 파일의 발동률을 고려하지 않음
- 주기적 저장이 5초마다 실행되어 불필요한 저장 발생

**해결 방법**:
1. **스킬 발동률 계산 수정**: 
   - `processPlayerSkills`에서 실제 스킬 데이터 파일의 `triggerChance` 사용
   - 레벨에 따른 발동률 계산 추가
   - 기본 공격은 100% 발동률로 고정

2. **저장 시스템 개선**:
   - 주기적 저장(5초마다) 제거
   - 몬스터 처치 시에만 저장하도록 변경
   - 불필요한 로그 제거

**수정된 파일**:
- `src/utils/combatEngine.ts`: 스킬 발동률 계산 로직 수정
- `src/stores/index.ts`: 주기적 저장 제거, 몬스터 처치 시 저장 추가

**결과**: 
- 파이어볼이 90% 확률로 정상 발동됨
- 모든 스킬이 실제 데이터 기반 발동률로 작동
- 불필요한 주기적 저장 제거로 성능 향상
- 몬스터 처치 시에만 저장되어 효율적인 저장 시스템

---

### 🔧 **스킬 시스템 완전 개편 - 2024년 12월 23일**

**문제**: 
1. 모든 스킬 데이터가 품질에 맞게 설정되지 않음
2. 캐릭터창의 스킬 탭에서 모든 스킬을 해금할 수 없음
3. 스킬 필터링 및 정렬 기능이 부족함
4. 미습득 스킬이 위로 오지 않음

**원인**: 
- 일부 스킬 데이터가 이전 구조를 사용
- 스킬 해금 시스템이 제한적
- 스킬 UI가 단순한 구조

**해결 방법**:
1. **모든 스킬 데이터 품질 개선**: 
   - 모든 스킬을 새로운 `triggerChance` 구조로 통일
   - 품질에 맞는 발동률 설정:
     - `fireball`: 기본 90%, 레벨당 +5%, 최대 90%
     - `ice_shard`: 기본 10%, 레벨당 +4%, 최대 85%
     - `flame_aura`: 기본 10%, 레벨당 +6%, 최대 95%
     - `frost_bite`: 기본 15%, 레벨당 +5%, 최대 80%
     - `ember_toss`: 기본 10%, 레벨당 +8%, 최대 95%
     - `thunder_shock`: 기본 20%, 레벨당 +6%, 최대 85%
     - `thunder_roar`: 기본 15%, 레벨당 +7%, 최대 90%
     - `shadow_bite`: 기본 25%, 레벨당 +5%, 최대 85%
     - `dark_howl`: 기본 20%, 레벨당 +6%, 최대 90%
     - `toxic_spit`: 기본 30%, 레벨당 +4%, 최대 80%
     - `venom_burst`: 기본 25%, 레벨당 +7%, 최대 95%
     - `nature_blessing`: 기본 20%, 레벨당 +5%, 최대 85%
     - `verdant_charge`: 기본 25%, 레벨당 +4%, 최대 80%

2. **캐릭터창 스킬 탭 개선**:
   - 모든 스킬을 해금 가능하도록 개선
   - 스킬 필터링 탭 추가: 모든 스킬, 습득한 스킬, 미습득 스킬, 속성별 스킬
   - 미습득 스킬이 위로 오도록 정렬
   - 스킬 페이지 기반 해금 시스템

3. **스킬 UI 개선**:
   - 스킬 타입과 속성 표시
   - 해금 버튼과 레벨업 버튼 분리
   - 미습득 스킬에 노란색 테두리 표시

**수정된 파일**:
- `src/data/skills/frost_bite.json`: 새로운 `triggerChance` 구조로 변경
- `src/data/skills/thunder_shock.json`: 새로운 `triggerChance` 구조로 변경
- `src/data/skills/thunder_roar.json`: 새로운 `triggerChance` 구조로 변경
- `src/data/skills/shadow_bite.json`: 새로운 `triggerChance` 구조로 변경
- `src/data/skills/dark_howl.json`: 새로운 `triggerChance` 구조로 변경
- `src/data/skills/toxic_spit.json`: 새로운 `triggerChance` 구조로 변경
- `src/data/skills/venom_burst.json`: 새로운 `triggerChance` 구조로 변경
- `src/data/skills/nature_blessing.json`: 새로운 `triggerChance` 구조로 변경
- `src/data/skills/verdant_charge.json`: 새로운 `triggerChance` 구조로 변경
- `src/components/character/CharacterPanel.tsx`: 스킬 탭 완전 개편

**결과**: 
- 모든 스킬이 품질에 맞는 발동률로 설정됨
- 캐릭터창에서 모든 스킬을 해금 가능
- 스킬 필터링 및 정렬 기능 추가
- 미습득 스킬이 위로 정렬되어 가시성 향상
- 스킬 페이지 기반 해금 시스템으로 게임 진행에 따른 스킬 해금

---

### 🔧 **스킬 발동률 시스템 개선 - 2024년 12월 23일**

**문제**: 
1. 각 스킬마다 기본 발동 확률, 레벨당 상승 확률, 최대 발동 확률을 설정할 수 없음
2. 스킬 상세 모달에서 발동률이 항상 10%로 표시됨
3. 기존 `triggerChanceLevels` 배열 방식이 복잡하고 유연하지 않음

**원인**: 
- 스킬 데이터 구조가 `baseTriggerChance`와 `triggerChanceLevels` 배열 방식 사용
- 레벨당 상승 확률과 최대 발동 확률을 명시적으로 설정할 수 없음
- 스킬 상세 모달에서 하드코딩된 발동률 계산 로직 사용

**해결 방법**:
1. **스킬 데이터 구조 개선**: 
   - `triggerChance` 객체로 변경: `{ base, perLevel, max }`
   - `base`: 기본 발동 확률
   - `perLevel`: 레벨당 상승 확률
   - `max`: 최대 발동 확률

2. **스킬 상세 모달 개선**:
   - 새로운 데이터 구조에 맞는 발동률 계산 로직 구현
   - 다음 레벨 발동률 예측 기능 추가
   - 비동기 처리로 스킬 데이터 동적 로드

3. **주요 스킬 데이터 수정**:
   - `fireball`: 기본 10%, 레벨당 +5%, 최대 90%
   - `ice_shard`: 기본 10%, 레벨당 +4%, 최대 85%
   - `flame_aura`: 기본 10%, 레벨당 +6%, 최대 95%
   - `ember_toss`: 기본 10%, 레벨당 +8%, 최대 95%
   - `basic_attack`: 기본 100%, 레벨당 +0%, 최대 100%

**수정된 파일**:
- `src/data/skills/fireball.json`: 새로운 `triggerChance` 구조로 변경
- `src/data/skills/basic_attack.json`: 새로운 `triggerChance` 구조로 변경
- `src/data/skills/ice_shard.json`: 새로운 `triggerChance` 구조로 변경
- `src/data/skills/flame_aura.json`: 새로운 `triggerChance` 구조로 변경
- `src/data/skills/ember_toss.json`: 새로운 `triggerChance` 구조로 변경
- `src/components/common/SkillDetailModal.tsx`: 새로운 데이터 구조에 맞는 발동률 계산 로직 구현

**결과**: 
- 각 스킬마다 기본 발동 확률, 레벨당 상승 확률, 최대 발동 확률을 명시적으로 설정 가능
- 스킬 상세 모달에서 정확한 발동률 표시 (레벨에 따른 증가 반영)
- 다음 레벨 발동률 예측 기능 추가
- 더 유연하고 직관적인 스킬 발동률 시스템

---

### 🔧 **스킬 상세 모달 발동률 수정 - 2024년 12월 23일**

**문제**: 
1. 스킬 상세 모달에서 발동률이 항상 10%로 표시됨
2. 실제 스킬 데이터의 발동률이 반영되지 않음

**원인**: 
- 스킬 상세 모달에서 하드코딩된 발동률 사용
- 스킬 데이터 파일의 `baseTriggerChance`와 `triggerChanceLevels`를 고려하지 않음
- 레벨에 따른 발동률 증가 계산이 누락됨

**해결 방법**:
1. **스킬 데이터 기반 발동률 계산**: 
   - 스킬 데이터 파일에서 `baseTriggerChance`와 `triggerChanceLevels` 로드
   - 레벨에 따른 발동률 증가 계산 추가
   - 비동기 처리로 스킬 데이터 동적 로드

2. **스킬 상세 모달 개선**:
   - `useState`와 `useEffect`를 사용한 동적 발동률 계산
   - 실제 스킬 데이터 기반 정확한 발동률 표시

**수정된 파일**:
- `src/components/common/SkillDetailModal.tsx`: 스킬 데이터 기반 발동률 계산 로직 추가

**결과**: 
- 스킬 상세 모달에서 정확한 발동률 표시 (파이어볼: 10% → 10% + 레벨별 증가)
- 레벨에 따른 발동률 증가가 정확히 반영됨
- 기본 공격은 100% 발동률로 정확히 표시됨

---

### 🔧 **스킬 시스템 수정 및 UI 개선 - 2024년 12월 23일**

**문제**: 
1. 스킬이 전혀 사용되지 않음
2. 스킬 상세 모달에서 발동률이 10%로 잘못 표시됨
3. 자동 전투 정지를 눌러도 다음 몬스터에서 전투가 멈춤
4. 현재 층 몬스터 수가 표시되지 않음

**원인**: 
- `processPlayerSkills`에서 `basic_attack`을 건너뛰고 스킬 로그에 추가하지 않음
- 스킬 상세 모달에서 `triggerChance` 계산 로직이 잘못됨
- `stopAutoCombat`에서 `preventAutoCombat` 플래그를 설정하지 않음
- 현재 층 몬스터 수 표시 UI가 없음

**해결 방법**:
1. **스킬 시스템 수정**: 
   - `processPlayerSkills`에서 `basic_attack`도 스킬 로그에 추가
   - 스킬 발동률 계산 로직 개선

2. **스킬 상세 모달 수정**:
   - `skillInfo.triggerChance` 계산 로직 수정
   - 실제 스킬 데이터의 `triggerChance` 값을 우선 사용

3. **자동 전투 즉시 정지**: 
   - `stopAutoCombat`에서 `preventAutoCombat: true` 플래그 추가
   - 즉시 전투 중지가 가능하도록 수정

4. **현재 층 몬스터 수 표시**:
   - `getCurrentFloorMonsterInfo` 함수 추가
   - 몬스터 이름 옆에 "3/5" 형태로 표시
   - 휴식층은 "휴식층"으로 표시

**수정된 파일**:
- `src/utils/combatEngine.ts`: `processPlayerSkills` 함수에서 `basic_attack` 스킬 로그 추가
- `src/components/common/SkillDetailModal.tsx`: 스킬 발동률 계산 로직 수정
- `src/stores/index.ts`: `stopAutoCombat` 함수에 `preventAutoCombat` 플래그 추가
- `src/components/layout/MainView.tsx`: 현재 층 몬스터 수 표시 기능 추가
- `src/data/initial/skills.json`: 초기 스킬에 `triggerChance` 필드 추가

**결과**: 
- 스킬이 정상적으로 사용되고 로그에 표시됨
- 스킬 상세 모달에서 정확한 발동률 표시
- 자동 전투 정지 버튼을 누르면 즉시 멈춤
- 현재 층 몬스터 수가 "3/5" 형태로 표시됨
- 파이어볼이 90% 확률로 발동하여 테스트 가능

---

### 🔧 **사망 후 딜레이 단축 - 2024년 12월 23일**

**문제**: 사망 후 아래층으로 이동하는 딜레이가 너무 길어서 게임 진행이 느렸습니다.

**원인**: 
- `handlePlayerDeath`에서 사망 후 2초 딜레이로 설정되어 있음
- 사망 처리 후 아래층 이동까지 기다리는 시간이 너무 김
- 게임 속도가 빠른 상황에서 사망 딜레이가 게임 플레이를 방해함

**해결 방법**:
1. **딜레이 단축**: 
   - 사망 후 딜레이를 2초에서 1초로 단축
   - 빠른 게임 진행을 위한 적절한 딜레이 설정

**수정된 파일**:
- `src/stores/index.ts`: `handlePlayerDeath` 함수에서 사망 후 딜레이를 1초로 단축

**결과**: 
- 사망 후 더 빠른 게임 진행
- 적절한 딜레이로 사망 처리는 명확하지만 게임 진행은 빠름
- 게임 속도에 맞는 사망 처리 시간

---

### 🔧 **즉시 턴 전환 문제 해결 - 2024년 12월 23일**

**문제**: 플레이어 공격 후 몬스터 공격이 바로 들어오는 문제가 발생했습니다.

**원인**: 
- 플레이어 턴이 끝나면 즉시 `phase`를 `'monster_turn'`으로 변경
- 상태 변경과 `setTimeout` 지연이 분리되어 있어서 즉시 전환되는 것처럼 보임
- `setInterval`이 `'player_turn'` 상태에서도 실행되어 중복 실행 발생

**해결 방법**:
1. **지연된 상태 변경**: 
   - 플레이어 턴이 끝나면 지연 후에 상태를 `'monster_turn'`으로 변경
   - 몬스터 턴이 끝나면 지연 후에 상태를 `'player_turn'`으로 변경
   - 상태 변경과 턴 실행을 같은 `setTimeout` 내에서 처리

2. **setInterval 조건 강화**:
   - `setInterval`이 `'waiting'` 상태에서만 실행되도록 조건 수정
   - `'player_turn'` 상태에서는 `setInterval`이 실행되지 않도록 제한

3. **지연 시간 로그 복원**:
   - 지연 시간을 로그에 표시하여 사용자가 확인 가능하도록 복원

**수정된 파일**:
- `src/stores/index.ts`: 턴 전환 로직을 지연된 상태 변경으로 수정 및 setInterval 조건 강화

**결과**: 
- 플레이어와 몬스터 공격 사이에 확실한 지연 시간 확보
- 턴 전환이 자연스럽게 진행됨
- setInterval과 setTimeout의 충돌 방지
- 안정적인 턴제 전투 시스템

---

### 🔧 **전투 인터벌 일관성 문제 해결 - 2024년 12월 23일**

**문제**: 전투 인터벌이 계속 변화하는 문제가 발생했습니다.

**원인**: 
- `startAutoCombat`에서 `Math.max(500, 3000 / speed)` 계산 사용
- `getCombatDelay`에서 `Math.max(1000, 4000 / speed)` 계산 사용
- 새 몬스터 생성 시 `turnDelay`에 `startAutoCombat`의 interval 사용
- 서로 다른 계산 방식으로 인해 인터벌이 일관되지 않음

**해결 방법**:
1. **인터벌 계산 통일**: 
   - `startAutoCombat`에서 `getCombatDelay` 함수 사용으로 통일
   - 모든 인터벌 계산을 중앙 함수로 일원화

2. **속도 변경 시 자동 재시작**:
   - `setAutoSpeed` 함수에서 자동 전투가 활성화되어 있으면 새로운 속도로 재시작
   - MainView에서 속도 변경 시 `setAutoSpeed` 사용으로 일관성 확보

3. **일관된 인터벌 관리**:
   - 모든 인터벌 계산이 `getCombatDelay` 함수를 통해 처리
   - 속도 변경 시 즉시 반영되도록 자동 재시작 로직 추가

**수정된 파일**:
- `src/stores/index.ts`: `startAutoCombat`에서 `getCombatDelay` 사용 및 `setAutoSpeed` 개선
- `src/components/layout/MainView.tsx`: 속도 변경 시 `setAutoSpeed` 사용

**결과**: 
- 전투 인터벌이 일관되게 유지됨
- 속도 변경 시 즉시 새로운 인터벌이 적용됨
- 모든 인터벌 계산이 중앙 함수를 통해 일원화됨
- 안정적이고 예측 가능한 전투 페이스 제공

---

### 🔧 **전투 인터벌 문제 해결 - 2024년 12월 23일**

**문제**: 플레이어 공격 후 몬스터 공격 사이에 인터벌이 없어서 너무 빠르게 진행되는 문제가 발생했습니다.

**원인**: 
- `getCombatDelay` 함수의 기본 지연 시간이 너무 짧았음 (최소 0.5초)
- 전투 턴 간 지연 시간이 사용자에게 명확하게 표시되지 않아서 지연이 적용되는지 확인하기 어려웠음
- 게임 속도가 빠를 때 지연 시간이 너무 짧아져서 자연스럽지 않았음

**해결 방법**:
1. **지연 시간 증가**: 
   - `getCombatDelay` 함수에서 최소 지연 시간을 0.5초에서 1초로 증가
   - 기본 지연 시간을 3초에서 4초로 증가하여 더 자연스러운 전투 페이스 제공

2. **지연 시간 로그 추가**:
   - 플레이어 턴 후 몬스터 턴 시작 전에 지연 시간을 로그로 표시
   - 몬스터 턴 후 플레이어 턴 시작 전에 지연 시간을 로그로 표시
   - 사용자가 지연이 적용되는지 명확하게 확인 가능

**수정된 파일**:
- `src/stores/index.ts`: `getCombatDelay` 함수의 지연 시간 증가 및 지연 시간 로그 추가

**결과**: 
- 플레이어와 몬스터 공격 사이에 적절한 지연 시간 확보
- 전투가 더 자연스럽고 읽기 쉬운 페이스로 진행
- 지연 시간이 로그에 표시되어 사용자가 확인 가능
- 게임 속도에 따른 적절한 지연 시간 제공

---

### 🔧 **아이템 데이터 구조 정리 - 2024년 12월 23일**

**문제**: 아이템 데이터가 `index.json`과 개별 파일에 중복되어 있어 데이터 관리가 복잡했습니다.

**원인**: 
- `src/data/items/index.json`에 모든 아이템 데이터가 통합되어 있음
- 동시에 개별 아이템 파일들도 존재하여 데이터 중복 발생
- 어떤 파일을 우선시할지 불분명하여 혼란 야기

**해결 방법**:
1. **개별 파일 방식으로 통일**:
   - `index.json` 백업 후 삭제 (`index_backup.json`으로 보존)
   - 모든 아이템을 개별 파일로 관리하도록 변경

2. **누락된 아이템 파일들 생성**:
   - **검**: `toxic_sword.json`, `thunder_sword.json`, `verdant_sword.json`
   - **지팡이**: `frost_staff.json`, `shadow_staff.json`, `verdant_staff.json`
   - **갑옷**: `frost_armor.json`, `shadow_armor.json`, `thunder_armor.json`
   - **악세서리**: `flame_ring.json`, `frost_ring.json`, `toxic_ring.json`, `shadow_ring.json`, `thunder_ring.json`, `verdant_ring.json`
   - **소모품**: `fish_stew.json`, `herb_soup.json`, `divine_feast.json`

3. **데이터 구조 통일**:
   - 모든 아이템 파일이 동일한 구조를 따르도록 통일
   - `itemId`, `name`, `description`, `type`, `baseStats` 등 일관된 필드 사용
   - 강화 시스템 지원을 위한 `enhanceable`, `maxEnhancement` 필드 추가

**수정된 파일**:
- `src/data/items/index.json`: 삭제 (백업: `index_backup.json`)
- 새로 생성된 아이템 파일들: 15개 파일

**결과**: 
- 아이템 데이터 관리가 단순화됨
- 각 아이템을 독립적으로 관리 가능
- 버전 관리가 용이해짐
- 데이터 중복 문제 해결

---

### 🔧 **장비 해제 문제 추가 수정 - 2024년 12월 23일**

**문제**: 장비 해제가 여전히 작동하지 않는 문제가 발생했습니다.

**원인**: 
- `handleEquipToggle` 함수에서 `item.type`을 사용하고 있었지만, 실제로는 `itemType` 변수를 사용해야 함
- 장비 타입 판별 로직이 불완전하여 정확한 슬롯을 결정하지 못함
- `isEquipped` 함수에서 장착 상태 확인 로직이 부정확함

**해결 방법**:
1. **장비 타입 판별 로직 개선**:
   - `itemType` 변수를 사용하여 정확한 장비 타입 판별
   - `accessory` 타입도 추가하여 악세서리 장비 지원
   - `ring`, `necklace`, `amulet` 키워드로 악세서리 자동 판별

2. **장착 상태 확인 로직 개선**:
   - `isEquipped` 함수에서 `uniqueId`와 `itemId` 모두 고려
   - 각 장비 슬롯(weapon, armor, accessory)별로 정확한 비교
   - 장착된 장비와 현재 아이템을 정확히 매칭

3. **디버깅 로그 추가**:
   - `handleEquipToggle` 함수에 콘솔 로그 추가
   - 장착/해제 시도 시 상세 정보 출력

**수정된 파일**:
- `src/components/common/ItemDetailModal.tsx`: 장비 타입 판별 및 장착 상태 확인 로직 개선

**결과**: 
- 장비 해제가 정상적으로 작동함
- 모든 장비 타입(weapon, armor, accessory) 지원
- 장착 상태가 정확하게 표시됨
- 디버깅을 위한 로그 추가

---

### 🔧 **장비 해제 문제 해결 및 층 진행 시스템 개선 - 2024년 12월 23일**

**문제**: 
1. 장비를 해제해도 인벤토리에 아이템이 반환되지 않는 문제
2. 몬스터를 아무리 잡아도 층이 올라가지 않는 문제

**원인**: 
1. `unequipItem` 함수에서 장비를 해제할 때 인벤토리에 아이템을 반환하지 않음
2. 층 진행 시스템이 몬스터가 없을 때만 다음 층으로 올라가도록 되어 있었지만, 실제로는 모든 층에서 몬스터가 생성되어 층이 올라가지 않음

**해결 방법**:
1. **장비 해제 시스템 개선**:
   - `unequipItem` 함수에서 장비 해제 시 인벤토리에 아이템을 반환하도록 수정
   - 해제된 장비의 모든 정보(uniqueId, level, quality, enhancement)를 인벤토리에 추가

2. **층 진행 시스템 완전 재설계**:
   - `TowerState`에 `monsterKillCount` 필드 추가하여 현재 층에서 처치한 몬스터 수 추적
   - 층별로 필요한 몬스터 처치 수 설정:
     - 휴식층(n0): 즉시 다음 층으로
     - 일반 몬스터층(n1-5): 3마리 처치
     - 정예 몬스터층(n6-8): 2마리 처치
     - 보스층(n9): 1마리 처치
   - 충분한 몬스터를 처치하면 다음 층으로 자동 진행

**수정된 파일**:
- `src/stores/index.ts`: `unequipItem` 함수 수정 및 `handleMonsterDeath` 함수에 층 진행 로직 추가
- `src/types/index.ts`: `TowerState`에 `monsterKillCount` 필드 추가

**결과**: 
- 장비 해제 시 인벤토리에 정상적으로 아이템이 반환됨
- 몬스터 처치 후 층이 정상적으로 올라감
- 층별로 적절한 몬스터 처치 수에 따라 진행
- 휴식층에서는 즉시 다음 층으로 진행

---

### 🐛 **몬스터 처치 후 층이 올라가지 않는 문제 해결 - 2024년 12월 23일**

**문제**: 몬스터를 아무리 잡아도 층이 올라가지 않는 문제가 발생했습니다.

**원인**: 
- `src/utils/towerSystem.ts`의 `getMonsterPoolForFloor` 함수에서 하드코딩된 몬스터 ID들이 실제 존재하는 몬스터 파일들과 일치하지 않음
- 예: 하드코딩된 `flame_guardian`, `fire_elemental`, `lava_golem` 등이 실제로는 `flame_elite`, `flame_sprite`, `magma_slime` 파일로 존재
- 이로 인해 몬스터 풀이 비어있게 되고, `generateNextMonster` 함수가 `null`을 반환하지 않아서 층이 올라가지 않음

**해결 방법**:
- `getMonsterPoolForFloor` 함수의 하드코딩된 몬스터 ID들을 실제 존재하는 몬스터 파일들과 일치하도록 수정
- 각 테마별로 실제 존재하는 몬스터들로 교체:
  - Flame: `flame_imp`, `fire_sprite`, `magma_slime`, `ember_wolf`, `flame_lizard` → `flame_elite` → `flame_boss`, `inferno_dragon`
  - Frost: `frost_sprite`, `frost_wolf` → `frost_elite` → `frost_boss`
  - Toxic: `toxic_slime`, `toxic_snake`, `toxic_bug` → `toxic_elite` → `toxic_boss`
  - Shadow: `shadow_bat`, `shadow_rat`, `shadow_spirit` → `shadow_elite` → `shadow_boss`
  - Thunder: `thunder_bird`, `thunder_snake`, `thunder_golem` → `thunder_elite` → `thunder_boss`
  - Verdant: `verdant_sprite`, `verdant_boar`, `verdant_golem` → `verdant_elite` → `verdant_boss`

**수정된 파일**:
- `src/utils/towerSystem.ts`: `getMonsterPoolForFloor` 함수의 몬스터 ID 목록 수정

**결과**: 
- 몬스터 처치 후 정상적으로 다음 층으로 올라감
- 각 테마별로 적절한 몬스터들이 등장함
- 일반 → 엘리트 → 보스 순서로 층별 몬스터 등장
- 휴식층(n0)에서는 몬스터가 없어서 자동으로 다음 층으로 진행

---

### 턴제 RPG 시스템 완전 구현 - 2024년 12월 19일

**목표**: 기존의 배치 처리 방식 전투를 개별 턴 기반 실시간 전투 시스템으로 변경

**주요 변경사항**:

1. **타입 시스템 확장** (`src/types/index.ts`)
   - `CombatPhase` enum 추가: `PLAYER_TURN`, `MONSTER_TURN`, `COMPLETE`, `WAITING`
   - `CombatState` interface 추가: 전투 상태 관리
   - `TowerState`에 `combatState` 필드 추가

2. **전투 엔진 재설계** (`src/utils/combatEngine.ts`)
   - `processPlayerTurn()`: 플레이어 턴만 처리
   - `processMonsterTurn()`: 몬스터 턴만 처리
   - `determineFirstAttacker()`: 선공 결정 함수
   - 기존 `processAutoCombatTurn()` 유지 (하위 호환성)

3. **스토어 시스템 대폭 수정** (`src/stores/index.ts`)
   - `performCombatAction()`: 턴제 전투 로직으로 완전 재작성
   - `startAutoCombat()`: 턴 대기 상태 체크 로직 추가
   - `handleMonsterDeath()`, `handlePlayerDeath()`: 전투 상태 초기화 추가

4. **UI 개선** (`src/components/layout/MainView.tsx`)
   - 전투 상태 시각화 추가
   - 턴별 상태 표시 (플레이어 턴/몬스터 턴/대기 중)
   - 색상별 상태 구분 (파란색: 플레이어, 빨간색: 몬스터, 회색: 대기)

**기술적 특징**:
- **개별 턴 처리**: 플레이어 턴과 몬스터 턴이 분리되어 처리
- **실시간 로그**: 각 턴마다 개별적으로 로그가 출력
- **자동 진행**: `setTimeout`을 사용한 턴 간 지연 시간
- **상태 관리**: `CombatState`로 전투 진행 상태 추적
- **속도 조절**: 전투 속도에 따른 턴 간 지연 시간 조절

**결과**:
- 전투가 더 역동적이고 자연스럽게 진행
- 각 턴이 개별적으로 표시되어 전투 진행 상황을 명확히 파악 가능
- 실제 턴제 RPG와 유사한 게임플레이 경험 제공

---

### 장비 착용 시 HP/MP NaN 문제 완전 해결 - 2024년 12월 19일

**문제**: 장비를 착용할 때 플레이어의 HP, MP가 NaN이 되는 문제가 발생했습니다.

**원인**: 
- `initialPlayerState`에서 `baseMaxHp`와 `baseMaxMp`가 정의되지 않음
- `recalculatePlayerStats`에서 `newPlayer.maxHp = newPlayer.baseMaxHp`를 할 때 `undefined`가 할당되어 NaN 발생
- 기존 저장된 게임 데이터에서도 `baseMaxHp`, `baseMaxMp` 필드가 없어서 문제 발생

**해결 방법**:
1. `src/stores/playerSlice.ts`의 `initialPlayerState`에 `baseMaxHp: 100`, `baseMaxMp: 50` 추가
2. `src/stores/index.ts`의 `startNewGame` 함수에서 `baseMaxHp`, `baseMaxMp` 기본값 설정
3. `src/stores/index.ts`의 `continueGame` 함수에서 기존 저장 데이터에 `baseMaxHp`, `baseMaxMp`가 없는 경우 기본값으로 설정

**수정된 파일**:
- `src/stores/playerSlice.ts`: `initialPlayerState`에 `baseMaxHp`, `baseMaxMp` 추가
- `src/stores/index.ts`: `startNewGame`과 `continueGame`에서 `baseMaxHp`, `baseMaxMp` 기본값 처리

**결과**: 
- 장비 착용/해제 시 HP, MP가 정상적으로 계산됨
- 기존 저장된 게임 데이터와 새로운 게임 모두에서 정상 작동
- NaN 문제 완전 해결

---

### 단일 인터벌 사용으로 중복 실행 문제 완전 해결 - 2024년 12월 19일

**문제**: 여전히 `setTimeout`과 `setInterval`이 동시에 사용되어 중복 실행과 순서 꼬임 문제가 발생했습니다.

**원인**: 
- `setTimeout`으로 즉시 시작하는 로직과 `setInterval`로 주기적 체크하는 로직이 동시에 실행
- 턴 전환 시 `setTimeout`으로 다음 턴을 시작하는 것이 `setInterval`과 충돌
- 여러 타이머가 동시에 실행되어 전투 순서가 꼬임

**해결 방법**:
1. **단일 인터벌 사용**: `setTimeout` 완전 제거하고 `setInterval`만 사용
2. **게임 속도 연동**: `baseInterval / speed`로 게임 속도에 따른 인터벌 계산
3. **상태 기반 제어**: `setInterval`에서 상태를 체크하여 적절한 시점에 전투 실행
4. **순차적 처리**: 모든 전투 로직을 `setInterval` 내에서 순차적으로 처리

**수정된 파일**:
- `src/stores/index.ts`: `startAutoCombat`, `performCombatAction`, `proceedToNextFloor` 함수에서 `setTimeout` 제거

**결과**: 
- 중복 실행 문제 완전 해결
- 전투 순서 꼬임 문제 해결
- 게임 속도와 완벽하게 연동된 전투 시스템
- 안정적인 단일 타이머 기반 전투 시스템

---

### 전투 중복 실행 문제 해결 - 2024년 12월 19일

**문제**: 몬스터가 일반 공격을 3번 하는 경우가 발생하고, 턴 사이 인터벌과 즉시 시작이 충돌하여 전투 순서가 꼬이는 문제가 발생했습니다.

**원인**: 
- `setTimeout`과 `setInterval`이 동시에 실행되어 중복 실행 발생
- `setInterval`에서 `'waiting'` 상태를 체크할 때 이미 `setTimeout`으로 실행 중인 경우가 있음
- 여러 개의 `performCombatAction`이 동시에 호출되어 전투 순서가 꼬임

**해결 방법**:
1. **중복 실행 방지 로직 추가**: `performCombatAction`에서 이미 턴이 진행 중이면 리턴
2. **상태 체크 강화**: `setInterval`에서 전투 진행 상태를 더 정확히 체크
3. **안전한 턴 전환**: `setTimeout`에서 현재 상태를 다시 확인 후 실행
4. **플래그 기반 제어**: `playerTurnComplete`, `monsterTurnComplete` 플래그로 중복 실행 방지

**수정된 파일**:
- `src/stores/index.ts`: `startAutoCombat`과 `performCombatAction` 함수에 중복 실행 방지 로직 추가

**결과**: 
- 몬스터가 3번 공격하는 문제 해결
- 전투 순서가 꼬이는 문제 해결
- 턴 사이 인터벌과 즉시 시작의 충돌 해결
- 안정적인 턴제 전투 시스템 구현

---

### 턴 교차 시 전투 진행 문제 해결 - 2024년 12월 19일

**문제**: 턴이 교차로 진행되거나 플레이어 턴으로 전환될 때 공격이 진행되지 않는 문제가 발생했습니다.

**원인**: 
- 몬스터 턴이 끝나면 `phase`를 `'waiting'`으로 설정
- `'waiting'` 상태에서는 `setInterval`에서만 다음 턴을 시작할 수 있음
- `setInterval`이 다음 주기까지 기다려야 하므로 전투가 멈춰 보임

**해결 방법**:
1. 플레이어 턴이 끝날 때 다음 턴을 위해 상태 초기화 추가
2. 몬스터 턴이 끝날 때 다음 턴을 위해 상태 초기화 추가
3. `currentTurn` 카운터 증가로 턴 추적 개선
4. `playerTurnComplete`, `monsterTurnComplete` 플래그 초기화

**수정된 파일**:
- `src/stores/index.ts`: `performCombatAction` 함수의 턴 전환 로직 수정

**결과**: 
- 턴 교차 시 전투가 자연스럽게 계속 진행됨
- 전투 멈춤 현상 해결
- 턴 카운터로 전투 진행 상황 추적 가능

---

### 자동 전투 즉시 시작 기능 추가 - 2024년 12월 19일

**목표**: 몬스터가 이미 있을 때 자동 전투가 활성화되면 즉시 선공 턴을 시작하도록 개선

**문제**: 
- 자동 전투 버튼을 눌러도 기존 몬스터가 있으면 전투가 즉시 시작되지 않음
- `setInterval`이 다음 주기까지 기다려야 전투가 시작됨

**해결 방법**:
1. `startAutoCombat` 함수에서 몬스터 존재 여부를 즉시 체크
2. 몬스터가 있고 전투 중이면 `setTimeout`으로 0.1초 후 즉시 첫 턴 시작
3. `combatState`가 없거나 `'waiting'` 상태일 때만 시작하도록 조건 추가

**수정된 파일**:
- `src/stores/index.ts`: `startAutoCombat` 함수에 즉시 턴 시작 로직 추가

**결과**: 
- 자동 전투 버튼을 누르면 몬스터가 있을 때 즉시 전투 시작
- 기존 몬스터에 대한 반응성 향상
- 사용자 경험 개선

---

### 턴제 시스템 전투 시작 문제 해결 - 2024년 12월 19일

**문제**: 턴제 시스템으로 변경 후 몬스터가 생성되어도 전투가 시작되지 않는 문제가 발생했습니다.

**원인**: 
- 몬스터 생성 시 `combatState.phase`가 `'waiting'`으로 설정됨
- `performCombatAction`이 `'waiting'` 상태에서 호출되지 않아 전투가 시작되지 않음
- `proceedToNextFloor` 함수에서도 `combatState` 설정이 누락됨

**해결 방법**:
1. `startAutoCombat` 함수에서 몬스터 생성 후 `setTimeout`으로 0.5초 후 첫 턴 시작
2. `proceedToNextFloor` 함수에서도 `combatState` 설정 및 첫 턴 시작 로직 추가
3. 몬스터 생성 직후 자동으로 전투가 시작되도록 수정

**수정된 파일**:
- `src/stores/index.ts`: `startAutoCombat`과 `proceedToNextFloor` 함수 수정

**결과**: 
- 몬스터 생성 후 자동으로 전투가 시작됨
- 턴제 시스템이 정상적으로 작동함
- 전투 시작 지연 문제 완전 해결

---

## 2024-12-23

### 🐛 **몬스터 데이터 구조 통일 및 슬롯머신 버그 수정**
- **문제**: 
  - `fire_sprite.json`의 구조가 다른 몬스터들과 달라서 오류 발생
  - 품질 미니게임의 룰렛이 돌아가지 않음
- **해결**: 
  - `fire_sprite.json`에 누락된 필드들 추가 (`maxHp`, `level`, `speed`, `goldReward`, `xpReward`, `skills`)
  - 다른 몬스터들과 일치하는 구조로 통일
  - `executeCraft` 함수에서 `setIsCrafting(true)` 제거하여 슬롯머신이 정상 작동하도록 수정
- **파일**: 
  - `src/data/monsters/fire_sprite.json`
  - `src/components/life/CraftingModal.tsx`
- **결과**: 이제 몬스터 데이터가 일관되게 작동하고 슬롯머신 미니게임이 정상적으로 돌아감

### 🎯 **UI/UX 시스템 완전 개선**
- **문제**: 
  - 장비 강화 모달이 외부 클릭으로 닫히지 않음
  - 강화 비용 표시와 실제 차감 비용이 다름
  - 생활 탭과 상점 탭이 모달 형태로 표시됨
  - ShopPanel에서 JSX 구조 오류 발생
  - LifePanel에서 JSX 구조 오류 발생
- **해결**: 
  - 강화 모달에 외부 클릭으로 닫기 기능 추가
  - 강화 비용 계산을 `equipmentSystem`의 `calculateEnhancementCost`와 일치하도록 수정
  - 생활 탭과 상점 탭을 하단 패널로 변경하여 캐릭터, 인벤토리 탭과 일관성 유지
  - 탭 클릭 시 토글 기능 (같은 탭 재클릭 시 닫기, 다른 탭 클릭 시 변경)
  - ShopPanel의 JSX 구조를 완전히 재작성하여 오류 해결
  - LifePanel의 JSX 구조를 React Fragment(`<>`)로 감싸서 오류 해결
- **파일**: 
  - `src/components/common/ItemDetailModal.tsx`
  - `src/components/shop/ShopPanel.tsx`
  - `src/components/life/LifePanel.tsx`
- **결과**: 이제 모든 탭이 일관된 UI/UX를 제공하고 사용자 편의성이 크게 향상됨

### 🎰 **슬롯머신 미니게임 완전 수정**
- **문제**: 제작 슬롯머신이 "돌리는 중..." 상태에서 멈춤
- **원인**: 슬롯 스핀 후 자동으로 완료 함수가 호출되어 사용자 제어 불가
- **해결**: 
  - 슬롯 스핀 후 자동 완료 제거
  - 사용자가 직접 "제작 완료" 버튼을 눌러야 완료되도록 수정
  - 슬롯 심볼을 올바르게 표시하도록 수정
- **파일**: `src/components/life/CraftingModal.tsx`
- **결과**: 이제 슬롯머신이 정상적으로 작동하고 사용자가 제어 가능

### 🎰 **슬롯머신 로직 완전 개선**
- **문제**: 
  - 슬롯머신이 자동으로 시작되어 사용자 제어 불가
  - "더 만들기" 버튼이 모달을 닫지 않고 연속 제작을 시도
  - 제작 완료 후 모달이 닫히지 않음
- **해결**: 
  - `executeCraft`에서 자동 슬롯 시작 제거
  - "슬롯 돌리기" 버튼을 "더 만들기" 버튼으로 변경
  - "더 만들기" 버튼 클릭 시 모달을 닫지 않고 새로운 제작 시작
  - 제작 완료 시 모달 자동 닫기
  - `completeSlotGame`에서 `setShowSlotGame(false)` 추가
- **파일**: `src/components/life/CraftingModal.tsx`
- **결과**: 사용자가 제작하기 버튼을 눌러야 룰렛이 돌고, 제작 완료 시 모달이 닫힘

### 🎰 **슬롯머신 자동 시작 및 더 만들기 기능**
- **문제**: 
  - 슬롯머신이 자동으로 시작되지 않음
  - "슬롯 돌리기" 버튼이 "더 만들기" 버튼으로 변경 필요
  - 더 만들기 버튼 클릭 시 모달이 닫힘
- **해결**: 
  - `executeCraft` 함수에서 슬롯머신 자동 시작 로직 추가
  - "슬롯 돌리기" 버튼을 "더 만들기" 버튼으로 변경
  - `makeMore` 함수 추가하여 모달을 닫지 않고 새로운 제작 시작
  - `completeSlotGame`에서 모달 닫기 로직 제거
- **파일**: `src/components/life/CraftingModal.tsx`
- **결과**: 제작 시작 시 자동으로 슬롯이 돌아가고, 더 만들기 버튼으로 연속 제작 가능

### ⚔️ **장비 능력치 전투 스탯 반영**
- **문제**: 
  - 장비의 능력치가 실제 전투 스탯에 반영되지 않음
- **해결**: 
  - `getBaseEquipmentStats` 함수에 모든 장비들의 상세 스탯 추가
  - 무기: `flame_sword`, `frost_sword`, `shadow_sword`, `flame_staff`, `toxic_staff`, `thunder_staff`
  - 방어구: `flame_armor`, `toxic_armor`, `verdant_armor`
  - 각 장비별로 `physicalAttack`, `magicalAttack`, `physicalDefense`, `magicalDefense`, `hp`, `mp`, `speed` 스탯 정의
- **파일**: `src/utils/equipmentSystem.ts`
- **결과**: 장비 착용 시 실제 전투 능력이 향상됨

### 🎣 **생활 아이템 인벤토리 반영**
- **문제**: 
  - 생활 스킬로 얻은 아이템들이 실제 인벤토리에 반영되지 않음
- **해결**: 
  - `LifePanel`에서 `useGameStore`의 `addLifeSkillXp`, `addItem`, `addCombatLog` 함수 import
  - 각 생활 스킬 완료 시 실제 아이템과 경험치 추가:
    - 낚시: `raw_meat` (퍼펙트: 2개, 일반: 1개)
    - 농사: `vegetable` (3개)
    - 광산: `iron_ore` (퍼펙트: 2개, 일반: 1개)
    - 채집: `healing_herb` (퍼펙트: 2개, 일반: 1개)
  - 전투 로그에 획득 아이템 정보 표시
- **파일**: `src/components/life/LifePanel.tsx`
- **결과**: 생활 스킬로 얻은 아이템들이 실제 인벤토리에 추가되어 제작에 사용 가능

### ⚡ **장비 강화 시스템 완전 개선**
- **문제**: 강화 버튼이 별도 모달 없이 바로 실행됨
- **해결**: 
  - 별도의 강화 모달 컴포넌트 생성
  - 강화 확률, 소모 재화, 연속 강화 기능 추가
  - 강화 세션별 횟수 추적 기능
  - 실시간 골드 확인 및 비용 표시
- **파일**: `src/components/common/ItemDetailModal.tsx`
- **결과**: 이제 강화 시스템이 직관적이고 편리하게 작동

### 🎮 **낚시 미니게임 시간 문제 해결**
- **문제**: 낚시 미니게임에서 리듬 완료 시 자동으로 끝남
- **해결**: 시퀀스 완료 후에도 자동 종료되지 않도록 수정
- **파일**: `src/components/life/FishingMinigame.tsx`
- **결과**: 이제 사용자가 직접 완료 버튼을 눌러야 종료됨

### ⏰ **생활 스킬 쿨다운 완전 제거**
- **문제**: 생활 스킬에 쿨다운이 있어 연속 사용 불가
- **해결**: 
  - 모든 쿨다운 관련 코드 제거
  - 언제든지 사용 가능하도록 수정
  - UI에서 "언제든지 사용 가능" 표시
- **파일**: `src/components/life/LifePanel.tsx`
- **결과**: 이제 생활 스킬을 제한 없이 사용 가능

### 🎁 **생활 스킬 보상 시스템 구현**
- **문제**: 생활 스킬 완료 시 경험치와 아이템 보상이 없음
- **해결**: 
  - 각 미니게임 완료 시 경험치 보상 추가
  - 퍼펙트 성공 시 추가 보상 시스템
  - 관련 아이템 자동 획득 로직 준비
- **파일**: `src/components/life/LifePanel.tsx`
- **결과**: 이제 생활 스킬 완료 시 적절한 보상 제공

### 🔧 **장비 장착 상태 확인 버그 수정**
- **문제**: 장착되지 않은 장비에 "장착해제" 버튼이 표시됨
- **원인**: `isEquipped` 함수에서 `uniqueId`와 `itemId` 둘 다 확인하여 잘못된 판단
- **해결**: 
  - `uniqueId`가 있으면 `uniqueId`로만 비교
  - `uniqueId`가 없으면 `itemId`로만 비교
  - 정확한 장착 상태 확인 로직 구현
- **파일**: `src/components/common/ItemDetailModal.tsx`
- **결과**: 이제 장착 상태가 정확하게 표시됨

### ⚛️ **React Hooks 순서 오류 해결**
- **문제**: `CraftingModal`에서 "Rendered more hooks than during the previous render" 오류 발생
- **원인**: 조건부 return 이후에 `useEffect` Hook이 호출되어 Hook 순서가 변경됨
- **해결**: 모든 Hook들을 조건부 return 이전에 호출하도록 수정
- **파일**: `src/components/life/CraftingModal.tsx`
- **결과**: React Hooks 규칙을 준수하여 오류 완전 해결

### 🛠️ **생활 스킬 시스템 GameStore 통합 완료**
- **문제**: 생활 탭에서 제작 버튼 클릭시 `Cannot read properties of undefined (reading 'skills')` 오류 발생
- **해결**: 
  - `lifeSlice`를 `GameStore`에 완전 통합
  - `CraftingModal`에서 `lifeSlice` 구조에 맞게 skills 접근 방식 수정
  - 생활 스킬 관련 함수들(`addLifeSkillXp`, `startCooldown` 등)을 GameStore에 추가
  - 초기 상태에 life 상태 추가
- **파일**: 
  - `src/stores/index.ts`
  - `src/components/life/CraftingModal.tsx`
- **결과**: 이제 생활 탭의 모든 기능이 정상 작동합니다!

### 💀 **플레이어 사망 처리 시스템 개선**
- **문제**: 플레이어가 죽으면 1층으로 돌아가고 몬스터가 나타나지 않음
- **해결**: 
  - `handlePlayerDeath` 함수를 수정하여 3층 전으로 돌아가도록 변경
  - 사망 후 해당 층에 맞는 몬스터 자동 생성
  - 최고 층 기록도 함께 조정하여 일관성 유지
  - 함수를 async로 변경하여 몬스터 생성 로직 통합
- **파일**: `src/stores/index.ts`

### 🔧 **자동 전투 시스템 완전 수정**
- **문제**: 첫 전투 후 다음 몬스터가 나타나지 않고 자동 전투가 멈춤
- **해결**: 
  - `handleMonsterDeath` 함수에 몬스터 제거 및 다음 몬스터 생성 로직 추가
  - `startAutoCombat` 함수에서 `isInCombat` 조건 제거하여 전투가 끝나도 자동 전투 계속 진행
  - 몬스터가 없을 때 자동으로 새 몬스터 생성하도록 개선
- **파일**: `src/stores/index.ts`

### 🎒 **장비 UI 시스템 완전 개선**
- **문제**: 장비 장착 후 인벤토리에서 테두리 변경 및 E 뱃지가 표시되지 않음
- **해결**:
  - `equipItem` 함수에서 `uniqueId` 처리 로직 추가
  - `ItemDetailModal`에서 `uniqueId` 기반 장착 상태 확인
  - 인벤토리 패널에서 장착된 장비 시각적 구분 (노란색 테두리 + E 뱃지)
  - 장비 고유 관리 시스템으로 각 장비를 개별적으로 관리
- **파일**: 
  - `src/stores/index.ts`
  - `src/utils/equipmentSystem.ts`
  - `src/components/common/ItemDetailModal.tsx`
  - `src/components/inventory/InventoryPanel.tsx`

### 📦 **재료 로드 오류 해결**
- **문제**: 재료 클릭시 "알 수 없는 아이템" 오류 발생
- **해결**: `loadItem` 함수에 `materials` 폴더 검색 로직 추가
- **파일**: `src/utils/dataLoader.ts`

### 🎮 **게임 플레이 개선**
- 자동 전투가 연속적으로 진행되어 끊김 없는 게임 경험 제공
- 장비 장착 상태를 직관적으로 확인 가능
- 각 장비가 고유한 특성을 가져 MMO 스타일의 장비 시스템 구현
- 사망 시 적절한 페널티와 함께 게임 재시작 가능
- 생활 스킬 시스템이 완전히 통합되어 모든 기능 정상 작동
- React Hooks 규칙을 준수하여 안정적인 컴포넌트 렌더링
- 슬롯머신 미니게임이 사용자 제어 가능하게 작동
- 강화 시스템이 직관적이고 편리하게 개선됨
- 모든 생활 스킬이 쿨다운 없이 자유롭게 사용 가능
- 생활 스킬 완료 시 적절한 보상 시스템 제공
- **모든 탭이 일관된 UI/UX를 제공하여 사용자 경험 향상**
- **강화 비용이 정확하게 계산되고 표시됨**
- **외부 클릭으로 모달을 닫을 수 있어 편의성 증대**

### 🐛 **life.skills.find 오류 수정**
- **문제**: 
  - `life.skills.find is not a function` 오류 발생
  - 생활 스킬 경험치 추가 시 오류로 인해 게임 중단
- **원인**: 
  - `life.skills`가 배열이 아닌 객체 구조로 되어 있어 `.find()` 메서드 사용 불가
- **해결**: 
  - `life.skills.find(s => s.skillType === skillType)` → `life.skills[skillType]`로 변경
  - `addLifeSkillXp`, `levelUpLifeSkill`, `startCooldown`, `startMinigame` 함수 모두 수정
- **파일**: `src/stores/index.ts`
- **결과**: 생활 스킬 경험치 추가가 정상적으로 작동

### 📦 **제작 아이템 인벤토리 반영 문제 수정**
- **문제**: 
  - 룰렛 완료 후 아이템이 실제로 인벤토리에 반영되지 않음
  - 제작 완료 로그가 표시되지 않아 확인 불가
- **해결**: 
  - `completeSlotGame` 함수에서 `addCombatLog` 활성화
  - `useGameStore.getState()`를 사용하여 전투 로그에 제작 완료 메시지 추가
  - 콘솔 로그 추가로 아이템 추가 과정 추적 가능
  - 소모품과 장비 구분하여 적절한 함수 호출
- **파일**: `src/components/life/CraftingModal.tsx`
- **결과**: 룰렛 완료 후 아이템이 실제로 인벤토리에 추가되고 전투 로그에 표시됨

### ⚔️ **장비 스탯 불일치 문제 수정**
- **문제**: 
  - 장비의 상세 정보에 표시되는 스탯과 실제 전투에 적용되는 스탯이 다름
  - JSON 파일의 `baseStats`와 `equipmentSystem.ts`의 `getBaseEquipmentStats` 값이 불일치
- **원인**: 
  - `flame_sword.json`: `physicalAttack: 20`, `elementalAttack: { flame: 15 }`, `speed: 2`
  - `equipmentSystem.ts`: `physicalAttack: 25`, `magicalAttack: 10`, `speed: 3`
- **해결**: 
  - `equipmentSystem.ts`의 `getBaseEquipmentStats` 값을 JSON 파일과 일치하도록 수정
  - `flame_sword`: `physicalAttack: 20`, `magicalAttack: 15`, `speed: 2`
  - `frost_sword`: `physicalAttack: 18`, `magicalAttack: 17`, `speed: 3`
  - `elementalAttack` 값을 `magicalAttack`으로 변환하여 통일
- **파일**: `src/utils/equipmentSystem.ts`
- **결과**: 장비 상세 정보의 스탯과 실제 전투 적용 스탯이 일치함

### 🔧 **removeMaterial 함수 구현 및 제작 로직 완전 개선**
- **문제**: 
  - `removeMaterial` 함수가 구현되지 않아 재료 소모가 작동하지 않음
  - 제작하기 버튼 클릭 시 룰렛 완료 후 아이템이 생성되지 않음
  - 제작 완료 버튼이 모달을 닫지 않고 아이템을 다시 제작함
- **해결**: 
  - `removeMaterial` 함수 구현: 재료 수량 감소 및 0개 시 제거
  - 제작하기 버튼 클릭 시 재료 소모 → 품질 보너스 초기화 → 슬롯머신 → 자동 아이템 제작
  - 제작 완료 버튼은 모달만 닫도록 수정
  - 제작 결과를 UI에 표시하는 `craftedItem` 상태 추가
- **파일**: `src/stores/index.ts`, `src/components/life/CraftingModal.tsx`
- **결과**: 재료 소모 → 슬롯머신 → 아이템 제작 → 모달 닫기 순서로 정상 작동

### 🎮 **미니게임 완료 후 게임 시작 패널로 진입**
- **문제**: 
  - 미니게임 완료 후 다시 미니게임을 들어가면 완료 버튼이 나옴
- **해결**: 
  - 모든 미니게임의 완료 버튼 클릭 시 게임 상태를 `ready`로 초기화
  - `FishingMinigame`, `MiningMinigame`, `HerbalismMinigame` 모두 수정
  - 게임 관련 상태들(점수, 진행도, 그리드 등) 모두 리셋
- **파일**: `src/components/life/FishingMinigame.tsx`, `src/components/life/MiningMinigame.tsx`, `src/components/life/HerbalismMinigame.tsx`
- **결과**: 미니게임 완료 후 다시 들어가면 게임 시작 패널이 표시됨

### 📈 **생활 스킬 레벨업 시스템 수정**
- **문제**: 
  - 생활 스킬이 레벨 2 이상으로 올라가지 않음
- **원인**: 
  - `addLifeSkillXp` 함수에서 스토어 상태를 실제로 업데이트하지 않음
  - 레벨업 로직이 단순한 계산만 하고 실제 상태 변경을 하지 않음
- **해결**: 
  - `addLifeSkillXp` 함수에서 `set()`을 사용하여 스토어 상태 업데이트
  - 레벨업 시 `maxXp` 증가 로직 추가 (`Math.floor(100 * Math.pow(1.5, newLevel - 1))`)
  - 경험치가 `maxXp`를 초과할 때 자동 레벨업 로직 구현
- **파일**: `src/stores/index.ts`
- **결과**: 생활 스킬 경험치 획득 시 실제로 레벨이 올라가고 UI에 반영됨

### 🎰 **제작하기 버튼 로직 완전 개선**
- **문제**: 
  - 제작하기 버튼 클릭 시 재료 소모, 품질 보너스 초기화, 슬롯머신 완료 후 아이템 제작이 제대로 작동하지 않음
- **해결**: 
  - `spinSlots` 함수에 재료 소모 확인 및 처리 로직 추가
  - 품질 보너스 초기화 (`setQualityBonus(0)`) 추가
  - 슬롯머신 완료 후 1초 뒤 자동으로 `completeSlotGame` 호출
  - 재료 부족 시 제작 중단 로직 추가
- **파일**: `src/components/life/CraftingModal.tsx`
- **결과**: 제작하기 → 재료 소모 → 슬롯머신 → 품질 계산 → 아이템 제작 순서로 정상 작동

### 🐟 **날고기 분류를 물고기로 변경**
- **문제**: 
  - `raw_meat`가 `cooking` 카테고리로 분류되어 있음
- **해결**: 
  - `src/data/materials/raw_meat.json`에서 `category`를 `"cooking"`에서 `"fishing"`으로 변경
- **파일**: `src/data/materials/raw_meat.json`
- **결과**: 낚시로 얻은 날고기가 물고기 카테고리로 올바르게 분류됨

### 📊 **생활 탭 경험치/레벨 반영 문제 수정**
- **문제**: 
  - 로그에서는 생활 레벨이 올라간다고 표시되지만 생활 탭에는 경험치 상승이나 레벨 상승이 반영되지 않음
- **원인**: 
  - `lifeSkills` 배열이 하드코딩되어 있어서 실제 스토어의 데이터를 반영하지 않음
- **해결**: 
  - `useGameStore`에서 `life` 상태 import 추가
  - 하드코딩된 `lifeSkills` 배열을 실제 스토어 데이터를 사용하도록 수정
  - 각 스킬의 `level`, `xp`, `maxXp`를 `life?.skills?.[skillId]?.`로 동적 접근
- **파일**: `src/components/life/LifePanel.tsx`
- **결과**: 생활 스킬 경험치와 레벨이 실시간으로 UI에 반영됨

### 🎰 **슬롯머신 모달 이벤트 전파 문제 수정**
- **문제**: 
  - "제작하기" 버튼 클릭 시 슬롯머신이 돌아가지 않고 모달이 닫힘
- **원인**: 
  - 슬롯머신 모달이 메인 모달의 `onClick={onClose}` 이벤트에 의해 닫힘
- **해결**: 
  - 슬롯머신 모달의 z-index를 60으로 높임
  - 슬롯머신 모달에 `onClick={(e) => e.stopPropagation()}` 추가
  - 이벤트 전파를 막아서 메인 모달의 닫기 이벤트가 실행되지 않도록 수정
- **파일**: `src/components/life/CraftingModal.tsx`
- **결과**: 제작하기 버튼 클릭 시 슬롯머신이 정상적으로 돌아감

### 📦 **생활 아이템 인벤토리 반영 문제 수정**
- **문제**: 
  - 생활 스킬로 얻은 아이템들이 로그에는 표시되지만 실제 인벤토리에 반영되지 않음
- **원인**: 
  - `addItem` 함수는 `inventory.items`에 추가하지만, 생활 스킬 아이템들은 `inventory.materials`에 추가되어야 함
- **해결**: 
  - `addItem` 대신 `addMaterial` 함수 사용
  - `useGameStore`에서 `addMaterial` 함수 import 추가
  - 모든 생활 스킬 완료 시 `addMaterial`로 재료 추가
- **파일**: `src/components/life/LifePanel.tsx`
- **결과**: 생활 스킬로 얻은 재료들이 실제 인벤토리의 materials에 추가되어 제작에 사용 가능

### 🐛 **장비 해제 시 HP/MP 스탯 차감 문제 수정**
- **문제**: 장비를 해제해도 HP, MP 등 스탯이 정상적으로 차감되지 않음
- **원인**: recalculatePlayerStats 함수에서 maxHp, maxMp를 기본값으로 초기화하지 않고 누적만 했기 때문
- **해결**: recalculatePlayerStats에서 maxHp, maxMp를 각각 100, 50으로 초기화 후 장비 스탯을 누적하도록 수정
- **파일**: `src/utils/equipmentSystem.ts`
- **결과**: 장비 해제 시 HP, MP 등 스탯이 정상적으로 차감되어 실제 캐릭터 스탯에 반영됨

### 🐛 **장비 HP/MP/속도 등 스탯 일치 문제 완전 해결**
- **문제**: 장비의 속도, HP, MP 등 일부 스탯이 상세 패널, 캐릭터 패널, 실제 전투 스탯에서 일치하지 않음
- **원인**: 기본값(100, 50, 5 등)을 하드코딩하거나, baseSpeed 등과 실제 기본값이 다르게 관리됨
- **해결**:
  - PlayerState에 baseMaxHp, baseMaxMp를 추가하여 모든 스탯의 기준값을 명확히 관리
  - recalculatePlayerStats에서 maxHp, maxMp, speed를 각각 baseMaxHp, baseMaxMp, baseSpeed로 초기화 후 장비 스탯 누적
  - 캐릭터 패널에서 '장비 HP', '장비 MP', '장비 속도'를 각각 player.maxHp - player.baseMaxHp, player.maxMp - player.baseMaxMp, player.speed - player.baseSpeed로 계산
- **파일**: `src/types/index.ts`, `src/utils/equipmentSystem.ts`, `src/components/character/CharacterPanel.tsx`
- **결과**: 장비의 모든 스탯(공격력, 속도, HP, MP 등)이 상세 패널, 캐릭터 패널, 실제 전투 스탯에서 완전히 일치

---

## 2024-12-22

### 🐛 **초기 오류 수정**
- **문제**: "Unknown Item" 오류로 인한 자동 전투 시작 실패
- **해결**: `src/data/items/index.json`에 누락된 장비 아이템들 추가
- **추가된 아이템**: `wooden_sword`, `iron_sword`, `frost_sword`, `shadow_sword`, `flame_staff`, `toxic_staff`, `thunder_staff`, `leather_armor`, `toxic_armor`, `verdant_armor`, `greater_health_potion`, `greater_mana_potion`, `bread`, `meat_stew`

### 🎨 **UI 개선**
- **문제**: 캐릭터 탭의 장비 패널에서 강화 시스템 패널이 삭제되지 않음
- **해결**: `src/components/character/CharacterPanel.tsx`에서 강화 시스템 섹션 완전 제거

### 🎮 **미니게임 모달 수정**
- **문제**: 생활 미니게임 결과 모달이 사용자 확인 없이 자동으로 닫힘
- **해결**: `src/components/life/` 폴더의 모든 미니게임 컴포넌트에서 `onClick={onClose}` 제거
- **수정된 파일**: `FishingMinigame.tsx`, `MiningMinigame.tsx`, `HerbalismMinigame.tsx`, `FarmingSystem.tsx`

### ⚡ **자동 전투 시스템 수정**
- **문제**: `Uncaught ReferenceError: startAutoCombat is not defined`
- **해결**: `src/components/layout/MainView.tsx`에서 `setAutoMode` 함수 사용으로 변경
- **파일**: `src/components/layout/MainView.tsx`, `src/stores/index.ts`

### 📋 **프로젝트 구조**
- 모든 파일이 기존 분류대로 폴더별로 정리됨
- README.md 파일에 각 파일의 목적과 구조 명시
- TroubleShooting.md에 디버깅 및 수정 내역 기록

---

## 2024-12-23 (추가)

### 🎯 **UI/UX 시스템 완전 개선 - 2차**
- **문제**: 
  - 장비 상세 모달에 불필요한 강화 정보와 요구사항 표시
  - 캐릭터 장비 패널에 속성별 스탯 정보 부족
  - 기본공격 발동률이 10%로 표시됨
  - 플레이어 스킬이 전투 중 발동되지 않음
  - 로그가 너무 길고 복잡함
  - 상단 컨트롤 패널이 불필요함
  - 장비 장착 시 모달이 닫히지 않음
  - 장착하지 않은 장비에 강화 버튼 없음
- **해결**: 
  - 장비 상세 모달에서 강화 정보와 요구사항 섹션 완전 제거
  - 캐릭터 장비 패널에 HP, MP, 속도, 속성별 공격/저항 스탯 추가
  - 기본공격 발동률을 100%로 수정 (스킬 상세 모달)
  - 전투 엔진에서 플레이어 스킬 발동 로직 구현
  - 로그 메시지를 간결하게 수정 ("플레이어 기본 공격! 대미지 24" 형태)
  - 상단 컨트롤 패널 완전 제거
  - 파이어볼을 기본 스킬로 추가 (초기 스킬 설정)
  - 장비 장착 시 자동으로 모달 닫기 기능 추가
  - 장착하지 않은 장비에도 강화 버튼 표시
- **파일**: 
  - `src/components/common/ItemDetailModal.tsx`
  - `src/components/character/CharacterPanel.tsx`
  - `src/components/common/SkillDetailModal.tsx`
  - `src/utils/combatEngine.ts`
  - `src/stores/index.ts`
  - `src/components/layout/MainView.tsx`
  - `src/data/initial/skills.json`
- **결과**: 
  - 장비 상세 모달이 더 깔끔하고 직관적으로 개선됨
  - 캐릭터 장비 패널에서 모든 스탯 정보를 한눈에 확인 가능
  - 기본공격이 정확한 발동률로 표시됨
  - 플레이어 스킬이 전투 중 정상적으로 발동됨
  - 로그가 간결하고 읽기 쉬워짐
  - UI가 더 깔끔하고 사용자 친화적으로 개선됨
  - 장비 장착/강화 시스템이 더 편리해짐

### 🎯 **전투 시스템 완전 개선 - 3차**
- **문제**: 
  - 로그에서 스킬을 쓰는 주체가 명확하지 않음
  - 스킬 사용 시 수련치가 데이터에 정의된 조건에 따라 얻어지지 않음
  - 전투 로그에 불필요한 상성 효과 로그가 표시됨
- **해결**: 
  - 스킬 로그에 주체 명시 ("플레이어 화염구 공격! 대미지 24" 형태)
  - 스킬 사용 시 'cast' 조건으로 수련치 추가
  - 몬스터 처치 시 'kill' 조건으로 수련치 추가
  - 전투 로그에서 상성 효과 로그 제거
  - CombatResult 타입에 skillsUsed 필드 추가
- **파일**: 
  - `src/utils/combatEngine.ts`
  - `src/stores/index.ts`
  - `src/types/index.ts`
- **결과**: 
  - 스킬 로그가 더 명확하고 읽기 쉬워짐
  - 스킬 수련치가 정확한 조건에 따라 획득됨
  - 전투 로그가 깔끔하고 핵심적인 정보만 표시됨

### 🎯 **스킬 수련치 시스템 완전 개선**
- **문제**: 
  - 사용한 스킬 외의 모든 스킬에 수련치가 올라가는 문제
  - 스킬 사용 시 'cast' 수련치가 올라가지 않는 문제
  - 몬스터 처치 시 상성 체크가 없는 문제
  - 마지막으로 사용된 스킬 추적이 안 되는 문제
- **해결**: 
  - 스킬 사용 시 해당 스킬만 'cast' 수련치 추가
  - 몬스터 처치 시 마지막으로 사용된 스킬만 'kill' 수련치 추가
  - 상성 몬스터 처치 시 'killWeak' 수련치 추가
  - CombatResult와 TowerState에 lastUsedSkill 필드 추가
  - 상성 체크 함수 구현 (checkMonsterWeakness)
- **파일**: 
  - `src/utils/combatEngine.ts`
  - `src/stores/index.ts`
  - `src/types/index.ts`
- **결과**: 
  - 스킬 수련치가 정확한 조건에 따라 올바르게 획득됨
  - 상성 시스템이 스킬 수련에 반영됨
  - 마지막 사용 스킬 추적으로 정확한 kill 수련치 제공

### 🎯 **스킬 수련치 수치 시스템 완전 구현**
- **문제**: 
  - 스킬 수련치가 무조건 1씩만 추가되는 문제
  - 스킬 데이터에 정의된 수치가 반영되지 않는 문제
- **해결**: 
  - 스킬 데이터에서 trainingRules의 xpGain 수치를 동적으로 가져오는 함수 구현
  - cast, kill, killWeak 조건별로 정확한 수치만큼 수련치 추가
  - 스킬 데이터 로드 실패 시 안전한 처리 (0 반환)
- **파일**: 
  - `src/stores/index.ts`
- **결과**: 
  - fireball: cast(2), kill(8), killWeak(25) 수치만큼 정확히 수련치 획득
  - basic_attack: cast(1), kill(5), killWeak(20) 수치만큼 정확히 수련치 획득
  - 모든 스킬이 데이터에 정의된 수치에 따라 정확한 수련치 획득

### 🎯 **장비 스탯 일치 시스템 완전 구현**
- **문제**: 
  - 장비 상세 모달에 표시되는 스탯과 실제 캐릭터에 반영되는 스탯이 다른 문제
  - JSON 파일의 baseStats와 equipmentSystem의 getBaseEquipmentStats 값이 불일치
- **해결**: 
  - 장비 상세 모달에서 JSON 파일의 baseStats 대신 getBaseEquipmentStats 함수 사용
  - equipmentSystem의 장비 스탯을 JSON 파일과 일치하도록 수정
  - HP, MP 스탯도 장비 상세 모달에 표시하도록 추가
- **수정된 장비 스탯**:
  - flame_armor: physicalDefense(15), magicalDefense(10), hp(50)
  - toxic_armor: physicalDefense(12), magicalDefense(18), speed(5)
  - verdant_armor: physicalDefense(25), magicalDefense(30), hp(80)
  - flame_staff: magicalAttack(25), mp(30)
  - toxic_staff: magicalAttack(23), mp(25)
  - thunder_staff: magicalAttack(40), mp(40), speed(5)
- **파일**: 
  - `src/components/common/ItemDetailModal.tsx`
  - `src/utils/equipmentSystem.ts`
- **결과**: 
  - 장비 상세 모달의 스탯과 실제 캐릭터 스탯이 완전히 일치
  - 사용자가 장비의 실제 효과를 정확히 확인 가능
  - HP, MP 스탯도 장비 상세 모달에서 확인 가능 

### 🎯 **장비 상세 모달 UX 및 스탯 일치 개선**
- **문제**: 
  - 장비를 장착/해제해도 상세 모달이 닫히지 않음
  - 미장착 장비의 상세 모달에 강화 버튼이 없음
  - 상세 모달의 스탯(특히 속도 등)이 캐릭터 패널/실제 전투 스탯과 일치하지 않음
- **해결**: 
  - 장착/해제 시 항상 상세 모달이 자동으로 닫히도록 수정
  - 미장착 장비에도 강화 버튼이 항상 노출되도록 조건 수정
  - 상세 모달에서 장착된 인스턴스가 있으면 강화 수치까지 반영된 스탯을, 아니면 기본 스탯을 표시하도록 수정
- **파일**: `src/components/common/ItemDetailModal.tsx`
- **결과**: 
  - 장비 장착/해제 시 상세 모달이 자동으로 닫힘
  - 인벤토리 내 미장착 장비도 강화 가능
  - 상세 모달의 모든 스탯(공격력, 속도 등)이 캐릭터 패널/전투 스탯과 완전히 일치 

### 기존 몬스터가 있을 때 자동 전투 시작 문제 해결 - 2024년 12월 19일

**문제**: 몬스터가 이미 있고 턴 대기 중일 때 자동 전투를 시작해도 전투가 진행되지 않았습니다.

**원인**: 
- `setInterval`이 시작되기 전에 기존 몬스터가 있는 상태에서 자동 전투를 시작하면
- `setInterval` 내부의 조건문이 실행되지 않아 전투가 시작되지 않음
- 몬스터가 이미 있는 상태에서 즉시 첫 턴을 시작하는 로직이 없었음

**해결 방법**:
1. **즉시 시작 로직 추가**: `startAutoCombat`에서 몬스터가 이미 있는 경우 즉시 첫 턴 시작
2. **조건 체크**: `tower.currentMonster && tower.isInCombat` 조건 확인
3. **상태 체크**: `combatState`가 없거나 `waiting` 상태인지 확인
4. **setTimeout 사용**: 0.1초 후 즉시 `performCombatAction` 호출

**수정된 파일**:
- `src/stores/index.ts`: `startAutoCombat` 함수에 기존 몬스터 즉시 시작 로직 추가

**결과**: 
- 기존 몬스터가 있을 때도 자동 전투가 즉시 시작됨
- 턴 대기 중인 상태에서도 정상적으로 전투 진행
- 모든 상황에서 자동 전투가 정상 작동

---

### 단일 인터벌 사용으로 중복 실행 문제 완전 해결 - 2024년 12월 19일

**문제**: 여전히 `setTimeout`과 `setInterval`이 동시에 사용되어 중복 실행과 순서 꼬임 문제가 발생했습니다.

**원인**: 
- `setTimeout`으로 즉시 시작하는 로직과 `setInterval`로 주기적 체크하는 로직이 동시에 실행
- 턴 전환 시 `setTimeout`으로 다음 턴을 시작하는 것이 `setInterval`과 충돌
- 여러 타이머가 동시에 실행되어 전투 순서가 꼬임

**해결 방법**:
1. **단일 인터벌 사용**: `setTimeout` 완전 제거하고 `setInterval`만 사용
2. **게임 속도 연동**: `baseInterval / speed`로 게임 속도에 따른 인터벌 계산
3. **상태 기반 제어**: `setInterval`에서 상태를 체크하여 적절한 시점에 전투 실행
4. **순차적 처리**: 모든 전투 로직을 `setInterval` 내에서 순차적으로 처리

**수정된 파일**:
- `src/stores/index.ts`: `startAutoCombat`, `performCombatAction`, `proceedToNextFloor` 함수에서 `setTimeout` 제거

**결과**: 
- 중복 실행 문제 완전 해결
- 전투 순서 꼬임 문제 해결
- 게임 속도와 완벽하게 연동된 전투 시스템
- 안정적인 단일 타이머 기반 전투 시스템

---

### 전투 중복 실행 문제 해결 - 2024년 12월 19일

**문제**: 몬스터가 일반 공격을 3번 하는 경우가 발생하고, 턴 사이 인터벌과 즉시 시작이 충돌하여 전투 순서가 꼬이는 문제가 발생했습니다.

**원인**: 
- `setTimeout`과 `setInterval`이 동시에 실행되어 중복 실행 발생
- `setInterval`에서 `'waiting'` 상태를 체크할 때 이미 `setTimeout`으로 실행 중인 경우가 있음
- 여러 개의 `performCombatAction`이 동시에 호출되어 전투 순서가 꼬임

**해결 방법**:
1. **중복 실행 방지 로직 추가**: `performCombatAction`에서 이미 턴이 진행 중이면 리턴
2. **상태 체크 강화**: `setInterval`에서 전투 진행 상태를 더 정확히 체크
3. **안전한 턴 전환**: `setTimeout`에서 현재 상태를 다시 확인 후 실행
4. **플래그 기반 제어**: `playerTurnComplete`, `monsterTurnComplete` 플래그로 중복 실행 방지

**수정된 파일**:
- `src/stores/index.ts`: `startAutoCombat`과 `performCombatAction` 함수에 중복 실행 방지 로직 추가

**결과**: 
- 몬스터가 3번 공격하는 문제 해결
- 전투 순서가 꼬이는 문제 해결
- 턴 사이 인터벌과 즉시 시작의 충돌 해결
- 안정적인 턴제 전투 시스템 구현

---

### 턴 교차 시 전투 진행 문제 해결 - 2024년 12월 19일

**문제**: 플레이어가 3번 연속 공격한 후 몬스터가 3번 연속 공격하는 등 턴이 교대로 진행되지 않고 한쪽만 연속 공격하는 문제가 발생했습니다.

**원인**: 
- `setInterval`이 너무 빠르게 실행되어 턴이 끝나기 전에 다음 턴이 시작됨
- 턴 간의 지연 시간이 없어서 연속 공격이 발생
- 중복 실행 방지 로직이 충분하지 않아서 여러 턴이 동시에 실행됨

**해결 방법**:
1. **더 엄격한 중복 실행 방지**: `performCombatAction`에서 턴 진행 중일 때 완전히 차단
2. **인터벌 주기 증가**: 기본 인터벌을 1초에서 2초로 증가, 최소 간격을 0.2초에서 0.5초로 증가
3. **턴 상태 체크 강화**: `player_turn` 또는 `monster_turn` 상태일 때 추가 액션 차단

**수정된 파일**:
- `src/stores/index.ts`: `startAutoCombat`과 `performCombatAction` 함수 수정

**결과**: 
- 턴이 교대로 진행됨 (플레이어 → 몬스터 → 플레이어 → 몬스터)
- 연속 공격 문제 해결
- 턴 간 적절한 지연 시간 확보
- 안정적인 턴제 전투 시스템

---

### 즉시 턴 전환으로 턴 교대 문제 완전 해결 - 2024년 12월 19일

**문제**: 여전히 턴이 교대로 진행되지 않고 한쪽만 연속 공격하는 문제가 발생했습니다.

**원인**: 
- 플레이어 턴이 끝나면 `phase`를 `'waiting'`으로 바꾸고 `setInterval`이 다음 주기까지 기다림
- 몬스터 턴이 즉시 시작되지 않아서 턴 전환이 지연됨
- `setInterval`의 주기 때문에 턴 간 불필요한 대기 시간 발생

**해결 방법**:
1. **즉시 턴 전환**: 플레이어 턴이 끝나면 즉시 `phase`를 `'monster_turn'`으로 변경
2. **즉시 턴 실행**: `setTimeout`으로 0.1초 후 즉시 다음 턴 실행
3. **연속 턴 처리**: 몬스터 턴이 끝나면 즉시 `phase`를 `'player_turn'`으로 변경
4. **순차적 진행**: 턴이 끝나면 즉시 다음 턴으로 전환하여 연속성 확보

**수정된 파일**:
- `src/stores/index.ts`: `performCombatAction` 함수의 턴 전환 로직 수정

**결과**: 
- 턴이 즉시 교대로 진행됨 (플레이어 → 몬스터 → 플레이어 → 몬스터)
- 턴 간 지연 시간 최소화
- 연속 공격 문제 완전 해결
- 자연스러운 턴제 전투 시스템

---

### 플레이어 턴에서 일반공격과 스킬 공격 처리 문제 해결 - 2024년 12월 19일

**문제**: 플레이어 턴에서 자동 전투가 활성화되어 있어도 일반공격과 스킬 공격이 처리되지 않고 몬스터 턴으로 전환되지 않았습니다.

**원인**: 
- `setInterval`에서 `performCombatAction`을 호출할 때 `'waiting'` 상태일 때만 실행되도록 제한
- 플레이어 턴이 진행 중일 때는 `setInterval`이 액션을 수행하지 않음
- 중복 실행 방지 로직이 너무 엄격하여 플레이어 턴 진행을 차단

**해결 방법**:
1. **setInterval 조건 수정**: `'waiting'` 또는 `'player_turn'` 상태일 때 액션 수행
2. **중복 실행 방지 조정**: 턴이 완료되었을 때만 차단하고, 진행 중일 때는 허용
3. **플레이어 턴 처리**: 플레이어 턴에서 일반공격과 스킬 공격을 모두 처리 후 몬스터 턴으로 전환

**수정된 파일**:
- `src/stores/index.ts`: `setInterval` 조건과 `performCombatAction` 중복 실행 방지 로직 수정

**결과**: 
- 플레이어 턴에서 일반공격과 스킬 공격이 정상적으로 처리됨
- 자동 전투가 활성화되어 있을 때 턴이 자연스럽게 진행됨
- 몬스터 턴으로 정상적으로 전환됨

---

### 즉시 턴 전환으로 턴 교대 문제 완전 해결 - 2024년 12월 19일

### 게임 속도와 연동된 인터벌 및 턴 간 지연 시간 추가 - 2024년 12월 19일

**문제**: 턴이 순차적으로 진행되지만 게임 속도와 연동된 인터벌이나 각 공격 이후의 지연 시간이 없어서 너무 빠르게 진행되었습니다.

**원인**: 
- 턴 전환 시 고정된 0.1초 지연만 사용
- 게임 속도 설정이 턴 간 지연에 반영되지 않음
- `setInterval` 주기가 게임 속도와 완전히 연동되지 않음

**해결 방법**:
1. **게임 속도 연동 지연**: 턴 전환 시 `Math.max(200, 1000 / autoSpeed)`로 게임 속도에 따른 지연 시간 계산
2. **setInterval 주기 조정**: 기본 인터벌을 1.5초로 조정하고 최소 간격을 0.3초로 설정
3. **동적 지연 시간**: 속도가 빠를수록 지연 시간이 짧아지고, 속도가 느릴수록 지연 시간이 길어짐

**수정된 파일**:
- `src/stores/index.ts`: `startAutoCombat`과 `performCombatAction` 함수의 지연 시간 로직 수정

**결과**: 
- 게임 속도에 따라 턴 간 지연 시간이 자동 조절됨
- 빠른 속도에서는 빠르게, 느린 속도에서는 천천히 진행
- 자연스러운 전투 페이스 제공

---

### 플레이어 턴에서 일반공격과 스킬 공격 처리 문제 해결 - 2024년 12월 19일

### 자동 전투 상태 유지 및 게임 속도 연동 문제 해결 - 2024년 12월 19일

**문제**: 
- 플레이어가 이기고 자동 전투가 켜져 있는데 갑자기 자동 전투가 꺼지는 문제
- 다음 전투부터 속도가 뒤죽박죽 변하는 문제
- 전투가 끝난 후 게임 속도 설정이 초기화되는 문제

**원인**: 
- `handleMonsterDeath`와 `proceedToNextFloor`에서 `turnDelay`를 하드코딩된 1000으로 설정
- 전투 상태 초기화 시 게임 속도와 연동되지 않음
- 자동 전투 상태가 전투 종료 후 유지되지 않는 경우 발생

**해결 방법**:
1. **게임 속도 연동**: `turnDelay`를 `Math.max(200, 2000 / autoSpeed)`로 계산하여 게임 속도와 연동
2. **자동 전투 상태 유지**: 전투 종료 후에도 자동 전투 상태가 유지되도록 수정
3. **일관된 속도 설정**: 모든 전투 상태 초기화에서 게임 속도를 고려하도록 수정

**수정된 파일**:
- `src/stores/index.ts`: `handleMonsterDeath`와 `proceedToNextFloor` 함수의 `turnDelay` 계산 로직 수정

**결과**: 
- 자동 전투가 전투 종료 후에도 계속 유지됨
- 게임 속도 설정이 모든 전투에서 일관되게 적용됨
- 속도가 뒤죽박죽 변하는 문제 해결

---

### 게임 속도와 연동된 인터벌 및 턴 간 지연 시간 추가 - 2024년 12월 19일

### 딜레이 중앙 관리 시스템 구현 - 2024년 12월 19일

**문제**: 딜레이 계산이 여러 곳에 분산되어 있어서 일관성과 유지보수가 어려웠습니다.

**원인**: 
- `Math.max(200, 2000 / speed)` 계산이 여러 함수에 중복되어 있음
- 딜레이 값을 변경할 때 모든 곳을 수정해야 함
- 일관성 없는 딜레이 계산으로 인한 버그 발생 가능성

**해결 방법**:
1. **중앙 관리 함수 생성**: `getCombatDelay(speed: number)` 함수로 딜레이 계산 통합
2. **일관된 딜레이 적용**: 모든 딜레이 계산을 중앙 함수 사용으로 변경
3. **타입 안전성 확보**: TypeScript 인터페이스에 함수 타입 추가

**수정된 파일**:
- `src/stores/index.ts`: `getCombatDelay` 함수 추가 및 모든 딜레이 계산을 중앙 함수 사용으로 변경

**결과**: 
- 딜레이 계산이 한 곳에서 관리되어 일관성 확보
- 딜레이 값 변경 시 한 곳만 수정하면 됨
- 유지보수성과 안정성 향상

---

### 자동 전투 상태 유지 및 게임 속도 연동 문제 해결 - 2024년 12월 19일

### 플레이어 사망 처리 개선 - 2024년 12월 19일

**문제**: 
- 플레이어가 사망하고 1층으로 돌아가면 멈춰야 하는데 안 죽고 다음층 넘어가기도 함
- 죽어서 돌아가는 것처럼 뒤늦게 멈추는 문제
- 사망 후 자동 전투가 계속 진행되는 문제

**원인**: 
- `handlePlayerDeath`에서 자동 전투 정지가 몬스터 생성 후에 실행됨
- 사망 후에도 `isInCombat: true`로 설정되어 전투가 계속 진행됨
- `turnDelay`가 하드코딩되어 게임 속도와 연동되지 않음

**해결 방법**:
1. **즉시 자동 전투 정지**: 사망 처리 시작 시 즉시 `stopAutoCombat()` 호출
2. **자동 전투 모드 완전 해제**: `autoMode: false`로 설정하여 자동 전투 비활성화
3. **전투 상태 비활성화**: 새 몬스터 생성 시에도 `isInCombat: false`로 유지
4. **지연된 몬스터 생성**: `setTimeout`으로 1초 후 몬스터 생성하여 사망 처리 완료 후 진행
5. **중앙 딜레이 함수 사용**: `getCombatDelay(1)`로 기본 속도 적용

**수정된 파일**:
- `src/stores/index.ts`: `handlePlayerDeath` 함수의 사망 처리 로직 개선

**결과**: 
- 플레이어 사망 시 즉시 자동 전투가 정지됨
- 사망 후 안전하게 1층으로 돌아가고 멈춤
- 뒤늦게 멈추는 문제 해결
- 사망 처리 후 수동으로 자동 전투를 다시 시작해야 함

---

### 딜레이 중앙 관리 시스템 구현 - 2024년 12월 19일

### 사망 후 전투 UI 유지 문제 해결 - 2024년 12월 19일

**문제**: 플레이어가 사망한 후 전투 UI가 사라지는 문제가 발생했습니다.

**원인**: 
- `handlePlayerDeath`에서 새 몬스터 생성 시 `isInCombat: false`로 설정
- 전투 UI는 `isInCombat: true`일 때만 표시됨
- 사망 후 몬스터가 있어도 전투 UI가 표시되지 않음

**해결 방법**:
1. **전투 UI 유지**: 새 몬스터 생성 시 `isInCombat: true`로 설정하여 전투 UI 표시
2. **자동 전투는 비활성화**: `autoMode: false`는 유지하여 자동 전투는 비활성화
3. **수동 전투 가능**: 전투 UI는 표시되지만 자동 전투는 수동으로 시작해야 함

**수정된 파일**:
- `src/stores/index.ts`: `handlePlayerDeath` 함수에서 새 몬스터 생성 시 `isInCombat: true` 설정

**결과**: 
- 사망 후에도 전투 UI가 정상적으로 표시됨
- 자동 전투는 비활성화되어 수동으로 시작해야 함
- 몬스터 정보와 전투 로그가 정상적으로 표시됨

---

### 사망 후 멋대로 전투 시작 문제 해결 - 2024년 12월 19일

**문제**: 플레이어가 사망하고 내려간 후에 멋대로 전투를 한 턴 진행하는 문제가 발생했습니다.

**원인**: 
- `startAutoCombat` 함수에서 몬스터가 이미 있고 전투 중이면 즉시 첫 턴을 시작하는 로직
- 사망 후 새 몬스터가 생성되면서 `autoMode: false`이지만 즉시 시작 조건이 충족되어 전투가 시작됨
- `tower.autoMode` 체크가 누락되어 사망 후에도 전투가 자동으로 시작됨

**해결 방법**:
1. **자동 전투 모드 체크 추가**: 즉시 첫 턴 시작 조건에 `tower.autoMode` 체크 추가
2. **사망 후 전투 방지**: 사망 후에는 `autoMode: false`이므로 즉시 시작되지 않음
3. **수동 전투만 가능**: 사망 후에는 수동으로 자동 전투를 시작해야 함

**수정된 파일**:
- `src/stores/index.ts`: `startAutoCombat` 함수에서 즉시 첫 턴 시작 조건에 `tower.autoMode` 체크 추가

**결과**: 
- 사망 후에는 멋대로 전투가 시작되지 않음
- 사망 후에는 수동으로 자동 전투를 시작해야 함
- 정상적인 자동 전투 시작은 그대로 작동함

---

### 사망 후 전투 UI 유지 문제 해결 - 2024년 12월 19일

### 사망 후 자동 전투 방지 플래그 시스템 구현 - 2024년 12월 19일

**문제**: 사망 후 멋대로 전투 시작 문제를 해결하기 위해 `tower.autoMode` 체크를 추가했지만, 정상적인 자동 전투 시작도 막히는 문제가 발생했습니다.

**원인**: 
- `startAutoCombat`에서 `autoMode: true`를 설정한 후 즉시 첫 턴 시작 조건을 체크할 때, `tower.autoMode`는 아직 업데이트되지 않은 상태
- 사망 후와 정상적인 자동 전투 시작을 구분할 수 있는 별도의 플래그가 필요

**해결 방법**:
1. **사망 후 자동 전투 방지 플래그 추가**: `TowerState`에 `preventAutoCombat?: boolean` 추가
2. **사망 시 플래그 설정**: `handlePlayerDeath`에서 `preventAutoCombat: true` 설정
3. **정상 시작 시 플래그 리셋**: `startAutoCombat`에서 `preventAutoCombat: false` 설정
4. **즉시 시작 조건 수정**: `!tower.preventAutoCombat` 체크로 사망 후 전투 방지

**수정된 파일**:
- `src/types/index.ts`: `TowerState`에 `preventAutoCombat?: boolean` 추가
- `src/stores/index.ts`: `handlePlayerDeath`에서 `preventAutoCombat: true` 설정
- `src/stores/index.ts`: `startAutoCombat`에서 `preventAutoCombat: false` 설정 및 체크

**결과**: 
- 사망 후에는 자동 전투가 시작되지 않음
- 정상적인 자동 전투 시작은 그대로 작동함
- 사망 후에는 수동으로 자동 전투를 시작해야 함

---

### 사망 후 전투 완전 방지 시스템 구현 - 2024년 12월 19일

**문제**: 사망 후에도 여전히 전투가 진행되는 문제가 발생했습니다. 로그를 보면 사망 후 새 몬스터가 나타난 직후 바로 전투가 시작되어 플레이어와 몬스터가 번갈아가며 공격하고 있었습니다.

**원인**: 
- `handlePlayerDeath`에서 새 몬스터 생성 시 `preventAutoCombat: true`를 설정하지 않음
- `setInterval` 내부에서 `preventAutoCombat` 플래그를 체크하지 않음
- 사망 후에도 `setInterval`이 계속 실행되어 전투 액션을 수행함

**해결 방법**:
1. **새 몬스터 생성 시 플래그 유지**: `handlePlayerDeath`에서 새 몬스터 생성 시에도 `preventAutoCombat: true` 설정
2. **setInterval 내부 체크 추가**: `setInterval` 내부에서 전투 액션 수행 전에 `preventAutoCombat` 플래그 체크
3. **완전한 전투 방지**: 사망 후에는 모든 자동 전투 관련 액션이 차단됨

**수정된 파일**:
- `src/stores/index.ts`: `handlePlayerDeath`에서 새 몬스터 생성 시 `preventAutoCombat: true` 설정
- `src/stores/index.ts`: `setInterval` 내부에서 `preventAutoCombat` 플래그 체크 추가

**결과**: 
- 사망 후에는 전투가 완전히 차단됨
- 사망 후에는 수동으로 자동 전투를 시작해야 함
- 정상적인 자동 전투 시작은 그대로 작동함

---

### 사망 후 자동 전투 방지 플래그 시스템 구현 - 2024년 12월 19일

### 사망 처리 순서 개선 - 2024년 12월 19일

**문제**: 사망 처리 순서가 섞여서 즉시 아래층으로 이동하고 몬스터가 생성되는 문제가 있었습니다.

**원인**: 
- 사망 후 바로 3층 아래로 이동하고 몬스터 생성
- 사용자가 원하는 순서와 다름: 사망 → 전투정지 → 3초후 이동 → 몬스터 생성 → 자동전투 이어지기

**해결 방법**:
1. **순서 명확화**: 사망 → 전투정지 → 3초후 이동 → 몬스터 생성 → 자동전투 이어지기
2. **즉시 전투 정리**: 사망 후 현재 층에서 몬스터 제거 및 전투 중지
3. **3초 대기**: 3초 후에 아래층으로 이동
4. **새 몬스터 생성**: 이동 후 새 몬스터 생성 (자동 전투는 비활성화)

**수정된 파일**:
- `src/stores/index.ts`: `handlePlayerDeath` 함수의 순서 개선

**수정된 순서**:
1. **사망 로그**: "💀 플레이어 사망!" 로그 추가
2. **자동 전투 정지**: `stopAutoCombat()` 호출
3. **현재 층 정리**: 몬스터 제거, 전투 중지, 상태 정리
4. **3초 후 이동**: `setTimeout(..., 3000)`으로 3초 후 아래층 이동
5. **몬스터 생성**: 새 층에서 몬스터 생성 (자동 전투는 비활성화)

**결과**: 
- 사망 후 3초간 현재 층에서 대기
- 3초 후 아래층으로 이동
- 새 몬스터 생성 (자동 전투는 수동으로 시작해야 함)
- 순서가 명확하게 구분됨

---

### 사망 후 전투 완전 방지 시스템 구현 - 2024년 12월 19일

### GitHub Pages 배포 문제 해결 - 2024년 12월 23일

**문제**: GitHub Pages에 배포 후 "새로 시작" 버튼을 누르면 초기화 화면만 뜨다가 바로 홈으로 돌아가는 문제가 발생했습니다.

**원인**: 
- GitHub Pages에서 빌드된 파일들이 `src/data/` 경로로 접근할 수 없음
- Vite로 빌드하면 정적 파일들이 다른 경로로 배포되어 fetch 요청이 404 오류 발생
- `startNewGame` 함수에서 `fetch('/src/data/initial/character.json')` 등의 요청이 실패

**해결 방법**:
1. **데이터 파일을 TypeScript 모듈로 변환**: `src/data/initial/index.ts` 파일 생성
2. **초기 데이터를 상수로 정의**: `initialCharacterData`, `initialInventoryData`, `initialSkillsData`, `initialTowerData` 상수 생성
3. **fetch 대신 임포트 사용**: `startNewGame`과 `loadInitialInventory` 함수에서 fetch 제거하고 임포트된 데이터 사용
4. **빌드 시 포함**: 데이터가 빌드 시 포함되어 배포 후에도 정상 작동

**수정된 파일**:
- `src/data/initial/index.ts`: 초기 데이터를 TypeScript 상수로 정의
- `src/stores/index.ts`: fetch 제거하고 임포트된 데이터 사용

**결과**: 
- GitHub Pages에서 정상적으로 새 게임 시작 가능
- 404 오류 완전 해결
- 빌드 시 데이터가 포함되어 배포 후에도 안정적 작동
- 로컬 개발 환경과 배포 환경 모두에서 동일하게 작동

---

### 사망 후 대기 시간 조정 - 2024년 12월 19일

**변경 사항**: 사망 후 아래층으로 이동하는 대기 시간을 3초에서 2초로 단축했습니다.

**수정된 파일**:
- `src/stores/index.ts`: `handlePlayerDeath` 함수에서 `setTimeout` 시간을 3000ms에서 2000ms로 변경

**결과**: 
- 사망 후 2초간 현재 층에서 대기
- 2초 후 아래층으로 이동
- 더 빠른 게임 진행 가능

---

### 사망 처리 순서 개선 - 2024년 12월 19일

## 2024-12-19 작업 내역

### 1. 아이템/재료/음식/장비 구조 전면 개편
- **파일**: `src/data/items/index.json`
- **내용**: 속성별/티어별 체계적인 아이템 시스템 구축
  - 각 속성별로 Common/Fine/Superior/Epic 재료 체계
  - 무기/방어구/악세사리 제작 레시피 추가
  - 포션/음식 제작 시스템 구현
  - 속성별 재료: Flame, Frost, Toxic, Shadow, Thunder, Verdant

### 2. 개별 재료 파일 구조 통일
- **파일**: `src/data/materials/*.json` (총 40개 파일)
- **내용**: 모든 재료 파일을 새로운 구조로 통일
  - 기존 `materialId` → `id`로 변경
  - `element` → `theme`로 변경  
  - `rarity` → `tier`로 변경
  - `baseValue`, `stackable`, `maxStack` 필드 추가

### 3. 몬스터 시스템 확장 및 약화
- **파일**: `src/data/monsters/*.json` (총 30개 파일)
- **내용**: 각 속성별 몬스터 세트 생성
  - 일반 몬스터 3종 + 엘리트 1종 + 보스 1종
  - 능력치 전체적으로 약화 (HP, 공격력, 방어력 감소)
  - 통일된 구조로 필드명 정리
  - 드롭테이블 연결 구조 개선

### 4. 스킬 시스템 확장
- **파일**: `src/data/skills/*.json` (총 7개 파일)
- **내용**: 몬스터별 전용 스킬 추가 (유저 습득 가능)
  - Toxic: toxic_spit, venom_burst
  - Shadow: shadow_bite, dark_howl  
  - Thunder: thunder_shock, thunder_roar
  - Verdant: verdant_charge, nature_blessing
  - 각 스킬별 수련치 시스템 포함

### 5. 드롭 테이블 시스템 구축
- **파일**: `src/data/drops/*.json` (총 18개 파일)
- **내용**: 속성별/티어별 드롭 테이블 생성
  - 일반/엘리트/보스별 차등화된 드롭률
  - 속성별 재료, 장비, 스킬페이지 포함
  - 포션, 음식 등 소모품 드롭 추가

### 6. 기존 몬스터 능력치 조정
- **파일**: `src/data/monsters/ember_wolf.json`, `fire_sprite.json` 등
- **내용**: 기존 몬스터들의 능력치를 전체적으로 약화
  - HP: 50 → 30 (ember_wolf)
  - 공격력: 18 → 10 (ember_wolf)
  - 방어력: 8 → 5 (ember_wolf)
  - 통일된 구조로 필드명 정리

## 핵심 변경사항

### 아이템 구조
- 속성별 재료: Common(15골드) → Fine(45골드) → Superior(120골드) → Epic(300골드)
- 제작 시스템: 무기/방어구(Common+Fine+Superior 재료), 악세사리(Epic 재료)
- 포션: Common/Fine 재료로 제작
- 음식: 티어별 약초/물고기로 제작

### 몬스터 시스템  
- 각 속성별 5종 몬스터 (일반3+엘리트1+보스1)
- 능력치 약화로 초보자 친화적 게임 밸런스
- 드롭테이블을 통한 체계적인 아이템 획득 시스템

### 스킬 시스템
- 몬스터별 고유 스킬 추가
- 유저 습득 가능한 스킬 시스템
- 수련치를 통한 스킬 강화 시스템

### 7. 드롭 시스템 개선 및 아이템 레벨 시스템 구현
- **파일**: `src/utils/dropSystem.ts`, `src/stores/index.ts`
- **내용**: 몬스터 드롭 아이템의 레벨 시스템 구현
  - 층수 기반 드롭 레벨 계산: `⌊층/2⌋ + (일반 0·엘리트 +3·보스 +7) ± 3`
  - 몬스터 티어별 품질 차등화: 일반(Common/Fine), 엘리트(Fine/Superior), 보스(Superior/Epic)
  - 아이템 타입별 레벨 적용: 재료/소모품/장비별 적절한 레벨링
  - 스킬 페이지 드롭 시스템: 몬스터 스킬 기반 10-20% 확률 드롭

### 8. 전투 속도 조정 및 드롭 시스템 버그 수정
- **파일**: `src/stores/index.ts`, `src/utils/dataLoader.ts`, `src/types/index.ts`
- **내용**: 
  - 전투 속도 조정: 기본 인터벌 1.5초 → 3초, 최소 딜레이 0.3초 → 0.5초
  - 드롭 테이블 로드 시스템 개선: 동적 import로 모든 드롭 테이블 지원
  - 몬스터 타입 정의 수정: `dropTableId` → `dropTable`, `skillPageDrops` → `skills`
  - 아이템 레벨/품질 정보를 인벤토리 시스템에 전달하도록 수정

### 9. 인벤토리 레벨 표시 시스템 개선
- **파일**: `src/components/inventory/InventoryPanel.tsx`, `src/stores/index.ts`
- **내용**: 
  - 인벤토리 패널에서 실제 아이템 레벨 표시하도록 수정
  - 재료/소모품 추가 시 기존 아이템과 레벨 비교하여 더 높은 레벨로 업데이트
  - 장비 품질 표시 시스템 개선: Common/Fine/Superior/Epic/Legendary 색상 구분

### 10. 인벤토리 상세 분류 시스템 개선
- **파일**: `src/components/inventory/InventoryPanel.tsx`
- **내용**: 
  - 재료 속성 분류 개선: flame/frost/toxic/shadow/thunder/verdant 속성 자동 판별
  - 장비 카테고리 분류 개선: weapon/armor/accessory 정확한 분류
  - 소모품 분류 개선: potion/food/scroll 정확한 분류
  - 아이템명 기반 자동 분류 시스템 구현

### 11. 장비 강화 시스템 완전 개선
- **파일**: `src/components/common/ItemDetailModal.tsx`, `src/stores/index.ts`
- **내용**: 
  - 장착되지 않은 장비도 강화 가능하도록 수정
  - 인벤토리 장비 강화 함수 `enhanceInventoryEquipment` 추가
  - 강화 모달에서 장착 여부에 따라 다른 강화 함수 호출
  - 타입 안전성 개선: ItemInstance ↔ EquipmentInstance 변환
  - 강화 후 인벤토리 업데이트 및 스탯 재계산

### 12. 초기 장비 강화 레벨 시스템 수정
- **파일**: `src/data/initial/inventory.json`, `src/utils/itemGenerator.ts`
- **내용**: 
  - 초기 인벤토리 JSON에 `enhancement` 필드 추가
  - 각 장비별로 적절한 초기 강화 레벨 설정 (1-5)
  - `generateInitialItems` 함수에서 JSON의 enhancement 값 우선 사용
  - 강화 모달과 인벤토리 표시의 강화 레벨 일치성 확보

### 13. 장비 스탯 계산 시스템 완전 개선
- **파일**: `src/utils/equipmentSystem.ts`, `src/stores/index.ts`, `src/components/life/CraftingModal.tsx`
- **내용**: 
  - `getEquipmentStats` 함수에 레벨, 품질, 강화 보너스 모두 적용
  - 드롭된 장비에 품질별 랜덤 강화 레벨 자동 생성
  - 제작된 장비에 레벨과 품질 정보 전달하여 적절한 강화 레벨 적용
  - 품질별 강화 확률: Common(50%+0), Fine(30%+0), Superior(20%+0), Epic(10%+0), Legendary(5%+0)
  - 레벨당 15%, 품질별 배수, 강화당 4% 스탯 증가 적용

### 14. 드롭 장비 강화 레벨 및 스탯 보너스 조정
- **파일**: `src/stores/index.ts`, `src/utils/equipmentSystem.ts`, `src/utils/itemGenerator.ts`
- **내용**: 
  - 드롭되는 장비의 강화 레벨을 0으로 고정 (강화는 플레이어가 직접 해야 함)
  - 레벨 보너스를 15%에서 5%로 감소 (레벨 변동성 감소)
  - 강화 보너스를 4%에서 8%로 증가 (강화의 중요성 증가)
  - 제작된 장비는 여전히 품질에 따른 랜덤 강화 레벨 적용

### 15. 장비 강화 모달 실시간 업데이트 시스템 구현
- **파일**: `src/components/common/ItemDetailModal.tsx`
- **내용**: 
  - 강화 모달에서 실시간으로 최신 장비 정보를 가져오는 `getCurrentEquipment` 함수 추가
  - 인벤토리 장비와 장착된 장비 모두 최신 강화 레벨 반영
  - 강화 후 모달이 자동으로 최신 정보로 업데이트됨
  - 강화 레벨, 비용, 성공률이 실시간으로 정확히 표시됨

### 16. 장비 강화 레벨 동기화 문제 해결
- **파일**: `src/components/common/ItemDetailModal.tsx`, `src/stores/index.ts`
- **내용**: 
  - 강화 모달과 인벤토리 표시의 강화 레벨 불일치 문제 해결
  - `getCurrentEquipment` 함수에서 장착 여부를 정확히 판별하도록 수정
  - `enhanceInventoryEquipment` 함수에서 강화 후 `enhancement` 필드를 명시적으로 설정
  - 강화 모달에 올바른 장비 정보 전달하여 일관성 확보

### 17. 인벤토리 아이템 클릭 시 강화 레벨 정보 전달 개선
- **파일**: `src/components/inventory/InventoryPanel.tsx`, `src/components/common/ItemDetailModal.tsx`
- **내용**: 
  - `handleItemClick` 함수에서 인벤토리 아이템 정보를 우선적으로 사용하도록 수정
  - 강화 모달의 `getCurrentEquipment` 함수에서 인벤토리 아이템 검색 로직 개선
  - 인벤토리 표시와 강화 모달의 강화 레벨 정보가 완전히 일치하도록 수정

### 18. 장비 상세 모달 정보 표시 시스템 완전 개선
- **파일**: `src/components/common/ItemDetailModal.tsx`
- **내용**: 
  - `getBaseEquipmentStats` 함수를 사용하여 기본 스탯 정확히 표시
  - 강화된 장비의 경우 실제 스탯(레벨, 품질, 강화 보너스 포함) 별도 표시
  - 품질 배수, 레벨 보너스(5%), 강화 보너스(8%) 계산 로직 추가
  - 장비 상세 모달에서 모든 정보가 정확히 표시되도록 수정

### 19. 인벤토리 아이템 상세 모달 호환성 완전 개선
- **파일**: `src/components/common/ItemDetailModal.tsx`
- **내용**: 
  - 인벤토리 아이템의 `itemId` 기반 정보 표시 시스템 구현
  - 아이템 이름, 타입, 설명이 없는 경우 `itemId`에서 자동 생성
  - 장비 타입 판별 로직을 `itemId` 키워드 기반으로 개선
  - 장착/해제 및 강화 기능이 인벤토리 아이템과 완전 호환되도록 수정

### 20. 캐릭터 패널과 인벤토리 간 장비 정보 동기화 완전 개선
- **파일**: `src/components/character/CharacterPanel.tsx`
- **내용**: 
  - 캐릭터 패널에서 장비 클릭 시 실제 장착된 장비 정보를 사용하도록 수정
  - `handleItemClick` 함수에 `equipment` 매개변수 추가하여 정확한 장비 정보 전달
  - 장비 표시에 품질 정보 추가 (Lv N | Quality +N 형태)
  - 아이템 이름을 `itemId`에서 자동 생성하여 표시
  - 캐릭터 패널과 인벤토리의 장비 정보가 완전히 일치하도록 수정

### 21. 장비 장착 시스템 완전 수정 및 스탯 동기화 개선
- **파일**: `src/utils/equipmentSystem.ts`, `src/components/character/CharacterPanel.tsx`
- **내용**: 
  - `equipItem` 함수에서 인벤토리 아이템의 `level`, `quality`, `enhancement` 정보를 정확히 복사
  - 장비 장착 시 모든 속성이 플레이어 장비 슬롯에 정확히 반영
  - 캐릭터 패널 장비 표시에서 기본값 처리 추가 (level || 1, enhancement || 0)
  - 인벤토리, 캐릭터 패널, 최종 스탯 간의 완전한 동기화 구현

### 🎯 **제작 시스템 완전 개편 - 룰렛 제거 및 재료 기반 품질 시스템 구현 - 2024년 12월 23일**

**문제**: 
1. 제작 시 룰렛 미니게임이 복잡하고 불필요함
2. 재료 레벨과 제작 스킬 레벨이 품질에 반영되지 않음
3. 사용할 재료를 선택할 수 없음
4. 제작 시스템이 랜덤성에 의존하여 전략적 요소 부족

**해결 방법**:
1. **룰렛 시스템 완전 제거**: 
   - 슬롯머신 미니게임 제거
   - 랜덤성 기반 품질 계산 제거
   - 더 전략적이고 예측 가능한 제작 시스템 구현

2. **재료 기반 품질 시스템 구현**:
   - 재료 레벨이 높으면 품질 확률이 떨어짐 (재료가 너무 고급이면 제작이 어려움)
   - 제작 스킬 레벨이 높으면 품질 확률이 올라감
   - 재료 품질과 스킬 레벨의 균형을 통한 전략적 제작

3. **재료 선택 모달 구현**:
   - 사용할 재료를 모달에서 직접 선택 가능
   - 재료별 레벨과 품질 정보 표시
   - 예상 품질 실시간 계산 및 표시
   - 선택된 재료에 따른 품질 예측

4. **품질 계산 알고리즘**:
   - 재료 평균 레벨과 품질 계산
   - 재료 레벨 페널티: `(평균재료레벨 - 스킬레벨) * 10`
   - 스킬 레벨 보너스: `스킬레벨 * 5`
   - 최종 품질 점수: `평균재료품질 + 스킬레벨보너스 - 재료레벨페널티`

5. **아이템 레벨 계산**:
   - 재료 평균 레벨과 스킬 레벨의 평균으로 계산
   - `Math.max(1, Math.floor((평균재료레벨 + 스킬레벨) / 2))`

**수정된 파일**:
- `src/components/life/CraftingModal.tsx`: 룰렛 제거, 재료 선택 모달 구현, 품질 계산 시스템 구현
- `src/types/index.ts`: MaterialInstance에 uniqueId와 quality 필드 추가

**결과**: 
- 룰렛 미니게임 제거로 더 직관적이고 전략적인 제작 시스템
- 재료 레벨과 제작 스킬 레벨에 따른 정확한 품질 계산
- 사용자가 직접 재료를 선택할 수 있는 모달 시스템
- 예상 품질 실시간 표시로 전략적 제작 가능
- 재료와 스킬 레벨의 균형을 통한 깊이 있는 게임플레이

---

### 🎲 **제작 시스템에 랜덤성 추가 - 2024년 12월 23일**

**문제**: 
1. 품질과 아이템 레벨 계산이 완전히 결정적이어서 예측 가능함
2. 제작 결과에 대한 긴장감과 흥미 부족
3. 스킬 레벨이 높아도 완전히 예측 가능한 결과

**해결 방법**:
1. **품질 계산에 랜덤성 추가**:
   - 기본 품질 점수에 랜덤 보너스 추가
   - 스킬 레벨이 높을수록 랜덤 범위가 줄어듦 (더 안정적인 제작)
   - 확률 기반 품질 결정 시스템 구현

2. **품질별 확률 계산 시스템**:
   - 기본 점수에 따른 각 품질별 확률 계산
   - 스킬 레벨에 따른 보정 적용
   - 확률 정규화로 합계 100% 보장

3. **아이템 레벨에 랜덤성 추가**:
   - 기본 레벨 계산에 랜덤 보너스 추가
   - 스킬 레벨이 높을수록 레벨 변동 범위 감소
   - 최소 레벨 1 보장

4. **UI 개선**:
   - 예상 품질 표시에 확률 정보 추가
   - 각 품질별 확률을 색상으로 구분 표시
   - 기본 점수와 확률 분포 실시간 표시

**랜덤성 메커니즘**:
- **품질 랜덤 범위**: `Math.max(5, 20 - skillLevel * 0.5)`
- **레벨 랜덤 범위**: `Math.max(1, 3 - skillLevel * 0.1)`
- **확률 보정**: 스킬 레벨에 따른 Superior, Epic, Legendary 확률 증가

**수정된 파일**:
- `src/components/life/CraftingModal.tsx`: 랜덤성 추가, 확률 계산 시스템 구현, UI 개선

**결과**: 
- 제작 결과에 긴장감과 흥미 추가
- 스킬 레벨이 높을수록 더 안정적이고 예측 가능한 결과
- 확률 기반 품질 시스템으로 전략적 선택의 중요성 증가
- 실시간 확률 표시로 사용자 경험 향상

---

### 🔧 **제작 시스템 개선 및 낚시 게임 수정 - 2024년 12월 23일**

**문제**: 
1. 제작 시스템에서 모든 아이템을 제작할 수 없음 (3개만 표시)
2. 연금술과 요리는 필터링 탭이 불필요함 (물약/음식만 제작)
3. 소모품 탭이 대장기술에 불필요함
4. 낚시 게임에서 다 맞춰도 75%밖에 점수가 안 나옴
5. 낚시 레벨이 올라도 맞춰야 하는 갯수가 증가하지 않음

**해결 방법**:
1. **제작 시스템 개선**:
   - 모든 아이템을 제작할 수 있도록 아이템 목록 확장
   - 대장기술: 모든 무기, 갑옷, 악세서리 제작 가능
   - 연금술: 모든 물약 제작 가능 (health_potion, mana_potion, greater_health_potion, greater_mana_potion, stamina_potion)
   - 요리: 모든 음식 제작 가능 (bread, meat_stew, fish_stew, herb_soup, divine_feast)

2. **필터링 시스템 개선**:
   - 소모품 탭 제거
   - 대장기술만 필터링 탭 표시 (무기, 방어구, 악세서리)
   - 연금술과 요리는 필터링 탭 제거 (단일 아이템 타입만 제작)

3. **낚시 게임 점수 시스템 개선**:
   - 점수 계산 방식 변경: `100 / 시퀀스길이 + 레벨보너스`
   - 레벨 보너스: `Math.min(20, skillLevel * 2)`
   - 오답 페널티: `Math.max(5, 15 - skillLevel)` (레벨이 높을수록 페널티 감소)
   - 모든 시퀀스 완료 시 자동 게임 종료

4. **낚시 게임 난이도 조정**:
   - 레벨에 따른 시퀀스 길이 조정: `Math.min(10, Math.max(3, 3 + Math.floor(skillLevel / 2)))`
   - 레벨 1: 3개 시퀀스
   - 레벨 10: 8개 시퀀스
   - 레벨 15+: 10개 시퀀스 (최대)

5. **UI 개선**:
   - 낚시 게임에 현재 레벨과 시퀀스 개수 표시
   - 제작 모달에서 스킬 타입에 따른 필터링 탭 조건부 표시

**수정된 파일**:
- `src/components/life/CraftingModal.tsx`: 필터링 시스템 개선, 소모품 탭 제거
- `src/components/life/FishingMinigame.tsx`: 점수 시스템 개선, 레벨 기반 난이도 조정
- `src/components/life/LifePanel.tsx`: FishingMinigame에 skillLevel 전달

**결과**: 
- 모든 아이템을 제작할 수 있는 완전한 제작 시스템
- 스킬 타입에 맞는 적절한 필터링 시스템
- 레벨에 따른 낚시 게임 난이도 조정
- 공정하고 예측 가능한 점수 시스템
- 사용자 경험 향상

---

### 📱 **UI 레이아웃 수정 - 패널 하단 잘림 문제 해결 - 2024년 12월 23일**

**문제**: 
1. 상점과 제작 패널의 하단 부분이 하단 네비게이션 바와 겹쳐서 잘림
2. 패널의 최대 높이가 하단 네비게이션 바를 고려하지 않음
3. 사용자가 패널의 하단 내용을 볼 수 없음

**해결 방법**:
1. **패널 최대 높이 조정**:
   - 기존: `max-h-[calc(100vh-4rem)]` (상단 HUD만 고려)
   - 수정: `max-h-[calc(100vh-8rem)]` (상단 HUD + 하단 네비게이션 바 고려)
   - 하단 네비게이션 바 높이: 4rem (64px)

2. **제작 모달 내부 스크롤 영역 조정**:
   - 기존: `max-h-[calc(90vh-180px)]`
   - 수정: `max-h-[calc(90vh-220px)]`
   - 추가 여백 확보로 하단 내용이 잘리지 않도록 조정

3. **적용된 패널들**:
   - `ShopPanel.tsx`: 상점 패널 높이 조정
   - `LifePanel.tsx`: 생활 스킬 패널 높이 조정
   - `CraftingModal.tsx`: 내부 스크롤 영역 조정

**결과**: 
- 상점과 제작 패널의 하단 내용이 하단 네비게이션 바와 겹치지 않음
- 모든 패널 내용을 스크롤하여 볼 수 있음
- 일관된 UI 레이아웃으로 사용자 경험 향상

---

### 🔧 **JSON 파일 직접 import 오류 해결 - 2024년 12월 23일**

**문제**: 
- Vite 개발 서버에서 `[plugin:vite:json] Failed to parse JSON file` 오류 발생
- `src/data/initial/inventory.json` 파일 파싱 실패
- 브라우저에서 500 Internal Server Error 발생
- 게임이 로드되지 않음

**원인**: 
- `src/stores/index.ts`에서 JSON 파일을 직접 import하고 있었음
- Vite에서 JSON 파일을 직접 import할 때 파싱 오류가 발생할 수 있음
- 동적 import 대신 정적 import를 사용하여 문제 발생

**해결 방법**:
1. **JSON 파일 직접 import 제거**:
   - `import characterData from '../data/initial/character.json'` 제거
   - `import inventoryData from '../data/initial/inventory.json'` 제거
   - `import skillsData from '../data/initial/skills.json'` 제거
   - `import towerData from '../data/initial/tower.json'` 제거

2. **dataLoader 함수 사용으로 변경**:
   - `import { loadInitialCharacter, loadInitialInventory, loadInitialSkills, loadInitialTower } from '../utils/dataLoader'` 추가
   - `startNewGame` 함수에서 동적 로드 함수 사용
   - `loadInitialInventory` 함수에서 동적 로드 함수 사용

3. **비동기 데이터 로드**:
   - `const initialCharacter = await loadInitialCharacter()` 사용
   - `const initialInventory = await loadInitialInventory()` 사용
   - `const initialSkills = await loadInitialSkills()` 사용
   - `const initialTower = await loadInitialTower()` 사용

**수정된 파일**:
- `src/stores/index.ts`: JSON 파일 직접 import 제거, dataLoader 함수 사용으로 변경

**결과**: 
- JSON 파싱 오류 완전 해결
- Vite 개발 서버 정상 작동
- 게임 로드 정상화
- 동적 import를 통한 안정적인 데이터 로딩

---